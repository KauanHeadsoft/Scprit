Nome_Papel	Dados_Registro	Mensagem_Bloqueio
00001_BLOQUEIO_COMERCIAL	 SELECT   @Acao = CASE     WHEN Gross_Weight = 1 THEN 5 /* Bloqueia*/     Else 0   END,   @Mensagem = CAST(CASE     WHEN Gross_Weight = 1 THEN '[#072] BL encontra-se em status de bloqueado, o mesmo não pode ser editado.'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT    CAST(CASE          WHEN (Bla.Gross_Weight <>  Lhs.Peso_Bruto) THEN 1       Else 0     END as int) as Gross_Weight   FROM   (     SELECT       Prm.value('Item[@Nome="IdConhecimento_Embarque"][1]/@Value', 'int') as IdConhecimento_Embarque,       Prm.value('Item[@Nome="Gross_Weight"][1]/@Value', 'int') as Gross_Weight     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm  JOIN    vis_Bill_Lading Bla on Bla.IdConhecimento_Embarque = Prm.IdConhecimento_Embarque   LEFT OUTER JOIN    mov_Logistica_House Lhs on Lhs.IdLogistica_House = Bla.IdLogistica_House  ) Blq 	[#072] BL encontra-se em status de bloqueado, o mesmo não pode ser editado.
Z_BLC_BL5_NAO_FINALIZA_FATURA_S_RETER_IMPOSTO	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueio pede senha*/     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Atenção! Por gentileza conferir se houve retenção de impostos nesta fatura.'     Else NULL   END as VARCHAR(MAX)) FROM   (   SELECT     CAST(CASE       WHEN Prm.Tipo = 2 AND EXISTS(SELECT         Ltx.IdLogistica_Taxa       FROM         mov_Logistica_Fatura Lft       JOIN         mov_Registro_Financeiro Rfn ON Lft.IdRegistro_Financeiro = Rfn.IdRegistro_Financeiro AND Rfn.Natureza = 1       JOIN         mov_Fatura_Financeira Ffn ON Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro       JOIN         mov_Logistica_Taxa Ltx ON Ltx.IdRegistro_Recebimento = Ffn.IdRegistro_Financeiro AND Ltx.IdTaxa_Logistica_Exibicao IN (210 /*IR*/, 212 /*PIS*/, 213/*COFINS*/, 215/*CSLL*/)       WHERE         Lft.IdLogistica_House = Lfatura.IdLogistica_House THEN 0       ELSE 1     END as Bit) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdFatura_Financeira"][1]/@Value', 'int') as IdFatura_Financeira,       Prm.value('Item[@Nome="Tipo"][1]/@Value', 'int') as Tipo     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) AS Prm   JOIN     mov_Fatura_Financeira Ffn ON Ffn.IdFatura_Financeira = Prm.IdFatura_Financeira   LEFT OUTER JOIN     mov_Logistica_Fatura Lfatura ON Ffn.IdRegistro_Financeiro = Lfatura.IdRegistro_Financeiro   LEFT OUTER JOIN     mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Lfatura.IdLogistica_House   WHERE     Ffn.Tipo <> 2   )AS  Blq 	Atenção! Por gentileza conferir se houve retenção de impostos nesta fatura.
RICARDO_TESTES	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Favor preencher a moeda e o valor da mercadoria.'     Else NULL   END as VARCHAR(MAX)) FROM   (   SELECT     CAST(CASE       WHEN (Prm.IdLogistica_House IS NOT NULL AND Lms.Modalidade_Processo = 2  AND Lms.Tipo_Operacao = 2  AND Lhs.IdIncoterm IN(3,5))  AND (Prm.Valor_Mercadoria IS NULL)  OR  ((COALESCE(Prm.Valor_Mercadoria,0) &lt;&gt;  OR COALESCE(Prm.Importancia_Segurada,0) &lt;&gt; 0)  AND Prm.IdMoeda_Mercadoria IS NULL) THEN 1       ELSE 0     END as int) as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House,       Prm.value('Item[@Nome="IdMoeda_Mercadoria"][1]/@Value', 'int') as IdMoeda_Mercadoria,       Prm.value('Item[@Nome="Valor_Mercadoria"][1]/@Value', 'numeric') as Valor_Mercadoria,       Prm.value('Item[@Nome="Importancia_Segurada"][1]/@Value', 'numeric') as Importancia_Segurada     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm   JOIN      mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Prm.IdLogistica_House   LEFT OUTER JOIN     mov_Logistica_Master Lms ON Lms.IdLogistica_Master = Lhs.IdLogistica_Master   ) Blq 	Favor preencher a moeda e o valor da mercadoria.
BLC_BL5_23456	 SELECT   @Acao = CASE WHEN Bloqueado != '' THEN 5 Else 0 END, /* 5 = Bloquear e exibir aviso */    @Mensagem = Bloqueado FROM   (   SELECT     CASE       WHEN Lhs.Situacao_Agenciamento in (2) and  Prm.Situacao_Agenciamento in (3) THEN          CASE           WHEN (Prm.Encaminhado_Por = 0 OR Prm.Encaminhado_Por IS NULL) THEN 'Necessário preencher o campo Encaminhado Por'           WHEN Lms.Data_Embarque Is Null THEN 'Necessário preencher data de embarque'           WHEN Lms.Data_Desembarque Is Null THEN 'Necessário preencher data de desembarque'           WHEN Lms.IdAssociacao_Internacional Is Null THEN 'Necessário preencher a Associação Internacional'           WHEN Awb.AWB_Master_Number Is Null THEN 'Necessário preencher o Número do AWB Master'         ELSE '' END       ELSE ''     END as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdLogistica_Master"][1]/@Value', 'int') as IdLogistica_Master,       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House,       Prm.value('Item[@Nome="Situacao_Agenciamento"][1]/@Value', 'int') as Situacao_Agenciamento,       Prm.value('Item[@Nome="Encaminhado_Por"][1]/@Value', 'int') as Encaminhado_Por     FROM         @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   Left Outer Join     mov_Logistica_Master Lms on Lms.IdLogistica_Master = Prm.IdLogistica_Master   Left Outer Join     mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Prm.IdLogistica_House   Left outer join     mov_Conhecimento_Embarque Cnh ON Cnh.IdLogistica_House  = Lhs.IdLogistica_House   Left Outer Join      mov_Air_waybill Awb ON Awb.IdConhecimento_Embarque = Cnh.IdConhecimento_Embarque     ) Blq 	
BLC_BL5_22840	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* Bloqueado */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Moeda da baixa divergente com a da Conta corrente usada.'     Else NULL   END as VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN (Mfn.IdMoeda <> Cct.IdMoeda) THEN 1       ELSE 0     END as Bit) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdFatura_Financeira_Baixa"][1]/@Value', 'int') as IdFatura_Financeira_Baixa,       Prm.value('Item[@Nome="IdMovimentacao_Financeira"][1]/@Value', 'int') as IdMovimentacao_Financeira,       Prm.value('Item[@Nome="IdMoeda"][1]/@Value', 'int') as IdMoeda     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     )Prm LEFT OUTER JOIN   mov_Movimentacao_Financeira Mfn ON Mfn.IdMovimentacao_Financeira = Prm.IdMovimentacao_Financeira LEFT OUTER JOIN   cad_Conta_Corrente Cct ON Cct.IdConta_Corrente = Mfn.IdConta_Corrente ) Blq 	Moeda da baixa divergente com a da Conta corrente usada.
BLC_23946	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Não é possível diminuir o Lucro estimado do processo!'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT     CAST(CASE       WHEN (Prm.Lucro_Estimado < Lmd.Lucro_Estimado) THEN 1       ELSE 0     END as Bit) as Bloqueado   FROM   (     SELECT       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House,       Prm.value('Item[@Nome="Lucro_Estimado"][1]/@Value', 'numeric') as Lucro_Estimado     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   JOIN      mov_Logistica_Moeda Lmd ON Lmd.IdLogistica_House = Prm.IdLogistica_House AND Lmd.IdMoeda = 110 ) Blq 	Não é possível diminuir o Lucro estimado do processo!
BLC_BL5_NAO_APROVA_PROPOSTA_DATA_VALIDADE_VENCIDA	 SELECT     @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Atenção: data de validade vencida, você não pode aprovar esta proposta.'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT     CAST(CASE       WHEN Prm.Data_Validade < GETDATE() And Prm.Situacao = 2 THEN 1       Else 0     END as Int) as Bloqueado   FROM   (     SELECT       Prm.value('Item[@Nome="IdOferta_Frete"][1]/@Value', 'int') as IdOferta_Frete,       Prm.value('Item[@Nome="IdProposta_Frete"][1]/@Value', 'int') as IdProposta_Frete,       Prm.value('Item[@Nome="Situacao"][1]/@Value', 'int') as Situacao,       Prm.value('Item[@Nome="Data_Validade"][1]/@Value', 'DateTime') as Data_Validade     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm  JOIN mov_Oferta_Frete Ofr ON Ofr.IdOferta_Frete = Prm.IdOferta_Frete  LEFT OUTER JOIN mov_Proposta_Frete Pfr ON Pfr.IdProposta_Frete = Prm.IdProposta_Frete ) Blq 	Atenção: data de validade vencida, você não pode aprovar esta proposta.
BLC_ANDRE_TESTES	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /*Bloqueado*/     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Não é possível alterar dados da fatura posterior sua "Conferência" / "Finalização".'     Else NULL   END AS VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN ( Lft.Conferido_Operacional = 1) /*titulo/conferido operacional*/ AND          (COALESCE(Ltx.IdMoeda_Pagamento,0) <> COALESCE(Prm.IdMoeda_Pagamento,0) OR          COALESCE(Ltx.IdTaxa_Logistica_Exibicao,0) <> COALESCE(Prm.IdTaxa_Logistica_Exibicao,0) OR         COALESCE(Ltx.IdTaxa_Logistica_Classificacao,0) <> COALESCE(Prm.IdTaxa_Logistica_Classificacao,0) OR         COALESCE(Ltx.IdMoeda_Recebimento,0) <> COALESCE(Prm.IdMoeda_Recebimento,0) OR         COALESCE(Ltx.IdPessoa_Pagamento,0) <> COALESCE(Prm.IdPessoa_Pagamento,0) OR         COALESCE(Ltx.IdPessoa_Recebimento,0) <> COALESCE(Prm.IdPessoa_Recebimento,0) OR         COALESCE(Ltx.IdConta_Pagamento,0) <> COALESCE(Prm.IdConta_Pagamento,0) OR         COALESCE(Ltx.IdEquipamento_Maritimo,0) <> COALESCE(Prm.IdEquipamento_Maritimo,0) OR         COALESCE(Ltx.IdConhecimento_Embarque,0) <> COALESCE(Prm.IdConhecimento_Embarque,0) OR         COALESCE(Ltx.IdRegistro_Pagamento,0) <> COALESCE(Prm.IdRegistro_Pagamento,0) OR         COALESCE(Ltx.IdRegistro_Recebimento,0) <> COALESCE(Prm.IdRegistro_Recebimento,0) OR         COALESCE(Ltx.Tipo_Servico,0) <> COALESCE(Prm.Tipo_Servico,0) OR         COALESCE(Ltx.Tipo_Pagamento,0) <> COALESCE(Prm.Tipo_Pagamento,0) OR         COALESCE(Ltx.Modalidade_Recebimento,0) <> COALESCE(Prm.Modalidade_Recebimento,0) OR         COALESCE(Ltx.Modalidade_Pagamento,0) <> COALESCE(Prm.Modalidade_Pagamento,0) OR         COALESCE(Ltx.Forma_Faturamento_Pagamento,0) <> COALESCE(Prm.Forma_Faturamento_Pagamento,0) OR         COALESCE(Ltx.Forma_Faturamento_Recebimento,0) <> COALESCE(Prm.Forma_Faturamento_Recebimento,0) OR         COALESCE(Ltx.Receber_De,0) <> COALESCE(Prm.Receber_De,0) OR         COALESCE(Ltx.Pagar_Para,0) <> COALESCE(Prm.Pagar_Para,0) OR         COALESCE(Ltx.IdConhecimento_Embarque_Master,0) <> COALESCE(Prm.IdConhecimento_Embarque_Master,0) OR         COALESCE(Ltx.Tipo_Recebimento,0) <> COALESCE(Prm.Tipo_Recebimento,0) OR         COALESCE(Ltx.Origem_Taxa,0) <> COALESCE(Prm.Origem_Taxa,0) OR         COALESCE(Ltx.Categoria,0) <> COALESCE(Prm.Categoria,0) OR         COALESCE(Ltx.Complemento,'') <> COALESCE(Prm.Complemento,'') OR         COALESCE(Ltx.Data_Validade,'') <> COALESCE(Prm.Data_Validade,'') OR         COALESCE(Ltx.Exibir_Cliente,0) <> COALESCE(Prm.Exibir_Cliente,0) OR         COALESCE(Ltx.Exibir_Agente,0) <> COALESCE(Prm.Exibir_Agente,0) OR         COALESCE(Ltx.Exibir_Conhecimento,0) <> COALESCE(Prm.Exibir_Conhecimento,0) OR         COALESCE(Ltx.Quantidade_Pagamento,0) <> COALESCE(Prm.Quantidade_Pagamento,0) OR         COALESCE(Ltx.Valor_Pagamento_Unitario,0) <> COALESCE(Prm.Valor_Pagamento_Unitario,0) OR         COALESCE(Ltx.Valor_Pagamento_Minimo,0) <> COALESCE(Prm.Valor_Pagamento_Minimo,0) OR         COALESCE(Ltx.Valor_Pagamento_Total,0) <> COALESCE(Prm.Valor_Pagamento_Total,0) OR         COALESCE(Ltx.Quantidade_Recebimento,0) <> COALESCE(Prm.Quantidade_Recebimento,0) OR         COALESCE(Ltx.Valor_Recebimento_Unitario,0) <> COALESCE(Prm.Valor_Recebimento_Unitario,0) OR         COALESCE(Ltx.Valor_Recebimento_Minimo,0) <> COALESCE(Prm.Valor_Recebimento_Minimo,0) OR         COALESCE(Ltx.Valor_Recebimento_Total,0) <> COALESCE(Prm.Valor_Recebimento_Total,0)) THEN 1       Else 0     END As int) as Bloqueado   FROM   (SELECT     Prm.value('Item[@Nome="IdLogistica_Taxa"][1]/@Value', 'int') AS IdLogistica_Taxa,     Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') AS IdLogistica_House,     Prm.value('Item[@Nome="IdTaxa_Logistica_Exibicao"][1]/@Value', 'int') AS IdTaxa_Logistica_Exibicao,     Prm.value('Item[@Nome="IdTaxa_Logistica_Classificacao"][1]/@Value', 'int') AS IdTaxa_Logistica_Classificacao,     Prm.value('Item[@Nome="IdMoeda_Pagamento"][1]/@Value', 'int') AS IdMoeda_Pagamento,     Prm.value('Item[@Nome="IdMoeda_Recebimento"][1]/@Value', 'int') AS IdMoeda_Recebimento,     Prm.value('Item[@Nome="IdPessoa_Pagamento"][1]/@Value', 'int') AS IdPessoa_Pagamento,     Prm.value('Item[@Nome="IdPessoa_Recebimento"][1]/@Value', 'int') AS IdPessoa_Recebimento,     Prm.value('Item[@Nome="IdConta_Pagamento"][1]/@Value', 'int') AS IdConta_Pagamento,     Prm.value('Item[@Nome="IdEquipamento_Maritimo"][1]/@Value', 'int') AS IdEquipamento_Maritimo,     Prm.value('Item[@Nome="IdRegistro_Pagamento"][1]/@Value', 'int') AS IdRegistro_Pagamento,     Prm.value('Item[@Nome="IdRegistro_Recebimento"][1]/@Value', 'int') AS IdRegistro_Recebimento,     Prm.value('Item[@Nome="IdConhecimento_Embarque"][1]/@Value', 'int') AS IdConhecimento_Embarque,     Prm.value('Item[@Nome="Tipo_Servico"][1]/@Value', 'int') AS Tipo_Servico,     Prm.value('Item[@Nome="Tipo_Pagamento"][1]/@Value', 'int') AS Tipo_Pagamento,     Prm.value('Item[@Nome="Modalidade_Recebimento"][1]/@Value', 'int') AS Modalidade_Recebimento,     Prm.value('Item[@Nome="Modalidade_Pagamento"][1]/@Value', 'int') AS Modalidade_Pagamento,     Prm.value('Item[@Nome="Forma_Faturamento_Pagamento"][1]/@Value', 'int') AS Forma_Faturamento_Pagamento,     Prm.value('Item[@Nome="Forma_Faturamento_Recebimento"][1]/@Value', 'int') AS Forma_Faturamento_Recebimento,     Prm.value('Item[@Nome="Receber_De"][1]/@Value', 'int') AS Receber_De,     Prm.value('Item[@Nome="Pagar_Para"][1]/@Value', 'int') AS Pagar_Para,     Prm.value('Item[@Nome="IdConhecimento_Embarque_Master"][1]/@Value', 'int') AS IdConhecimento_Embarque_Master,     Prm.value('Item[@Nome="Tipo_Recebimento"][1]/@Value', 'int') AS Tipo_Recebimento,     Prm.value('Item[@Nome="Origem_Taxa"][1]/@Value', 'int') AS Origem_Taxa,     Prm.value('Item[@Nome="Categoria"][1]/@Value', 'int') AS Categoria,     Prm.value('Item[@Nome="Complemento"][1]/@Value', 'varchar') AS Complemento,     Prm.value('Item[@Nome="Data_Validade"][1]/@Value', 'Date') AS Data_Validade,     Prm.value('Item[@Nome="Exibir_Cliente"][1]/@Value', 'int') AS Exibir_Cliente,     Prm.value('Item[@Nome="Exibir_Agente"][1]/@Value', 'int') AS Exibir_Agente,     Prm.value('Item[@Nome="Exibir_Conhecimento"][1]/@Value', 'int') AS Exibir_Conhecimento,     Prm.value('Item[@Nome="Exibir_Conhecimento"][1]/@Value', 'int') AS Alterada,     Prm.value('Item[@Nome="Quantidade_Pagamento"][1]/@Value', 'float') AS Quantidade_Pagamento,     Prm.value('Item[@Nome="Quantidade_Recebimento"][1]/@Value', 'float') AS Quantidade_Recebimento,     Prm.value('Item[@Nome="Valor_Pagamento_Unitario"][1]/@Value', 'float') AS Valor_Pagamento_Unitario,     Prm.value('Item[@Nome="Valor_Pagamento_Minimo"][1]/@Value', 'float') AS Valor_Pagamento_Minimo,     Prm.value('Item[@Nome="Valor_Pagamento_Total"][1]/@Value', 'float') AS Valor_Pagamento_Total,     Prm.value('Item[@Nome="Valor_Recebimento_Unitario"][1]/@Value', 'float') AS Valor_Recebimento_Unitario,     Prm.value('Item[@Nome="Valor_Recebimento_Minimo"][1]/@Value', 'float') AS Valor_Recebimento_Minimo,     Prm.value('Item[@Nome="Valor_Recebimento_Total"][1]/@Value', 'float') AS Valor_Recebimento_Total   FROM     @Parametros.nodes('/Parametros/Evento/Campos') AS Parametros(Prm)   ) Prm LEFT OUTER JOIN   mov_Logistica_Taxa Ltx ON Ltx.IdLogistica_Taxa = Prm.IdLogistica_Taxa LEFT OUTER JOIN   mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Ltx.IdRegistro_Pagamento OR Ffn.IdRegistro_Financeiro = Ltx.IdRegistro_Recebimento LEFT OUTER JOIN   mov_Logistica_Fatura Lft ON Lft.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro ) Blq 	Não é possível alterar dados da fatura posterior sua "Conferência" / "Finalização".
BLC_BL5_CAMPOS_OBRIGATORIOS_APROVACAO_OFERTA	 SELECT   @Acao = CASE     WHEN Bloqueado BETWEEN 1 AND 6 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Favor preencher o campo Mercadoria.'     WHEN Bloqueado = 2 THEN 'Favor cadastrar as Taxas de pagamento e recebimento.'     WHEN Bloqueado = 3 THEN 'Favor preencher o campo Quantidade de volumes.'     WHEN Bloqueado = 4 THEN 'Favor preencher o campo Tipo de serviço.'     WHEN Bloqueado = 5 THEN 'Favor preencher o campo Nível de serviço.'     WHEN Bloqueado = 6 THEN 'Favor preencher o campo Tipo de processo.'   END AS VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN Prm.Situacao = 2 AND Pfc.IdMercadoria IS NULL THEN 1       WHEN Prm.Situacao = 2 AND NOT EXISTS (SELECT 1 FROM mov_Oferta_Frete_Taxa WHERE (Pagar_Para IS NOT NULL AND Receber_De IS NOT NULL) AND IdOferta_Frete = Oft.IdOferta_Frete) THEN 2       WHEN Prm.Situacao = 2 AND Pfc.Tipo_Carga IN(1,4) AND Pfc.Quantidade_Volumes IS NULL THEN 3       WHEN Prm.Situacao = 2 AND Ofr.Modalidade_Processo = 1 AND Ofr.Tipo_Servico IS NULL THEN 4       WHEN Prm.Situacao = 2 AND Ofr.Modalidade_Processo = 1 AND Ofr.IdNivel_Servico_Aereo IS NULL THEN 5       WHEN Prm.Situacao = 2 AND Ofr.Modalidade_Processo = 1 AND Ofr.IdNivel_Servico_Aereo = 1 AND Ofr.IdTipo_Processo IS NULL THEN 6       Else 0     END AS Int) AS Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdOferta_Frete"][1]/@Value', 'int') AS IdOferta_Frete,       Prm.value('Item[@Nome="IdProposta_Frete"][1]/@Value', 'int') AS IdProposta_Frete,       Prm.value('Item[@Nome="Situacao"][1]/@Value', 'int') AS Situacao     FROM       @Parametros.nodes('/Parametros/Evento/Campos') AS Parametros(Prm)   ) Prm  JOIN    mov_Oferta_Frete Ofr ON Ofr.IdOferta_Frete = Prm.IdOferta_Frete  LEFT OUTER JOIN    mov_Proposta_Frete Pfr ON Pfr.IdProposta_Frete = Prm.IdProposta_Frete  LEFT OUTER JOIN    mov_Proposta_Frete_Carga Pfc ON Pfc.IdProposta_Frete = Pfr.IdProposta_Frete  LEFT OUTER JOIN    mov_Oferta_Frete_Taxa Oft ON Oft.IdOferta_Frete = Ofr.IdOferta_Frete  ) Blq 	Favor preencher o campo Mercadoria.
BLC_BL5_NAO_ABRE_PROCESSO_SEM_AGENTE_MASTER_DIRETO	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Não é possível abrir processo sem Agente exterior.'     Else NULL   END as VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN Prm.IdLogistica_Master IS NOT NULL AND Lms.Master_Direto = 0 THEN 1       Else 0     END as INT) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdLogistica_Master"][1]/@Value', 'int') as IdLogistica_Master     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN   mov_Logistica_Master Lms ON Lms.IdLogistica_Master = Prm.IdLogistica_Master ) Blq 	Não é possível abrir processo sem Agente exterior.
ZBL5_DATA_EMBARQUE_MENOS_DATA_HOJE	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /*Bloqueio*/     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Data de Embarque menor que Data atual. Favor verificar.'     Else NULL   END as VARCHAR(MAX)) FROM     (     SELECT         CAST(CASE             WHEN Prm.Data_Embarque < (GETDATE()-1)  THEN 1             Else 0         END as Int) as Bloqueado     FROM         (     SELECT         Prm.value('Item[@Nome="IdLogistica_Master"][1]/@Value', 'int') as IdLogistica_Master,         Prm.value('Item[@Nome="Data_Embarque"][1]/@Value', 'Date') as Data_Embarque     FROM         @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   JOIN      mov_Logistica_Master Lms ON Lms.IdLogistica_Master = Prm.IdLogistica_Master   Left Outer JOIN      mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Prm.IdLogistica_Master ) Blq 	Data de Embarque menor que Data atual. Favor verificar.
BLC_BL5_25393	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'QUALÉ RAPAZEADA!!!'     Else NULL   END as VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN (Prm.Tipo = 1 AND Ffn.Tipo = 2) THEN 1       Else 0     END as Bit) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdFatura_Financeira"][1]/@Value', 'int') as IdFatura_Financeira,       Prm.value('Item[@Nome="Tipo"][1]/@Value', 'int') as Tipo     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN   mov_Fatura_Financeira Ffn ON Ffn.IdFatura_Financeira = Prm.IdFatura_Financeira ) Blq 	QUALÉ RAPAZEADA!!!
BLC_BL5_NAO_LANCA_COMISSAO_ABA_TAXAS	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Não é permitido lançar comissão na aba de taxas.'     Else NULL   END as VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN (Prm.IdLogistica_Taxa IS NOT NULL)  AND (Lcm.IdLogistica_Comissao IS NULL) THEN 1       Else 0     END as Bit) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdLogistica_Taxa"][1]/@Value', 'int') as IdLogistica_Taxa,       Prm.value('Item[@Nome="IdTaxa_Logistica_Exibicao"][1]/@Value', 'int') as IdTaxa_Logistica_Exibicao,       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House,       Prm.value('Item[@Nome="IdPessoa_Pagamento"][1]/@Value', 'int') as IdPessoa_Pagamento     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN     mov_Logistica_Taxa Ltx On Ltx.IdLogistica_Taxa = Prm.IdLogistica_Taxa LEFT OUTER JOIN   cad_Taxa_Logistica_Exibicao Tle On Tle.IdTaxa_Logistica_Exibicao = Prm.IdTaxa_Logistica_Exibicao LEFT OUTER JOIN   cad_Taxa_Logistica Tlg On Tlg.IdTaxa_Logistica = Tle.IdTaxa_Logistica LEFT OUTER JOIN   mov_Logistica_Comissao Lcm On Lcm.IdLogistica_House = Prm.IdLogistica_House And Lcm.IdPessoa = Prm.IdPessoa_Pagamento ) Blq 	Não é permitido lançar comissão na aba de taxas.
Z_MAX_TESTE	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 2 /* apenas exibe aviso */     ELSE 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'LIMITE EXCEDIDO'     ELSE NULL   END AS VARCHAR(MAX)) FROM   (SELECT     CAST(CASE     WHEN (Prm.IdFatura_Financeira_Baixa IS NOT NULL)        AND ((COALESCE(Pcl.Valor_Real4, 0) - COALESCE(SUM(Ttl.Total_Receber), 0)) < 0) THEN 1     ELSE 0     END AS BIT) as Bloqueado   FROM     (SELECT       Prm.value('Item[@Nome="IdFatura_Financeira_Baixa"][1]/@Value', 'int') as IdFatura_Financeira_Baixa,       Prm.value('Item[@Nome="IdFatura_Financeira"][1]/@Value', 'int') as IdFatura_Financeira     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm   LEFT OUTER JOIN     mov_Fatura_Financeira_Baixa Ffb On Ffb.IdFatura_Financeira_Baixa = Prm.IdFatura_Financeira_Baixa   JOIN     mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = COALESCE(Ffb.IdFatura_Financeira, Prm.IdFatura_Financeira)   JOIN     vis_Logistica_Fatura Lft On Lft.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro   JOIN     mov_Logistica_House Lhs On Lhs.IdLogistica_House = Lft.IdLogistica_House   JOIN     vis_Cliente Cln On Cln.IdPessoa = Lhs.IdCliente   JOIN     vis_Pessoa_Campo_Livre Pcl ON Pcl.IdPessoa = Cln.IdPessoa       AND Pcl.IdConfiguracao_Campo_Livre = 153   JOIN     (SELECT       Lhs.IdCliente,       MAX(COALESCE(Spg.Pagamento_Quitado, 0)) AS Pagamento_Quitado,       SUM(Trc.Total_Receber) AS Total_Receber     FROM       mov_Logistica_House Lhs     LEFT OUTER JOIN       (SELECT         Lft.IdLogistica_House,         MAX(CASE            WHEN Ffn.Situacao = 2 THEN 1           ELSE 0         END) AS Pagamento_Quitado       FROM         vis_Logistica_Fatura Lft       JOIN         mov_Logistica_House Lhs On Lhs.IdLogistica_House = Lft.IdLogistica_House       JOIN         mov_Logistica_Master Lms On Lms.IdLogistica_Master = Lhs.IdLogistica_Master           AND Lms.IdCompanhia_Transporte = Lft.IdPessoa       JOIN         mov_Fatura_Financeira Ffn On Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro       GROUP BY         Lft.IdLogistica_House       ) Spg ON Spg.IdLogistica_House = Lhs.IdLogistica_House     LEFT OUTER JOIN       (SELECT         Trc.IdLogistica_House,         SUM(Trc.Valor_Residual_Corrente) As Total_Receber       FROM         vis_Logistica_Fatura_Totais Trc       JOIN         mov_Logistica_House Lhs On Lhs.IdLogistica_House = Trc.IdLogistica_House           AND Lhs.IdCliente = Trc.IdPessoa       GROUP BY         Trc.IdLogistica_House       ) Trc ON Trc.IdLogistica_House = Lhs.IdLogistica_House     GROUP BY       Lhs.IdCliente,       Lhs.IdLogistica_House     ) Ttl ON Ttl.IdCliente = Cln.IdPessoa       AND Ttl.Pagamento_Quitado = 1   GROUP BY     Prm.IdFatura_Financeira_Baixa,     Pcl.Valor_Real4   ) Blq 	LIMITE EXCEDIDO
Z_FLAUVI_OLD	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Não é possível gerar proposta sem transit time preenchido.'     Else NULL   END as VARCHAR(MAX)) FROM     (     SELECT         CAST(CASE             WHEN                  Prm.IdOferta_Frete IS NOT NULL and Ofr.Transit_Time IS NULL THEN 1             Else 0         END as Bit) as Bloqueado     FROM         (     SELECT         Prm.value('Item[@Nome="IdProposta_Frete"][1]/@Value', 'int') as IdProposta_Frete,         Prm.value('Item[@Nome="IdOferta_Frete"][1]/@Value', 'int') as IdOferta_Frete     FROM         @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   LEFT OUTER JOIN mov_Proposta_Frete Pfr ON Pfr.IdProposta_Frete = Prm.IdProposta_Frete   LEFT OUTER JOIN mov_Oferta_Frete Ofr On Ofr.IdOferta_Frete = Prm.IdOferta_Frete ) Blq 	Não é possível gerar proposta sem transit time preenchido.
Z_BLOQUEIO_ALT_VENDEDOR_CRM	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN ' Você não tem permissão para realizar esta alteração. Favor solicitar ao administrador.'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT     CAST(CASE          WHEN (Prm.IdVendedor_Responsavel <> Cli.IdVendedor_Responsavel) AND Cli.IdVendedor_Responsavel IS NOT NULL THEN 1          WHEN Prm.IdVendedor_Responsavel IS NULL AND Cli.IdVendedor_Responsavel IS NOT NULL THEN 1       Else 0     END as INT) as Bloqueado   FROM   (        SELECT       Prm.value('Item[@Nome="IdPessoa"][1]/@Value', 'int') as IdPessoa,       Prm.value('Item[@Nome="IdVendedor_Responsavel"][1]/@Value', 'int') as IdVendedor_Responsavel     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN  cad_Cliente Cli on Cli.IdPessoa = Prm.IdPessoa ) Blq 	 Você não tem permissão para realizar esta alteração. Favor solicitar ao administrador.
Z_BLC_5_N_APROV_OFERTA_S_DATA_VIGENCIA	 SELECT   @Acao = CASE       WHEN Bloqueado = 1 THEN 5 /* bloqueia */       Else 0     END,   @Mensagem = CAST(CASE       WHEN Bloqueado = 1 THEN '#BC24 - Não é possível lançar uma Rota sem transit times e datas preenchidos.'       Else NULL     END as VARCHAR(MAX)) FROM   (   SELECT     CAST(CASE       WHEN          Prm.IdOferta_Frete IS NOT NULL          AND (Prm.Data_Inicio_Vigencia IS NULL) Then 1       ELSE 0     END as Int) as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdProposta_Frete"][1]/@Value', 'int') as IdOferta_Frete,       Prm.value('Item[@Nome="Data_Inicio_Vigencia"][1]/@Value', 'Date') as Data_Inicio_Vigencia,       Prm.value('Item[@Nome="Data_Validade"][1]/@Value', 'Date') as Data_Validade     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm LEFT OUTER JOIN mov_Oferta_Frete Ofr On Ofr.IdOferta_Frete = Prm.IdOferta_Frete LEFT OUTER JOIN mov_Tarifario_Maritimo Tmr on Tmr.IdTarifario_Maritimo = Prm.IdTarifario_Maritimo   ) Blq 	#BC24 - Não é possível lançar uma Rota sem transit times e datas preenchidos.
BLC_BL5_BLOQUEIA_EQUIPAMENTO_NULL_QUANDO_FCL	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Favor preencher Equipamento no itens de carga do conhecimento.'     Else NULL   END as VARCHAR(MAX)) FROM     (     SELECT         CAST(CASE             WHEN                  (Prm.IdEquipamento_Maritimo IS NULL AND Lhs.Tipo_Carga = 3 /*FCL*/ ) THEN 1             Else 0         END as Bit) as Bloqueado     FROM         (     SELECT         Prm.value('Item[@Nome="IdLogistica_Maritima_Container"][1]/@Value', 'int') as IdLogistica_Maritima_Container,         Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House,         Prm.value('Item[@Nome="IdEquipamento_Maritimo"][1]/@Value', 'int') as IdEquipamento_Maritimo     FROM         @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm JOIN      mov_Logistica_Maritima_Container Lmc ON Lmc.IdLogistica_Maritima_Container = Prm.IdLogistica_Maritima_Container LEFT OUTER JOIN      mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Lmc.IdLogistica_House ) Blq 	Favor preencher Equipamento no itens de carga do conhecimento.
BLC_BL5_26004	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* BLOQUEIA */     Else 0   END,     @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Cliente sem contrato, necessário vincular um para seguir.'     Else NULL   END as VARCHAR(MAX)) FROM   (SELECT     CAST(CASE       WHEN          (Prm.IdProposta_Frete IS NOT NULL) AND (Prm.IdCliente IS NOT NULL) AND (Cli.IdContrato_Financeiro IS NULL) THEN 1       Else 0     END as Bit) as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdProposta_Frete"][1]/@Value', 'int') as IdProposta_Frete,       Prm.value('Item[@Nome="IdOferta_Frete"][1]/@Value', 'int') as IdOferta_Frete,       Prm.value('Item[@Nome="IdCliente"][1]/@Value', 'int') as IdCliente     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm   LEFT OUTER JOIN     mov_Proposta_Frete Pft ON Pft.IdProposta_Frete = Prm.IdProposta_Frete   LEFT OUTER JOIN     mov_Oferta_Frete Oft ON Oft.IdOferta_Frete = Prm.IdOferta_Frete   LEFT OUTER JOIN     vis_Cliente Cli ON Cli.IdPessoa = Prm.IdCliente   ) Blq 	Cliente sem contrato, necessário vincular um para seguir.
BL5_IMPEDE_ALTERACAO_DE_VENDEDOR_E_FUNCIONARIO_CLI	 SELECT   @Acao = CASE     WHEN Bloqueado IN (1, 2) THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN 'Você não tem permissão para alterar o Vendedor Responsável. Favor solicitar ao administrador.'     WHEN Bloqueado = 2 THEN 'Você não tem permissão para alterar o Funcionário Responsável. Favor solicitar ao administrador.'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT     CAST(CASE          WHEN (Cli.IdVendedor_Responsavel IS NOT NULL) AND (COALESCE(Prm.IdVendedor_Responsavel, 0) <> COALESCE(Cli.IdVendedor_Responsavel, 0)) THEN 1          WHEN (Cli.IdFuncionario_Responsavel IS NOT NULL) AND (COALESCE(Prm.IdFuncionario_Responsavel, 0) <> COALESCE(Cli.IdFuncionario_Responsavel, 0)) THEN 2       Else 0     END as INT) as Bloqueado   FROM   (     SELECT       Prm.value('Item[@Nome="IdPessoa"][1]/@Value', 'int') as IdPessoa,       Prm.value('Item[@Nome="IdVendedor_Responsavel"][1]/@Value', 'int') as IdVendedor_Responsavel,       Prm.value('Item[@Nome="IdFuncionario_Responsavel"][1]/@Value', 'int') as IdFuncionario_Responsavel     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN  cad_Cliente Cli on Cli.IdPessoa = Prm.IdPessoa ) Blq 	Você não tem permissão para alterar o Vendedor Responsável. Favor solicitar ao administrador.
Z_BLC_5_N_CONFERI_DESCONFERI_FATURAS	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueia e exibe aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN '[BLC018] Você não tem permissão para conferir/desconferir faturas.'     Else NULL   END as VARCHAR(MAX)) FROM   (   SELECT     CAST(CASE       WHEN Prm.IdRegistro_Financeiro IS NOT NULL AND Lft.Tipo_Fatura = 3 AND  (Prm.Conferido_Operacional = 0 AND Lft.Conferido_Operacional = 1 /*DESCONFERIR*/) THEN 1       WHEN Prm.IdRegistro_Financeiro IS NOT NULL AND Lft.Tipo_Fatura = 3 AND  (Prm.Conferido = 0 AND Ffn.Conferido = 1 /*DESCONFERIR*/) THEN 1       ELSE 0      END as Bit) as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdRegistro_Financeiro"][1]/@Value', 'int') as IdRegistro_Financeiro,       Prm.value('Item[@Nome="Conferido_Operacional"][1]/@Value', 'int') as Conferido_Operacional,       Prm.value('Item[@Nome="Conferido"][1]/@Value', 'int') as Conferido      FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm   JOIN     mov_Logistica_Fatura Lft ON Lft.IdRegistro_Financeiro = Prm.IdRegistro_Financeiro   JOIN     mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Prm.IdRegistro_Financeiro   ) Blq 	[BLC018] Você não tem permissão para conferir/desconferir faturas.
Z_BLC_5_N_CONFERI_DESCONFERI_FATURAS	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueia e exibe aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN '[BLC018] Você não tem permissão para conferir/desconferir faturas.'     Else NULL   END as VARCHAR(MAX)) FROM   (   SELECT     CAST(CASE       WHEN Prm.IdRegistro_Financeiro IS NOT NULL AND Lft.Tipo_Fatura = 3 AND  (Prm.Conferido_Operacional = 0 AND Lft.Conferido_Operacional = 1 /*DESCONFERIR*/) THEN 1       WHEN Prm.IdRegistro_Financeiro IS NOT NULL AND Lft.Tipo_Fatura = 3 AND  (Prm.Conferido = 0 AND Ffn.Conferido = 1 /*DESCONFERIR*/) THEN 1       ELSE 0      END as Bit) as Bloqueado   FROM     (     SELECT       Prm.value('Item[@Nome="IdRegistro_Financeiro"][1]/@Value', 'int') as IdRegistro_Financeiro,       Prm.value('Item[@Nome="Conferido_Operacional"][1]/@Value', 'int') as Conferido_Operacional,       Prm.value('Item[@Nome="Conferido"][1]/@Value', 'int') as Conferido      FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)     ) Prm   JOIN     mov_Logistica_Fatura Lft ON Lft.IdRegistro_Financeiro = Prm.IdRegistro_Financeiro   JOIN     mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Prm.IdRegistro_Financeiro   ) Blq 	[BLC018] Você não tem permissão para conferir/desconferir faturas.
Z_BL5_24321_1	 SELECT   CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END as Acao,   CAST(CASE     WHEN Bloqueado = 1 THEN Mensagem     Else NULL   END as VARCHAR(MAX)) as Mensagem FROM (   SELECT     CAST(CASE WHEN      Prm.IdCampo_Livre IS NOT NULL AND Prm.IdConfiguracao_Campo_Livre = 172            /* Estou alterando o campo livre */         AND EXISTS              (SELECT TOP 1 1              FROM vis_Oferta_Frete_Campo_Livre Ofc             WHERE Ofc.IdCampo_Livre = Prm.IdCampo_Livre          AND Ofc.IdOferta_Frete = Ofr.IdOferta_Frete          AND Prm.Valor_Boleano  <> Ofc.Valor_Boleano)                  AND      (       /* Vendedor não está na lista */       Pfr.IdVendedor NOT IN(48256, 54505)         /*Ou Local coleta vazio */       OR COALESCE(Ofr.Local_Coleta, '') LIKE ''        /*Ou sem valor de alguma mercadoria */       OR EXISTS (SELECT TOP 1 1         FROM mov_Proposta_Frete_Carga Pfc         WHERE Pfc.IdProposta_Frete = Pfr.IdProposta_Frete AND COALESCE(Pfc.Valor_Mercadoria, 0) = 0)     )         THEN 1              ELSE 0     END as Bit) as Bloqueado,     '[#NOME DO BLOQUEIO] Confirmar com cliente e preencher o valor da mercadoria para cotação da coleta!' as Mensagem   FROM   (     SELECT       Prm.value('Item[@Nome="IdCampo_Livre"][1]/@Value', 'int') as IdCampo_Livre,       Prm.value('Item[@Nome="IdConfiguracao_Campo_Livre"][1]/@Value', 'int') as IdConfiguracao_Campo_Livre,       Prm.value('Item[@Nome="Valor_Boleano"][1]/@Value', 'bit') as Valor_Boleano     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)        ) Prm   LEFT OUTER JOIN     vis_Oferta_Frete_Campo_Livre Ofc ON Ofc.IdCampo_Livre = Prm.IdCampo_Livre   LEFT OUTER JOIN      mov_Oferta_Frete Ofr ON Ofr.IdOferta_Frete = Ofc.IdOferta_Frete   LEFT OUTER JOIN      mov_Proposta_Frete Pfr ON Pfr.IdProposta_Frete = Ofr.IdProposta_Frete ) Blq 	
Teste 12	SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN ' Você não tem permissão para realizar esta alteração. Favor solicitar ao administrador.'     Else NULL   END as VARCHAR(MAX)) FROM (   SELECT     CAST(CASE          WHEN (Prm.IdVendedor_Responsavel <> Cli.IdVendedor_Responsavel) AND Cli.IdVendedor_Responsavel IS NOT NULL THEN 1          WHEN Prm.IdVendedor_Responsavel IS NULL AND Cli.IdVendedor_Responsavel IS NOT NULL THEN 1       Else 0     END as INT) as Bloqueado   FROM   (        SELECT       Prm.value('Item[@Nome="IdPessoa"][1]/@Value', 'int') as IdPessoa,       Prm.value('Item[@Nome="IdVendedor_Responsavel"][1]/@Value', 'int') as IdVendedor_Responsavel     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm LEFT OUTER JOIN  cad_Cliente Cli on Cli.IdPessoa = Prm.IdPessoa ) Blq 	 Você não tem permissão para realizar esta alteração. Favor solicitar ao administrador.
Z_BL5_24321_2	 SELECT   @Acao = CASE     WHEN Bloqueado = 1 THEN 5 /* bloqueado exibir aviso */     Else 0   END,   @Mensagem = CAST(CASE     WHEN Bloqueado = 1 THEN Mensagem     Else NULL   END as VARCHAR(MAX)) FROM     (     SELECT         CAST(CASE             WHEN                  Prm.IdOferta_Frete IS NOT NULL AND Prm.Situacao = 2                  /*Vendedor é da lista */                 AND Pfr.IdVendedor IN(48256, 54505)       /*custo = AD-VALOREM 73 pois na pancaldisoft é  73*/                 AND EXISTS( SELECT TOP 1 1                                        FROM mov_Oferta_frete_taxa Oft                                       WHERE Oft.IdOferta_frete = Prm.IdOferta_Frete AND Oft.IdTaxa_Logistica_Exibicao = 73)                   /*Alguma carga não tiver o valor mercadoria preenchido*/  AND EXISTS (SELECT TOP 1 1                                      FROM mov_Proposta_Frete_Carga Pfc                                      WHERE Pfc.IdProposta_Frete = Pfr.IdProposta_Frete AND COALESCE(Pfc.Valor_Mercadoria, 0) = 0)                                               THEN 1             Else 0         END as Bit) as Bloqueado,         '[NOME_BLOQUEIO] Confirmar com cliente e preencher o valor da mercadoria para cálculo de ad valorem!' as Mensagem     FROM         (     SELECT         Prm.value('Item[@Nome="IdOferta_Frete"][1]/@Value', 'int') as IdOferta_Frete         Prm.value('Item[@Nome="Situacao"][1]/@Value', 'int') as Situacao     FROM         @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   LEFT OUTER JOIN mov_Oferta_Frete Ofr On Ofr.IdOferta_Frete = Prm.IdOferta_Frete   LEFT OUTER JOIN mov_Proposta_Frete Pfr ON Pfr.IdProposta_Frete = Ofr.IdProposta_Frete ) Blq 	[NOME_BLOQUEIO] Confirmar com cliente e preencher o valor da mercadoria para cálculo de ad valorem!
Z_MAX_TESTE	 SELECT    @Acao = CASE WHEN Bloqueado = 1 THEN 5 ELSE 0 END,   @Mensagem = CASE WHEN Bloqueado = 1 THEN Mensagem ELSE NULL END FROM (   SELECT      CASE        WHEN          Lcl.Identificador = 'Currier_Recebido'         AND Lcl.Valor_Boleano = 1         AND COALESCE(Lhs.Numero_Courrier, '') = ''      THEN 1      ELSE 0      END as Bloqueado,     'Preencha o Numero Courrier' as Mensagem   FROM   (     SELECT       Prm.value('Item[@Nome="IdCampo_Livre"][1]/@Value', 'int') as IdCampo_Livre,       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   JOIN     mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Prm.IdLogistica_House   JOIN     vis_Logistica_Campo_livre Lcl ON Lcl.IdCampo_Livre = Prm.IdCampo_Livre ) Bloq 	Currier_Recebido
Z_MAX_TESTE	 SELECT    @Acao = CASE WHEN Bloqueado = 1 THEN 4 ELSE 0 END, /* Solicitar senha */   @Mensagem = CASE WHEN Bloqueado = 1 THEN Mensagem ELSE NULL END FROM (   SELECT      CASE        WHEN          Lcl.Identificador = 'Emissão_Destino'     THEN 1      ELSE 0      END as Bloqueado,     'Digite a senha para alterar o campo.' as Mensagem   FROM   (     SELECT       Prm.value('Item[@Nome="IdCampo_Livre"][1]/@Value', 'int') as IdCampo_Livre,       Prm.value('Item[@Nome="IdLogistica_House"][1]/@Value', 'int') as IdLogistica_House     FROM       @Parametros.nodes('/Parametros/Evento/Campos') as Parametros(Prm)   ) Prm   JOIN     mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Prm.IdLogistica_House   JOIN     vis_Logistica_Campo_livre Lcl ON Lcl.IdCampo_Livre = Prm.IdCampo_Livre ) Bloq 	Emissão_Destino