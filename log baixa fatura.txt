"Group";"Index";"Classificação";"Start date";"End date";"Milliseconds";"Status";"Record count";"Command text";"Parameters"
"45";"130";"";"11/02/2026 13:39:24";"11/02/2026 13:39:24";"26";"OK";"0";"'Select'#13#10'  Ffb.IdFatura_Financeira_Baixa,'#13#10'  Ffb.IdFatura_Financeira,'#13#10'  Ffb.IdMovimentacao_Financeira,'#13#10'  Ffb.Valor_Total,'#13#10'  Ffb.Valor_Multa,'#13#10'  Ffb.Valor_Juros,'#13#10'  Ffb.Valor_Acrescimo,'#13#10'  Ffb.Valor_Desconto,'#13#10'  Ffb.Valor_Abatimento,'#13#10'  Ffb.Valor_Total_Corrente,'#13#10'  Ffb.Valor_Convertido,'#13#10'  Ffb.Fator_Conversao,'#13#10'  Ffb.Tipo_Baixa,'#13#10'  Ffb.Gerar_Recibo,'#13#10'  Ffb.Numero_Recibo,'#13#10'  Ffb.Proveniencia,'#13#10'  Ffb.Observacao,'#13#10'  Ffb.Hash,'#13#10'  Ffb.Data_Ultima_Alteracao,'#13#10'  Mfn.IdConta_Corrente,'#13#10'  Mfn.IdForma_Pagamento,'#13#10'  Mfn.Data,'#13#10'  Mfn.Data_Lancamento,'#13#10'  Mfn.Nota_Recibo_Conferido,'#13#10'  Mfn.Variacao_Cambial,'#13#10'  Ccr.Nome as Conta_Corrente,'#13#10'  Fpg.Nome as Forma_Pagamento,'#13#10'  Ffn.IdRegistro_Financeiro,'#13#10'  Ffn.Numero As Numero_Fatura,'#13#10'  Rfn.IdMoeda,'#13#10'  Mda.Nome as Moeda'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa Ffb'#13#10'Left Outer Join'#13#10'  mov_Movimentacao_Financeira Mfn on Mfn.IdMovimentacao_Financeira = Ffb.IdMovimentacao_Financeira'#13#10'Left Outer Join'#13#10'  cad_Conta_Corrente Ccr on Ccr.IdConta_Corrente = Mfn.IdConta_Corrente'#13#10'Left Outer Join'#13#10'  cad_Forma_Pagamento Fpg on Fpg.IdForma_Pagamento = Mfn.IdForma_Pagamento'#13#10'Left Outer Join'#13#10'  mov_Fatura_Financeira Ffn on Ffn.IdFatura_Financeira = Ffb.IdFatura_Financeira'#13#10'Left Outer Join'#13#10'  mov_Registro_Financeiro Rfn on Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'Left Outer Join'#13#10'  cad_Moeda Mda on Mda.IdMoeda = Rfn.IdMoeda'#13#10'Where'#13#10'  Ffb.IdFatura_Financeira = ?'";"[0]['IdFatura_Financeira']='15849'"
"44";"129";"";"11/02/2026 13:39:24";"11/02/2026 13:39:24";"31";"OK";"1";"'DECLARE @IdUsuario IdCurto, @Opcao_Data TipoFixo, @Data_Inicial Data, @Data_Final Data, @Exibir_Vencidas Boleano, @XML_Faturas Xml, @XML_Filtros Xml SET @IdUsuario = ? SET @Opcao_Data = ? SET @Data_Inicial = ? SET @Data_Final = ? SET @Exibir_Vencidas = ? SET @XML_Faturas = ? SET @XML_Filtros = ? /* SET @IdUsuario = 1 SET @Opcao_Data = 0 SET @Data_Inicial = 0 SET @Data_Final = 0 SET @Exibir_Vencidas = 1 SET @XML_Faturas = '#39'<Parameters><Registro IdFatura_Financeira="336" Hash=""/><Registro IdFatura_Financeira="344" Hash=""/><Registro IdFatura_Financeira="506" Hash="36a76f6eaa184d00cdcf361d16e0aee1"/></Parameters>'#39' SET @XML_Filtros = '#39'<Parameters><Registro IdFatura_Financeira="336"/><Registro IdFatura_Financeira="344"/><Registro IdFatura_Financeira="506"/></Parameters>'#39' */ SELECT Ffn.IdFatura_Financeira, Ffn.IdRegistro_Financeiro, Ffn.IdForma_Cobranca, Ffn.IdResponsavel_Titulo, Ffn.IdResponsavel_Conferencia, Ffn.IdRegistro_Unificador, Ffn.Numero, Ffn.Referencia_Externa, Ffn.Data, Ffn.Tipo, Ffn.Data_Vencimento, DATEDIFF(DAY, GETDATE(), Ffn.Data_Vencimento) As Dias_A_Vencer, Ffn.Previsao_Pagamento, Ffn.Data_Pagamento, Ffn.Situacao, Ffn.Prioridade, Cast(Ffn.Natureza As Smallint) As Natureza, Ffn.Valor, Ffn.Valor_Original, Ffn.Valor_Corrente, Case When Ffn.Natureza = 0 /* Débito */ Then -Ffn.Valor_Residual Else Ffn.Valor_Residual End As Valor_Residual, Ffn.Total_Pago, Ffn.Total_Pago_Corrente, Ffn.Total_Multa, Ffn.Total_Juros, Ffn.Total_Acrescimo, Ffn.Total_Desconto, Ffn.Total_Abatimento, Ffn.Fator_Unificacao, Cast(Ffn.Conferido As Smallint) As Conferido, Ffn.Parcela, Ffn.Numero_Cobranca, Ffn.Numero_Nota_Fiscal, Ffn.Data_Nota_Fiscal, Ffn.Em_Aberto, Ffn.Historico_Resumo, Ffn.Data_Envio, Ffn.Competencia, CAST(Ffn.Ativo AS Smallint) AS Ativo, Ffn.Hash, Ffn.Data_Ultima_Alteracao, Fcb.Nome As Forma_Cobranca, Rtt.Nome As Responsavel_Titulo, Rcn.Nome As Responsavel_Conferencia, Run.Numero As Numero_Registro_Unificador, Rfn.IdTipo_Transacao, Rfn.IdPessoa, Rfn.IdConta_Pessoa, Rfn.IdMoeda, Rfn.IdConta_Corrente, Rfn.IdForma_Pagamento, Rfn.IdConversao_Moeda, Rfn.IdGrupo_Financeiro, Rfn.IdSetor, Rfn.IdEmpresa_Sistema, Rfn.Numero As Numero_Registro, Rfn.Referencia, CAST(Rfn.Registro_Unificador AS Smallint) AS Fatura_Unificadora, Rfn.Origem_Lancamento, Rfn.Instrucao, Rfn.Fator_Corrente, Ttr.Nome As Tipo_Transacao, Psa.Nome As Pessoa, Psa.CPF_CNPJ As Pessoa_CPF_CNPJ, Ccr.Nome As Conta_Corrente, Cps.Nome As Conta_Pessoa, Mda.Sigla As Moeda, Fpg.Nome As Forma_Pagamento, Cpg.Nome As Condicao_Pagamento, Cmd.Nome As Conversao_Moeda, Ade.Nome As Atraves_De, Gfn.Descricao As Grupo_Financeiro, Str.Nome As Setor, Emp.Nome As Empresa_Sistema, Mff.Descricao As Marcador_Fatura_Financeira, Mau.Descricao As Marcador_Auditoria, Case When Rfn.Registro_Unificador = 1 Then Rfn.Numero Else Coalesce(Run.Numero, '#39'(Sem unificação)'#39') End As Agrupamento_Unificacao, Case When Rfn.Registro_Unificador = 1 Then 5 /* Registro unificador */ Else Coalesce(Run.Situacao, 0) End As Situacao_Registro_Unificador, CAST(CAST(COALESCE(Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39'), 0) AS Bit) AS Tinyint) AS Selecionado FROM mov_Fatura_Financeira Ffn LEFT OUTER JOIN cad_Forma_Cobranca Fcb On Fcb.IdForma_Cobranca = Ffn.IdForma_Cobranca LEFT OUTER JOIN vis_Funcionario Rtt On Rtt.IdPessoa = Ffn.IdResponsavel_Titulo LEFT OUTER JOIN vis_Funcionario Rcn On Rcn.IdPessoa = Ffn.IdResponsavel_Conferencia LEFT OUTER JOIN mov_Registro_Financeiro Rfn On Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro LEFT OUTER JOIN cad_Tipo_Transacao Ttr On Ttr.IdTipo_Transacao = Rfn.IdTipo_Transacao LEFT OUTER JOIN cad_Pessoa Psa On Psa.IdPessoa = Rfn.IdPessoa LEFT OUTER JOIN cad_Conta_Corrente Ccr On Ccr.IdConta_Corrente = Rfn.IdConta_Corrente LEFT OUTER JOIN cad_Conta_Corrente Cps On Cps.IdConta_Corrente = Rfn.IdConta_Pessoa LEFT OUTER JOIN cad_Moeda Mda On Mda.IdMoeda = Rfn.IdMoeda LEFT OUTER JOIN cad_Forma_Pagamento Fpg On Fpg.IdForma_Pagamento = Rfn.IdForma_Pagamento LEFT OUTER JOIN cad_Condicao_Pagamento Cpg ON Cpg.IdCondicao_Pagamento = Rfn.IdCondicao_Pagamento LEFT OUTER JOIN cad_Conversao_Moeda Cmd On Cmd.IdConversao_Moeda = Rfn.IdConversao_Moeda LEFT OUTER JOIN cad_Pessoa Ade On Ade.IdPessoa = Rfn.IdAtraves_De LEFT OUTER JOIN sys_Empresa_Sistema Emp On Emp.IdEmpresa_Sistema = Rfn.IdEmpresa_Sistema LEFT OUTER JOIN mov_Registro_Financeiro Run On Run.IdRegistro_Financeiro = Ffn.IdRegistro_Unificador LEFT OUTER JOIN vis_Funcionario Fnc on Fnc.IdUsuario_Correspondente = @IdUsuario LEFT OUTER JOIN cad_Grupo_Financeiro Gfn On Gfn.IdGrupo_Financeiro = Rfn.IdGrupo_Financeiro LEFT OUTER JOIN cad_Setor Str On Str.IdSetor = Rfn.IdSetor LEFT OUTER JOIN cad_Marcador_Fatura_Financeira Mff On Mff.IdMarcador_Fatura_Financeira = Ffn.IdMarcador_Fatura_Financeira LEFT OUTER JOIN cad_Marcador_Fatura_Financeira Mau On Mau.IdMarcador_Fatura_Financeira = Ffn.IdMarcador_Auditoria LEFT OUTER JOIN @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft) ON Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39') = Ffn.IdFatura_Financeira /*where*/ WHERE (((Rfn.IdConta_Corrente Is NULL)'#13#10'OR'#13#10'  (Rfn.IdConta_Corrente IN (56, 32, 36, 33, 4, 8, 53, 54, 68, 63, 62, 92, 83, 97))) and (Ffn.IdFatura_Financeira = 15849)) and ((@Opcao_Data = 0) /* Não Filtrar */ Or (@Opcao_Data = 1 /* Data fatura */ AND Ffn.Data BETWEEN @Data_Inicial AND @Data_Final) Or (@Opcao_Data = 2 /* Data vencimento */ AND Ffn.Data_Vencimento BETWEEN @Data_Inicial AND @Data_Final) Or (@Opcao_Data = 3 /* Data pagamento */ AND Ffn.Data_Pagamento BETWEEN @Data_Inicial AND @Data_Final) Or (@Opcao_Data = 4 /* Previsão pagamento */ AND Ffn.Previsao_Pagamento BETWEEN @Data_Inicial AND @Data_Final) Or (@Opcao_Data <> 0 AND @Exibir_Vencidas = 1 AND Ffn.Data_Vencimento <= @Data_Final)) ORDER BY Ffn.Data, Psa.Nome'";"[0]['IdUsuario']='122'; [1]['Opcao_Data']='0'; [2]['Data_Inicial']='04/01/2026'; [3]['Data_Final']='02/02/2026 23:59:59'; [4]['Exibir_Vencidas']='False'; [5]['XML_Faturas']=; [6]['XML_Filtros']="
"43";"128";"";"11/02/2026 13:39:24";"11/02/2026 13:39:24";"30";"OK";"-1";"'/*PING*/;'";""
"42";"127";"";"11/02/2026 13:39:49";"11/02/2026 13:39:51";"2156";"OK";"0";"'COMMIT TANSACTION'";""
"42";"126";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"15";"OK";"1";"'Insert Into sys_Log_Tabela WITH (ROWLOCK) (IdUsuario, Data_Inicio, Data_Termino, Dados_Log) Values (?, ?, ?, ?)'";"[0]['Param1']='122'; [1]['Param2']='11/02/2026 13:39:50'; [2]['Param3']='11/02/2026 13:39:52'; [3]['Param4']='<Log IdUsuario="122" WindowsUser="Kauan Lauer" ComputerName="KAUAN_LAUER" Hash="bb2d1238a5328ead9ce7c870fd48000e"><Tabela Nome="mov_Movimentacao_Financeira_Custo" Tipo="2" Data="2/11/2026 1:39:50 PM" Indice="1"><Campo Nome="IdMovimentacao_Financeira_Custo" Value="3337"/><Campo Nome="IdMovimentacao_Categoria" Value="2058"/><Campo Nome="IdCentro_Custo" Value="2"/><Campo Nome="IdFatura_Financeira_Custo" Value="31184"/><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Observacao" Value=""/><Campo Nome="Ativo" Value="1"/></Tabela><Tabela Nome="mov_Movimentacao_Financeira_Categoria" Tipo="2" Data="2/11/2026 1:39:50 PM" Indice="2"><Campo Nome="IdMovimentacao_Categoria" Value="2058"/><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="IdCategoria_Financeira" Value="16"/><Campo Nome="IdFatura_Financeira_Categoria" Value="16233"/><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="Tipo_Custo" Value="2"/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Observacao" Value=""/><Campo Nome="Ativo" Value="1"/></Tabela><Tabela Nome="mov_Fatura_Financeira_Baixa" Tipo="2" Data="2/11/2026 1:39:50 PM" Indice="3"><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="IdFatura_Financeira" Value="15849"/><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="Valor_Total" Value="1625.66"/><Campo Nome="Valor_Multa"/><Campo Nome="Valor_Juros"/><Campo Nome="Valor_Acrescimo"/><Campo Nome="Valor_Desconto"/><Campo Nome="Valor_Abatimento"/><Campo Nome="Valor_Total_Corrente" Value="1625.66"/><Campo Nome="Fator_Conversao" Value="1"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Tipo_Baixa" Value="1"/><Campo Nome="Gerar_Recibo" Value="0"/><Campo Nome="Numero_Recibo"/><Campo Nome="Proveniencia" Value=""/><Campo Nome="Observacao" Value=""/><Campo Nome="Hash" Value="0921106f02220ec2e776c1cca3b90bf3"/><Campo Nome="Data_Ultima_Alteracao" Value="2/11/2026 1:39:27 PM"/></Tabela><Tabela Nome="mov_Fatura_Financeira" Tipo="3" Data="2/11/2026 1:39:50 PM" Indice="4"><Campo Nome="IdFatura_Financeira" Value="15849"/><Campo Nome="Data_Pagamento" OldValue="2/11/2026"/><Campo Nome="Situacao" OldValue="2" Value="1"/><Campo Nome="Valor_Residual" OldValue="0" Value="1625.66"/><Campo Nome="Total_Pago" OldValue="1625.66"/><Campo Nome="Total_Pago_Corrente" OldValue="1625.66"/><Campo Nome="Em_Aberto" OldValue="0" Value="1"/><Campo Nome="Hash" OldValue="df1dbb9904b7659413806d3920f590eb" Value="e3c3b6004d1a4af4c2cf7092670599d6"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:39:27 PM" Value="2/11/2026 1:39:50 PM"/></Tabela><Tabela Nome="mov_Registro_Financeiro" Tipo="3" Data="2/11/2026 1:39:50 PM" Indice="5"><Campo Nome="IdRegistro_Financeiro" Value="15480"/><Campo Nome="Situacao" OldValue="2" Value="1"/><Campo Nome="Hash" OldValue="284186f24cc7f91109fd7de691271955" Value="ecdfa001828df4057a3a719e3ee38f42"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:39:27 PM" Value="2/11/2026 1:39:50 PM"/></Tabela><Tabela Nome="mov_Logistica_House" Tipo="3" Data="2/11/2026 1:39:51 PM" Indice="6"><Campo Nome="IdLogistica_House" Value="5998"/><Campo Nome="Data_Pagamento_Local" OldValue="2/11/2026"/><Campo Nome="Situacao_Pagamento" OldValue="3" Value="1"/><Campo Nome="Faturas_Em_Aberto" OldValue="0" Value="1"/><Campo Nome="Data_Ultima_Baixa" OldValue="2/11/2026 1:39:28 PM" Value="2/11/2026 1:39:51 PM"/><Campo Nome="Situacao_Pagamento_Frete" OldValue="2" Value="1"/><Campo Nome="Data_Pagamento_Frete" OldValue="2/11/2026"/></Tabela><Tabela Nome="mov_Logistica_Moeda" Tipo="3" Data="2/11/2026 1:39:51 PM" Indice="7"><Campo Nome="IdLogistica_Moeda" Value="8662"/><Campo Nome="Total_Pago" OldValue="250" Value="0"/><Campo Nome="Total_Pago_Local" OldValue="250" Value="0"/><Campo Nome="Lucro_Efetivo" OldValue="250" Value="500"/></Tabela><Tabela Nome="mov_Logistica_Moeda" Tipo="3" Data="2/11/2026 1:39:51 PM" Indice="8"><Campo Nome="IdLogistica_Moeda" Value="8663"/><Campo Nome="Total_Pago" OldValue="1625.66" Value="0"/><Campo Nome="Total_Pago_Local" OldValue="1625.66" Value="0"/><Campo Nome="Lucro_Efetivo" OldValue="1235.5" Value="2861.16"/></Tabela><Tabela Nome="mov_Logistica_Fiscal" Tipo="3" Data="2/11/2026 1:39:52 PM" Indice="9"><Campo Nome="IdLogistica_Fiscal" Value="1727"/><Campo Nome="Lucro_Contabil_Total" OldValue="1235.5" Value="2861.16"/><Campo Nome="Lucro_Contabil_Saldo" OldValue="1235.5" Value="2861.16"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:39:29 PM" Value="2/11/2026 1:39:52 PM"/></Tabela><Tabela Nome="mov_Movimentacao_Financeira" Tipo="2" Data="2/11/2026 1:39:52 PM" Indice="10"><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="IdTipo_Transacao" Value="2"/><Campo Nome="IdPessoa" Value="54988"/><Campo Nome="IdConta_Pessoa" Value="89"/><Campo Nome="IdForma_Pagamento" Value="1"/><Campo Nome="IdConta_Corrente" Value="36"/><Campo Nome="IdMoeda" Value="52"/><Campo Nome="IdResponsavel_Conciliacao"/><Campo Nome="IdContrato_Cambio"/><Campo Nome="IdGrupo_Financeiro"/><Campo Nome="IdSetor"/><Campo Nome="IdEmpresa_Sistema" Value="12"/><Campo Nome="IdFechamento_Cambio"/><Campo Nome="Numero" Value="000142/26"/><Campo Nome="Referencia" Value="IA-YKS-0038-25"/><Campo Nome="Referencia_Externa" Value=""/><Campo Nome="Numero_Pagamento"/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Valor_Original" Value="-1625.66"/><Campo Nome="Valor_Corrente" Value="1625.66"/><Campo Nome="Fator_Corrente" Value="1"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Data" Value="2/11/2026"/><Campo Nome="Previsao_Compensacao" Value="2/11/2026"/><Campo Nome="Data_Compensacao" Value="2/11/2026"/><Campo Nome="Data_Conciliacao"/><Campo Nome="Historico_Resumo" Value=""/><Campo Nome="Historico" Value=""/><Campo Nome="Compensada" Value="1"/><Campo Nome="Conciliada" Value="0"/><Campo Nome="Estornada" Value="0"/><Campo Nome="Utilizar_Saldo_Pessoa" Value="0"/><Campo Nome="Origem_Lancamento" Value="2"/><Campo Nome="Data_Lancamento" Value="2/11/2026 1:39:27 PM"/><Campo Nome="Nota_Recibo_Conferido" Value="0"/><Campo Nome="Variacao_Cambial" Value="0"/><Campo Nome="Competencia" Value="2/1/2026"/><Campo Nome="Atalho" Value=""/><Campo Nome="Observacao" Value=""/><Campo Nome="Identificacao_Extrato" Value=""/><Campo Nome="Ativo" Value="1"/><Campo Nome="Hash" Value="f2e1af18d7822140c4df5c2fe669b6ff"/><Campo Nome="Data_Ultima_Alteracao" Value="2/11/2026 1:39:27 PM"/></Tabela></Log>'"
"42";"125";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"2";"OK";"1";"'delete from mov_Movimentacao_Financeira '#13#10'where'#13#10' IdMovimentacao_Financeira = ?'";"[0]['Param1']='1844'"
"42";"124";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"16";"OK";"0";"'Select'#13#10'  IdMovimentacao_Categoria, IdMovimentacao_Financeira, IdCategoria_Financeira, IdFatura_Financeira_Categoria, IdFatura_Financeira_Baixa, Tipo_Custo, Valor, Natureza, Valor_Convertido, Observacao, Ativo'#13#10'From'#13#10'  mov_Movimentacao_Financeira_Categoria'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"42";"123";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"10";"OK";"1";"'Select'#13#10'  IdMovimentacao_Financeira, Hash'#13#10'From'#13#10'  mov_Movimentacao_Financeira'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"42";"122";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"0";"OK";"1";"'Select'#13#10'  IdMovimentacao_Financeira, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdResponsavel_Conciliacao, IdContrato_Cambio, IdGrupo_Financeiro, IdSetor, IdEmpresa_Sistema, IdFechamento_Cambio, Numero, Referencia, Referencia_Externa, Numero_Pagamento, Valor, Valor_Original, Valor_Corrente, Fator_Corrente, Natureza, Data, Previsao_Compensacao, Data_Compensacao, Data_Conciliacao, Historico_Resumo, Historico, Compensada, Conciliada, Estornada, Utilizar_Saldo_Pessoa, Origem_Lancamento, Data_Lancamento, Nota_Recibo_Conferido, Variacao_Cambial, Competencia, Atalho, Observacao, Identificacao_Extrato, Ativo, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Movimentacao_Financeira'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"42";"121";"";"11/02/2026 13:39:23";"11/02/2026 13:39:23";"31";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaMoeda" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_Moeda" Valor="8663"/></PrimaryKeys><Campos><Item Nome="Total_Pago" OldValue="1625.66" Value="0"/><Item Nome="Total_Pago_Local" OldValue="1625.66" Value="0"/><Item Nome="Lucro_Efetivo" OldValue="1235.5" Value="2861.16"/></Campos></Evento></Parametros>'"
"42";"120";"";"11/02/2026 13:39:22";"11/02/2026 13:39:23";"16";"OK";"1";"'update mov_Logistica_Fiscal  set'#13#10' Lucro_Contabil_Total = ?,'#13#10' Lucro_Contabil_Saldo = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdLogistica_Fiscal = ?'";""
"42";"119";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"13";"OK";"1";"'Select'#13#10'  IdLogistica_Fiscal, IdLogistica_House, IdEmpresa_Sistema, IdTomador, IdTipo_Movimentacao, IdResponsavel_Apuracao, Taxas_Tributaveis_Total, Taxas_Tributaveis_Tributado, Taxas_Tributaveis_Saldo, Taxas_Tributaveis_Pendente, Lucro_Contabil_Total, Lucro_Contabil_Tributado, Lucro_Contabil_Saldo, Lucro_Contabil_Pendente, Disponivel_Apuracao, Data_Ultima_Alteracao, Data_Apuracao, Situacao, Ativo, Observacao'#13#10'From'#13#10'  mov_Logistica_Fiscal'#13#10'Where'#13#10'  IdLogistica_Fiscal = ?'";"[0]['0']='1727'"
"42";"118";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"13";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  ISNULL(Lmc.Lucro_Efetivo, 0) - ISNULL(Txs.Total_Taxas_Tributaveis, 0) AS Lucro_Contabil_Total,'#13#10'  CAST(CASE '#13#10'    WHEN Lhs.Situacao_Agenciamento = 5 /* Finalizado */ THEN 1'#13#10'    ELSE 0'#13#10'  END AS BIT) AS Disponivel_Apuracao'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Moeda Lmc ON Lmc.IdLogistica_House = Lhs.IdLogistica_House'#13#10'    AND Lmc.IdMoeda = Mcr.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Total_Taxas_Tributaveis'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Ltx.Tributavel = 1'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"42";"117";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"19";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  ISNULL(Lmc.Lucro_Efetivo, 0) - ISNULL(Txs.Total_Taxas_Tributaveis, 0) AS Lucro_Contabil_Total,'#13#10'  CAST(CASE '#13#10'    WHEN Lhs.Situacao_Agenciamento = 5 /* Finalizado */ THEN 1'#13#10'    ELSE 0'#13#10'  END AS BIT) AS Disponivel_Apuracao'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Moeda Lmc ON Lmc.IdLogistica_House = Lhs.IdLogistica_House'#13#10'    AND Lmc.IdMoeda = Mcr.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Total_Taxas_Tributaveis'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Ltx.Tributavel = 1'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"42";"116";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"12";"OK";"1";"'Select'#13#10'  IdFonte_Dados, Nome, Dados'#13#10'From'#13#10'  cad_Fonte_Dados'#13#10'Where'#13#10'  IdFonte_Dados = ?'";"[0]['0']='356'"
"42";"115";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"24";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lfs.IdLogistica_Fiscal,'#13#10'  Lhs.IdEmpresa_Sistema,'#13#10'  Txs.Taxas_Tributaveis_Total,'#13#10'  Txs.Taxas_Tributaveis_Tributado,'#13#10'  Nlt.Lucro_Contabil_Tributado'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.Tributavel = 1 AND Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Ltx.Tributavel = 1 AND Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Ltx.Tributavel = 1 AND Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Taxas_Tributaveis_Total,'#13#10'    SUM(Nfs.Taxas_Tributaveis_Tributado) AS Taxas_Tributaveis_Tributado'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT'#13#10'      Ltx.IdLogistica_Taxa,'#13#10'      SUM(Nfi.Valor_Total) AS Taxas_Tributaveis_Tributado'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    LEFT OUTER JOIN'#13#10'      aux_Nota_Fiscal_Servico_Item_Taxa Nft ON Nft.IdLogistica_Taxa = Ltx.IdLogistica_Taxa'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Nota_Fiscal_Servico_Item Nfi ON Nfi.IdNota_Fiscal_Servico_Item = Nft.IdNota_Fiscal_Servico_Item'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Nota_Fiscal_Servico Nfs ON Nfs.IdNota_Fiscal_Servico = Nfi.IdNota_Fiscal_Servico'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    AND'#13#10'      Nfs.Situacao <> 8 /* Cancelada */'#13#10'    GROUP BY'#13#10'      Ltx.IdLogistica_Taxa'#13#10'    ) Nfs ON Nfs.IdLogistica_Taxa = Ltx.IdLogistica_Taxa'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Lfs.IdLogistica_House,'#13#10'    SUM(Nfs.Valor_Servicos) AS Lucro_Contabil_Tributado'#13#10'  FROM'#13#10'    aux_Logistica_Fiscal_Nota Lfn'#13#10'  JOIN'#13#10'    mov_Logistica_Fiscal Lfs ON Lfs.IdLogistica_Fiscal = Lfn.IdLogistica_Fiscal'#13#10'  JOIN'#13#10'    mov_Nota_Fiscal_Servico Nfs ON Lfn.IdNota_Fiscal_Servico = Nfs.IdNota_Fiscal_Servico'#13#10'  WHERE'#13#10'    Lfs.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Nfs.Situacao <> 8 /* Cancelada */'#13#10'  GROUP BY'#13#10'    Lfs.IdLogistica_House'#13#10'  ) Nlt ON Nlt.IdLogistica_House = Lhs.IdLogistica_House'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Fiscal Lfs ON Lfs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"42";"114";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"10";"OK";"1";"'update mov_Logistica_Moeda  set'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Local = ?,'#13#10' Lucro_Efetivo = ?'#13#10'where'#13#10' IdLogistica_Moeda = ?'";""
"42";"113";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"15";"OK";"1";"'Select'#13#10'  IdLogistica_Moeda, IdLogistica_House, IdMoeda, Total_Pagamento, Total_Recebimento, Total_Pago, Total_Recebido, Total_Pagamento_Local, Total_Pagamento_Exterior, Total_Recebimento_Local, Total_Recebimento_Exterior, Total_Pago_Local, Total_Pago_Exterior, Total_Recebido_Local, Total_Recebido_Exterior, Lucro_Estimado, Lucro_Efetivo, Lucro_Abertura, Lucro_Momento, Lucro_Estimado_Faturado, Comissao_Agente_Orig_Estimada, Comissao_Agente_Dest_Estimada, Comissao_Vendedor_Estimada, Comissao_Representante_Estimada, Comissao_Associacao_Estimada, Comissao_Empresa_Estimada, Comissao_Outros_Estimada, Comissao_Agente_Orig_Efetiva, Comissao_Agente_Dest_Efetiva, Comissao_Vendedor_Efetiva, Comissao_Representante_Efetiva, Comissao_Associacao_Efetiva, Comissao_Empresa_Efetiva, Comissao_Outros_Efetiva, Lucro_Abertura_Frete, Lucro_Abertura_Origem, Lucro_Abertura_Destino, Observacao'#13#10'From'#13#10'  mov_Logistica_Moeda'#13#10'Where'#13#10'  IdLogistica_Moeda = ?'";"[0]['0']='8663'"
"42";"112";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"27";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaMoeda" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_Moeda" Valor="8662"/></PrimaryKeys><Campos><Item Nome="Total_Pago" OldValue="250" Value="0"/><Item Nome="Total_Pago_Local" OldValue="250" Value="0"/><Item Nome="Lucro_Efetivo" OldValue="250" Value="500"/></Campos></Evento></Parametros>'"
"42";"111";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"15";"OK";"1";"'update mov_Logistica_Moeda  set'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Local = ?,'#13#10' Lucro_Efetivo = ?'#13#10'where'#13#10' IdLogistica_Moeda = ?'";""
"42";"110";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"16";"OK";"1";"'Select'#13#10'  IdLogistica_Moeda, IdLogistica_House, IdMoeda, Total_Pagamento, Total_Recebimento, Total_Pago, Total_Recebido, Total_Pagamento_Local, Total_Pagamento_Exterior, Total_Recebimento_Local, Total_Recebimento_Exterior, Total_Pago_Local, Total_Pago_Exterior, Total_Recebido_Local, Total_Recebido_Exterior, Lucro_Estimado, Lucro_Efetivo, Lucro_Abertura, Lucro_Momento, Lucro_Estimado_Faturado, Comissao_Agente_Orig_Estimada, Comissao_Agente_Dest_Estimada, Comissao_Vendedor_Estimada, Comissao_Representante_Estimada, Comissao_Associacao_Estimada, Comissao_Empresa_Estimada, Comissao_Outros_Estimada, Comissao_Agente_Orig_Efetiva, Comissao_Agente_Dest_Efetiva, Comissao_Vendedor_Efetiva, Comissao_Representante_Efetiva, Comissao_Associacao_Efetiva, Comissao_Empresa_Efetiva, Comissao_Outros_Efetiva, Lucro_Abertura_Frete, Lucro_Abertura_Origem, Lucro_Abertura_Destino, Observacao'#13#10'From'#13#10'  mov_Logistica_Moeda'#13#10'Where'#13#10'  IdLogistica_Moeda = ?'";"[0]['0']='8662'"
"42";"109";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"36";"OK";"-1";"'DECLARE'#13#10'  @IdLogistica_House IdLongo,'#13#10'  @IdMoeda_Corrente IdCurto,'#13#10'  @Profit_Estimado_Sem_Canceladas Boleano'#13#10''#13#10'SET @IdLogistica_House = ?'#13#10'SET @Profit_Estimado_Sem_Canceladas = ?'#13#10''#13#10'SELECT'#13#10'  @IdMoeda_Corrente = Mcr.IdMoeda'#13#10'FROM'#13#10'  cad_Moeda Mcr'#13#10'WHERE'#13#10'  Mcr.Moeda_Corrente = 1'#13#10''#13#10'DECLARE @Faturas TABLE('#13#10'  IdRegistro_Financeiro IdLongo, '#13#10'  IdLogistica_House IdLongo, '#13#10'  IdMoeda IdCurto, '#13#10'  Local_Cobranca TipoFixo, '#13#10'  Natureza TipoFixo, '#13#10'  Valor_Total Moeda, '#13#10'  Total_Pago Moeda, '#13#10'  Total_Pago_Corrente Moeda,'#13#10'  Valor_Residual Moeda'#13#10')'#13#10'INSERT INTO @Faturas'#13#10'  (IdRegistro_Financeiro, IdLogistica_House, IdMoeda, Local_Cobranca, Natureza, Valor_Total, Total_Pago, Total_Pago_Corrente, Valor_Residual)'#13#10'SELECT'#13#10'  Lft.IdRegistro_Financeiro,'#13#10'  Lft.IdLogistica_House,'#13#10'  Lft.IdMoeda,'#13#10'  Lft.Local_Cobranca,'#13#10'  Lft.Natureza,'#13#10'  Lft.Valor_Total,'#13#10'  SUM(ISNULL(Ffn.Total_Pago, 0) + '#13#10'    ISNULL(CASE'#13#10'      WHEN (Run.IdRegistro_Financeiro Is NULL) OR ((ISNULL(Run.Valor_Total, 0) <> 0) AND (ISNULL(Run.Total_Pago, 0) = 0)) THEN 0'#13#10'      WHEN (ISNULL(Run.Valor_Total, 0) = 0) /* A unificação equiparou AS faturas é pq deu baixa */'#13#10'        OR (ISNULL(Run.Valor_Total, 0) = ISNULL(Run.Total_Pago, 0)) /* O total pago é igual ao unificado, baixa de 100% */ THEN Ffn.Valor_Residual'#13#10'      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * 100 / NULLIF(Run.Valor_Total, 0)) * (Run.Total_Pago / NULLIF(Ffn.Fator_Unificacao, 0))) / 100, 2)'#13#10'    END, 0)) AS Total_Pago,'#13#10'  SUM(ISNULL(Ffn.Total_Pago_Corrente, 0) + '#13#10'    ISNULL(CASE'#13#10'      WHEN (Run.IdRegistro_Financeiro Is NULL) OR ((ISNULL(Run.Valor_Total, 0) <> 0) AND (ISNULL(Run.Total_Pago, 0) = 0)) THEN 0'#13#10'      WHEN (ISNULL(Run.Valor_Total, 0) = 0) /* A unificação equiparou AS faturas é pq deu baixa */ THEN ROUND(Ffn.Valor_Residual / NULLIF(Ffn.Fator_Unificacao, 0), 2)'#13#10'      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * 100 / NULLIF(Run.Valor_Total, 0)) * (Run.Total_Pago_Corrente)) / 100, 2)'#13#10'    END, 0)) AS Total_Pago_Corrente,'#13#10'  SUM(ISNULL(CASE'#13#10'      WHEN Run.IdRegistro_Financeiro IS NULL THEN Ffn.Valor_Residual'#13#10'--      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * Run.Valor_Residual) / NULLIF(Run.Valor_Total, 0)) / NULLIF(Ffn.Fator_Unificacao, 0), 2)'#13#10'      ELSE ROUND((Ffn.Valor_Residual * Run.Valor_Residual) / NULLIF(Run.Valor_Total, 0), 2)'#13#10'    END, 0)) AS Valor_Residual'#13#10'FROM'#13#10'  vis_Logistica_Fatura Lft'#13#10'JOIN'#13#10'  mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Run.IdRegistro_Financeiro,'#13#10'    Run.IdMoeda,'#13#10'    Run.Valor_Total,'#13#10'    SUM(Ffu.Total_Pago) AS Total_Pago,'#13#10'    SUM(Ffu.Total_Pago_Corrente) AS Total_Pago_Corrente,'#13#10'    SUM(Ffu.Valor_Residual) AS Valor_Residual,'#13#10'    Ffu.Situacao'#13#10'  FROM'#13#10'    mov_Registro_Financeiro Run'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffu ON Ffu.IdRegistro_Financeiro = Run.IdRegistro_Financeiro'#13#10'  WHERE'#13#10'    Run.Origem_Lancamento = 3'#13#10'  GROUP BY'#13#10'    Run.IdRegistro_Financeiro,'#13#10'    Run.IdMoeda,'#13#10'    Run.Valor_Total,'#13#10'    Ffu.Situacao'#13#10'  ) AS Run ON Run.IdRegistro_Financeiro = Ffn.IdRegistro_Unificador'#13#10'WHERE'#13#10'  (Lft.IdLogistica_House = @IdLogistica_House)'#13#10'AND'#13#10'  (@Profit_Estimado_Sem_Canceladas = 0 OR ISNULL(Run.Situacao, Ffn.Situacao) <> 6 /* Cancelada */)'#13#10'GROUP BY'#13#10'  Lft.IdRegistro_Financeiro,'#13#10'  Lft.IdLogistica_House,'#13#10'  Lft.IdMoeda,'#13#10'  Lft.Local_Cobranca,'#13#10'  Lft.Natureza,'#13#10'  Lft.Valor_Total'#13#10''#13#10'SELECT'#13#10'  Lmd.IdLogistica_Moeda,'#13#10'  Vlr.Total_Pagamento AS Total_Pagamento,'#13#10'  Vlr.Total_Recebimento AS Total_Recebimento,'#13#10'  Vlr.Total_Pago AS Total_Pago,'#13#10'  Vlr.Total_Recebido AS Total_Recebido,'#13#10'  Vlr.Total_Pagamento_Local AS Total_Pagamento_Local,'#13#10'  Vlr.Total_Pagamento_Exterior AS Total_Pagamento_Exterior,'#13#10'  Vlr.Total_Recebimento_Local AS Total_Recebimento_Local,'#13#10'  Vlr.Total_Recebimento_Exterior AS Total_Recebimento_Exterior,'#13#10'  Vlr.Total_Pago_Local AS Total_Pago_Local,'#13#10'  Vlr.Total_Pago_Exterior AS Total_Pago_Exterior,'#13#10'  Vlr.Total_Recebido_Local AS Total_Recebido_Local,'#13#10'  Vlr.Total_Recebido_Exterior AS Total_Recebido_Exterior,'#13#10'  Vlr.Lucro_Estimado AS Lucro_Estimado,'#13#10'  Vlr.Lucro_Efetivo AS Lucro_Efetivo,'#13#10'  Vlr.Lucro_Momento AS Lucro_Momento,'#13#10'  ISNULL(Cms.Comissao_Agente_Orig_Estimada, 0) AS Comissao_Agente_Orig_Estimada,'#13#10'  ISNULL(Cms.Comissao_Agente_Dest_Estimada, 0) AS Comissao_Agente_Dest_Estimada,'#13#10'  ISNULL(Cms.Comissao_Vendedor_Estimada, 0) AS Comissao_Vendedor_Estimada,'#13#10'  ISNULL(Cms.Comissao_Representante_Estimada, 0) AS Comissao_Representante_Estimada,'#13#10'  ISNULL(Cms.Comissao_Associacao_Estimada, 0) AS Comissao_Associacao_Estimada,'#13#10'  ISNULL(Cms.Comissao_Outros_Estimada, 0) AS Comissao_Outros_Estimada,'#13#10'  ISNULL(Cms.Comissao_Agente_Orig_Efetiva, 0) AS Comissao_Agente_Orig_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Agente_Dest_Efetiva, 0) AS Comissao_Agente_Dest_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Vendedor_Efetiva, 0) AS Comissao_Vendedor_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Representante_Efetiva, 0) AS Comissao_Representante_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Associacao_Efetiva, 0) AS Comissao_Associacao_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Outros_Efetiva, 0) AS Comissao_Outros_Efetiva'#13#10'FROM'#13#10'  mov_Logistica_Moeda Lmd'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Rft.IdLogistica_Moeda,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido_Exterior,'#13#10'    SUM(Rft.Valor_Estimado) AS Lucro_Estimado,'#13#10'    SUM(Rft.Valor_Efetivo) AS Lucro_Efetivo,'#13#10'    SUM(Rft.Valor_Momento) AS Lucro_Momento'#13#10'  FROM'#13#10'    /* Resumo das Faturas */'#13#10'    (SELECT'#13#10'      Lmd.IdLogistica_Moeda,'#13#10'      Ftr.Natureza,'#13#10'      Ftr.Local_Cobranca,'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Valor_Total'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Valor_Total * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Valor_Total / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE   '#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Valor_Total'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Valor_Total * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Valor_Total / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          End'#13#10'      End, 0) AS Valor_Estimado,'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        Else'#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          End'#13#10'      End, 0) AS Valor_Efetivo,'#13#10'      /* ESTIMADO */'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN (Ftr.Valor_Residual)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND((Ftr.Valor_Residual) * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND((Ftr.Valor_Residual) / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE   '#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN (Ftr.Valor_Residual)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND((Ftr.Valor_Residual) * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND((Ftr.Valor_Residual) / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END'#13#10'      END, 0) '#13#10'      /* EFETIVO */'#13#10'      + ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE'#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END'#13#10'        END, 0) AS Valor_Momento'#13#10'    FROM'#13#10'      mov_Logistica_Moeda Lmd'#13#10'    LEFT OUTER JOIN'#13#10'      @Faturas Ftr ON Ftr.IdLogistica_House = Lmd.IdLogistica_House'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Lfc.IdMoeda_Origem = Ftr.IdMoeda AND Lfc.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Lmd.IdMoeda AND Lfc.IdMoeda_Destino = Ftr.IdMoeda))'#13#10'    WHERE'#13#10'      Lmd.IdLogistica_House = @IdLogistica_House'#13#10'    ) Rft'#13#10'  GROUP BY'#13#10'    Rft.IdLogistica_Moeda'#13#10'  ) AS Vlr ON Vlr.IdLogistica_Moeda = Lmd.IdLogistica_Moeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Rcm.IdLogistica_Moeda,'#13#10'    /* Estimadas */'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 1 /* Agente destino */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Dest_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 2 /* Agente origem */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Orig_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (6, 10) /* Representante e Representante destino final */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Representante_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (4, 8) /* Vendedor e Outro Vendedor */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Vendedor_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 9 /* Associação internacional */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Associacao_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (5, 7) /* Outro e Contato */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Outros_Estimada,'#13#10'    /* Efetivas */'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 1 /* Agente destino */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Dest_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 2 /* Agente origem */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Orig_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (6, 10) /* Representante destino final */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Representante_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (4, 8) /* Vendedor e Outro Vendedor */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Vendedor_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 9 /* Associação internacional */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Associacao_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (5, 7) /* Outro e Contato */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Outros_Efetiva'#13#10'  FROM'#13#10'    /* Resumo das Comissões */'#13#10'    (SELECT'#13#10'      Lmd.IdLogistica_Moeda,'#13#10'      Lcm.Tipo_Comissionado,'#13#10'      CASE'#13#10'        WHEN Lmd.IdMoeda = Ltx.IdMoeda_Pagamento THEN Ltx.Valor_Pagamento_Total'#13#10'        WHEN Ctm.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctm.IdMoeda_Destino = Lmd.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctm.Fator_Conversao, 2)'#13#10'        WHEN Ctm.IdMoeda_Origem = Lmd.IdMoeda AND Ctm.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctm.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctm.Fator_Conversao, 2)'#13#10'        ELSE 0'#13#10'      END AS Valor_Estimado,'#13#10'      CASE'#13#10'        WHEN Lmd.IdMoeda = @IdMoeda_Corrente THEN'#13#10'          ROUND(((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago_Corrente) / 100, 2)'#13#10'        WHEN Lmd.IdMoeda = Ftr.IdMoeda THEN'#13#10'          ROUND(((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100, 2)'#13#10'        WHEN Cfm.IdMoeda_Origem = Ftr.IdMoeda AND Cfm.IdMoeda_Destino = Lmd.IdMoeda THEN'#13#10'          ROUND((((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100) * Cfm.Fator_Conversao, 2)'#13#10'        WHEN Cfm.IdMoeda_Origem = Lmd.IdMoeda AND Cfm.IdMoeda_Destino = Ftr.IdMoeda AND ISNULL(Cfm.Fator_Conversao, 0) <> 0 THEN'#13#10'          ROUND((((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100) / NULLIF(Cfm.Fator_Conversao, 0), 2)'#13#10'        ELSE 0'#13#10'      END AS Valor_Efetivo'#13#10'    FROM'#13#10'      mov_Logistica_Moeda Lmd'#13#10'    JOIN'#13#10'      mov_Logistica_Comissao Lcm ON Lcm.IdLogistica_House = Lmd.IdLogistica_House'#13#10'    JOIN'#13#10'      mov_Logistica_Taxa Ltx ON Ltx.IdLogistica_Taxa = Lcm.IdTaxa_Referente'#13#10'    JOIN'#13#10'      @Faturas Ftr ON Ftr.IdRegistro_Financeiro = Ltx.IdRegistro_Pagamento'#13#10'    LEFT OUTER JOIN /* Conversão Taxa - Logistica Moeda */'#13#10'      mov_Logistica_Fatura_Conversao Ctm ON Ctm.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Ctm.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctm.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Ctm.IdMoeda_Origem = Lmd.IdMoeda AND Ctm.IdMoeda_Destino = Ltx.IdMoeda_Pagamento)) '#13#10'    LEFT OUTER JOIN /* Conversão Taxa - Fatura */'#13#10'      mov_Logistica_Fatura_Conversao Ctf ON Ctf.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda)'#13#10'        OR (Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento))'#13#10'    LEFT OUTER JOIN /* Conversão Fatura - Logistica Moeda */'#13#10'      mov_Logistica_Fatura_Conversao Cfm ON Cfm.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Cfm.IdMoeda_Origem = Ftr.IdMoeda AND Cfm.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Cfm.IdMoeda_Origem = Lmd.IdMoeda AND Cfm.IdMoeda_Destino = Ftr.IdMoeda))'#13#10'    WHERE'#13#10'      Lmd.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Rcm'#13#10'  GROUP BY'#13#10'    Rcm.IdLogistica_Moeda'#13#10'  ) AS Cms ON Cms.IdLogistica_Moeda = Lmd.IdLogistica_Moeda'#13#10'WHERE'#13#10'  Lmd.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'; [1]['Profit_Estimado_Sem_Canceladas']='False'"
"42";"108";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"46";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaHouse" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_House" Valor="5998"/></PrimaryKeys><Campos><Item Nome="Data_Pagamento_Local" OldValue="2/11/2026"/><Item Nome="Situacao_Pagamento" OldValue="3" Value="1"/><Item Nome="Faturas_Em_Aberto" OldValue="0" Value="-1"/><Item Nome="Data_Ultima_Baixa" OldValue="2/11/2026 1:39:28 PM" Value="2/11/2026 1:39:51 PM"/><Item Nome="Situacao_Pagamento_Frete" OldValue="2" Value="1"/><Item Nome="Data_Pagamento_Frete" OldValue="2/11/2026"/></Campos></Evento></Parametros>'"
"42";"107";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"2";"OK";"1";"'update mov_Logistica_House  set'#13#10' Data_Pagamento_Local = ?,'#13#10' Situacao_Pagamento = ?,'#13#10' Faturas_Em_Aberto = ?,'#13#10' Data_Ultima_Baixa = ?,'#13#10' Situacao_Pagamento_Frete = ?,'#13#10' Data_Pagamento_Frete = ?'#13#10'where'#13#10' IdLogistica_House = ?'";"[0]['Param1']='NULL'; [1]['Param2']='1'; [2]['Param3']='True'; [3]['Param4']='11/02/2026 13:39:51'; [4]['Param5']='1'; [5]['Param6']='NULL'; [6]['Param7']='5998'"
"42";"106";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"16";"OK";"-1";"'/*'#13#10'EVENTOS'#13#10'1 - Ao inserir'#13#10'2 - Ao editar'#13#10'3 - Ao excluir'#13#10'4 - Ao confirmar inserção'#13#10'5 - Ao confirmar edição'#13#10''#13#10'AÇÔES'#13#10'1 - Permitir'#13#10'2 - Exibir aviso'#13#10'3 - Solicitar confirmação'#13#10'4 - Senha'#13#10'5 - Bloquear'#13#10'*/'#13#10''#13#10'SET NOCOUNT ON'#13#10''#13#10'Declare'#13#10'  @IdUsuario IdCurto,'#13#10'  @IdBloqueio_Condicional_List VarChar(Max),'#13#10'  @Parametros Xml'#13#10''#13#10'Set @IdUsuario = ?'#13#10'Set @IdBloqueio_Condicional_List = ?'#13#10'Set @Parametros = ?'#13#10''#13#10'Declare'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @IgnorarSegurancaCount InteiroCurto,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @IgnorarSegurancaCount = Prm.value('#39'@IgnorarSegurancaCount'#39', '#39'smallint'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'Declare Bloqueio Cursor For'#13#10'Select'#13#10'  Bcn.IdBloqueio_Condicional,'#13#10'  Bcn.Ao_Inserir,'#13#10'  Bcn.Ao_Editar,'#13#10'  Bcn.Ao_Excluir,'#13#10'  Bcn.Ao_Confirmar_Edicao,'#13#10'  Bcn.Ao_Confirmar_Insercao,'#13#10'  Bcn.Dados_Registro'#13#10'From'#13#10'  string_split(@IdBloqueio_Condicional_List, '#39','#39') prm'#13#10'Join'#13#10'  cad_Bloqueio_Condicional Bcn on Bcn.IdBloqueio_Condicional = prm.value'#13#10'Where'#13#10'  (Bcn.Classe Like @Classe)'#13#10'    And (Bcn.Bloqueio_Ativo = 1)'#13#10'    And (((@Evento = 1) and (Bcn.Ao_Inserir = 1))'#13#10'      or ((@Evento = 2) and (Bcn.Ao_Editar = 1))'#13#10'      or ((@Evento = 3) and (Bcn.Ao_Excluir = 1))'#13#10'      or ((@Evento = 4) and (Bcn.Ao_Confirmar_Insercao = 1))'#13#10'      or ((@Evento = 5) and (Bcn.Ao_Confirmar_Edicao = 1)))'#13#10'  '#13#10'Open Bloqueio'#13#10''#13#10'Declare'#13#10'  @IdBloqueio_Condicional IdCurto,'#13#10'  @Ao_Inserir Boleano,'#13#10'  @Ao_Editar Boleano,'#13#10'  @Ao_Excluir Boleano,'#13#10'  @Ao_Confirmar_Edicao Boleano,'#13#10'  @Ao_Confirmar_Insercao Boleano,'#13#10'  @Dados_Registro Xml,'#13#10'  @Acao TipoFixo,'#13#10'  @Mensagem VarChar(Max),'#13#10'  @Prioridade InteiroMicro,'#13#10'  @IgnorarSegurancaAoConfirmar Bit'#13#10''#13#10'Fetch Next From Bloqueio Into'#13#10'  @IdBloqueio_Condicional,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Editar,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Confirmar_Insercao,'#13#10'  @Ao_Confirmar_Edicao,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Acoes Table ('#13#10'  IdBloqueio_Condicional IdCurto,'#13#10'  Acao TipoFixo,'#13#10'  Mensagem VarChar(Max),'#13#10'  Prioridade InteiroMicro,'#13#10'  IgnorarSegurancaCount InteiroMicro'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Acao = 0,'#13#10'    @Mensagem = NULL,'#13#10'    @Prioridade = 0,'#13#10'    @IgnorarSegurancaAoConfirmar = 1'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @Evento TipoFixo, @IgnorarSegurancaCount InteiroCurto OUTPUT, @IgnorarSegurancaAoConfirmar Bit OUTPUT, @Acao TipoFixo OUTPUT, @Mensagem VarChar(Max) OUTPUT, @Prioridade InteiroMicro OUTPUT'#39','#13#10'      @Parametros=@Parametros, @Evento=@Evento, @IgnorarSegurancaCount=@IgnorarSegurancaCount OUTPUT, @IgnorarSegurancaAoConfirmar=@IgnorarSegurancaAoConfirmar OUTPUT, @Acao=@Acao OUTPUT, @Mensagem=@Mensagem OUTPUT, @Prioridade=@Prioridade OUTPUT'#13#10''#13#10'  If (@Evento in (4 /* Ao confirmar inserção */, 5 /* Ao confirmar edição */) And @IgnorarSegurancaAoConfirmar = 1)'#13#10'    Set @IgnorarSegurancaCount = 0'#13#10''#13#10'  If (@Acao <> 0) And (@IgnorarSegurancaCount = 0)'#13#10'    Insert Into @Acoes (IdBloqueio_Condicional, Acao, Mensagem, Prioridade, IgnorarSegurancaCount) Values (@IdBloqueio_Condicional, @Acao, @Mensagem, @Prioridade, @IgnorarSegurancaCount)'#13#10''#13#10'  Fetch Next From Bloqueio Into'#13#10'    @IdBloqueio_Condicional,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Editar,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Confirmar_Insercao,'#13#10'    @Ao_Confirmar_Edicao,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Bloqueio'#13#10'Deallocate Bloqueio'#13#10''#13#10'SET NOCOUNT OFF'#13#10''#13#10'Select'#13#10'  IdBloqueio_Condicional,'#13#10'  Acao,'#13#10'  Mensagem,'#13#10'  IgnorarSegurancaCount'#13#10'From'#13#10'  @Acoes'#13#10'Order By'#13#10'  Acao Desc,'#13#10'  Prioridade'";"[0][]='122'; [1][]='1440'; [2][]='<Parametros><Evento Classe="TLogisticaHouse" Tipo="5" IgnorarSegurancaCount="4"><Campos><Item Nome="IdLogistica_House" Value="5998"/><Item Nome="IdLogistica_Master" Value="6107"/><Item Nome="IdCliente" Value="54801"/><Item Nome="IdImportador" Value="54801"/><Item Nome="IdExportador"/><Item Nome="IdNotify"/><Item Nome="IdDespachante_Aduaneiro"/><Item Nome="IdRepresentante" Value="54700"/><Item Nome="IdRepresentante_Destino_Final"/><Item Nome="IdSeguradora"/><Item Nome="IdVendedor" Value="54501"/><Item Nome="IdIncoterm" Value="2"/><Item Nome="IdMercadoria"/><Item Nome="IdMoeda_Mercadoria"/><Item Nome="IdStatus_Processo_Logistico"/><Item Nome="IdContrato_Frete"/><Item Nome="IdOferta_Frete" Value="2982"/><Item Nome="IdOferta_Frete_Original" Value="2982"/><Item Nome="IdProcesso_Origem"/><Item Nome="IdProcesso_Origem_Clonagem"/><Item Nome="IdProcesso_Primeiro_Trecho"/><Item Nome="IdTransportadora_Origem"/><Item Nome="IdTransportadora_Destino"/><Item Nome="IdProjeto_Atividade" Value="8594"/><Item Nome="IdEmpresa_Sistema" Value="12"/><Item Nome="IdTipo_Processo" Value="1"/><Item Nome="IdMoeda_Pagamento_Demurrage"/><Item Nome="IdMoeda_Recebimento_Demurrage"/><Item Nome="IdIndicacao"/><Item Nome="IdPais_Origem_Mercadoria"/><Item Nome="IdPais_Destino_Mercadoria"/><Item Nome="IdNVOCC"/><Item Nome="IdFuncionario_Criacao" Value="54979"/><Item Nome="Numero_Processo" Value="IA-YKS-0038-25"/><Item Nome="Numero_Invoices" Value=""/><Item Nome="Referencia_Interna"/><Item Nome="Referencia_Externa" Value=""/><Item Nome="Referencia_Cliente" Value=""/><Item Nome="Senha_Fatura"/><Item Nome="Local_Coleta" Value=""/><Item Nome="Local_Coleta_Destino" Value=""/><Item Nome="Local_Entrega_Origem" Value=""/><Item Nome="Local_Entrega" Value=""/><Item Nome="Local_Emissao_Outro"/><Item Nome="Consolidado_House" Value="0"/><Item Nome="Encaminhado_Por" Value="6"/><Item Nome="Modalidade_Pagamento" Value="3"/><Item Nome="Tipo_Servico" Value="1"/><Item Nome="Tipo_Frete"/><Item Nome="Modalidade_Coleta"/><Item Nome="Modalidade_Entrega"/><Item Nome="Tipo_Coleta_Entrega"/><Item Nome="Tipo_Coleta_Entrega_Destino"/><Item Nome="Tipo_Carga" Value="1"/><Item Nome="Tipo_Projeto" Value="1"/><Item Nome="Trecho" Value="0"/><Item Nome="Comissao_Coleta" Value="0"/><Item Nome="Comissao_Entrega" Value="0"/><Item Nome="Numero_DI_RE"/><Item Nome="Numero_LI_DDE"/><Item Nome="Numero_Courrier"/><Item Nome="Metros_Cubicos"/><Item Nome="Peso_Liquido"/><Item Nome="Peso_Bruto"/><Item Nome="Peso_Cubado"/><Item Nome="Peso_Considerado"/><Item Nome="Quantidade_Volumes"/><Item Nome="Data_Abertura_Processo" Value="12/22/2025 2:06:58 PM"/><Item Nome="Data_Previsao_Prontidao_Carga"/><Item Nome="Data_Prontidao_Carga"/><Item Nome="Data_Liberado_Faturamento"/><Item Nome="Data_Faturado" Value="2/11/2026"/><Item Nome="Data_Recebimento_Local" Value="2/11/2026"/><Item Nome="Data_Pagamento_Local" OldValue="2/11/2026" Changed="True"/><Item Nome="Data_Acerto_Agente"/><Item Nome="Data_Fechamento_Cambio"/><Item Nome="Data_Auditado"/><Item Nome="Data_Fechamento_Processo" Value="2/11/2026"/><Item Nome="Data_Previsao_Coleta"/><Item Nome="Data_Previsao_Coleta_Destino"/><Item Nome="Data_Coleta"/><Item Nome="Data_Coleta_Destino"/><Item Nome="Data_Previsao_Entrega_Origem"/><Item Nome="Data_Previsao_Entrega"/><Item Nome="Data_Entrega_Origem"/><Item Nome="Data_Entrega"/><Item Nome="Data_Validade_Taxas"/><Item Nome="Data_Chegada_Armazem"/><Item Nome="Canal_Liberacao"/><Item Nome="Local_Emissao"/><Item Nome="Situacao_Agenciamento" Value="5"/><Item Nome="Situacao_Pagamento" Value="1" OldValue="3" Changed="True"/><Item Nome="Situacao_Recebimento" Value="3"/><Item Nome="Situacao_Demurrage"/><Item Nome="Situacao_Acerto_Agente" Value="0"/><Item Nome="Situacao_Pre_Finalizado" Value="4"/><Item Nome="Quantidade_Invoices"/><Item Nome="Total_Conhecimentos" Value="1"/><Item Nome="Valor_Mercadoria"/><Item Nome="Importancia_Segurada"/><Item Nome="Percentual_Seguro"/><Item Nome="Agenciamento_Carga" Value="1"/><Item Nome="Desembaraco_Aduaneiro" Value="0"/><Item Nome="Demurrage_Detention" Value="0"/><Item Nome="Tipo_Rota"/><Item Nome="Rota"/><Item Nome="Seguro"/><Item Nome="Carga_Perigosa"/><Item Nome="Carga_Empilhavel"/><Item Nome="Ordem_Compra" Value=""/><Item Nome="NCM_Descricao" Value=""/><Item Nome="Parecer_Auditoria" Value=""/><Item Nome="Instrucoes_Operacional" Value="TESTEEEEEEE"/><Item Nome="Instrucoes_Financeiro" Value="teste"/><Item Nome="Instrucoes_Cliente" Value=""/><Item Nome="Instrucoes_Agente" Value=""/><Item Nome="Instrucoes_Operacional_Cliente" Value=""/><Item Nome="Shipper_Exporter" Value=""/><Item Nome="Consignee" Value="APPLE COMPUTER INC.&'#39'#35'#39'xA;,  - &'#39'#35'#39'xA; -  - &'#39'#35'#39'xA;CPF/CNPJ: "/><Item Nome="Notify" Value=""/><Item Nome="Conhecimentos" Value="TESTEAWB"/><Item Nome="Numeros_Embarque" Value=""/><Item Nome="Observacao" Value=""/><Item Nome="Tipo_Declaracao"/><Item Nome="Data_LI_DDE"/><Item Nome="Data_DI_RE"/><Item Nome="Natureza_Exportacao"/><Item Nome="Data_Averbacao"/><Item Nome="Tipo_Conhecimento_Embarque"/><Item Nome="Numeros_RVS_RAS"/><Item Nome="Numeros_RF_RP"/><Item Nome="Quantidade_UN_Nacoes_Unidas"/><Item Nome="Faturas_Em_Aberto" Value="1" OldValue="0" Changed="True"/><Item Nome="IdUltimo_Registro_Baixa" Value="15480"/><Item Nome="Data_Ultima_Baixa" Value="2/11/2026 1:39:51 PM" OldValue="2/11/2026 1:39:28 PM" Changed="True"/><Item Nome="IdMotivo_Cancelamento_Processo"/><Item Nome="IdLogistica_Seguro"/><Item Nome="Data_Cancelamento"/><Item Nome="Detalhes_Cancelamento"/><Item Nome="Situacao_Siscoserv" Value="1"/><Item Nome="Situacao_Tracking"/><Item Nome="Data_Atualizacao_Tracking"/><Item Nome="Comentario_Siscoserv"/><Item Nome="Remarks" Value=""/><Item Nome="Remarks_Terrestre" Value=""/><Item Nome="Remarks_Free_Time" Value=""/><Item Nome="Situacao_Pagamento_Frete" Value="1" OldValue="2" Changed="True"/><Item Nome="Data_Pagamento_Frete" OldValue="2/11/2026" Changed="True"/><Item Nome="Situacao_Recebimento_Frete" Value="2"/><Item Nome="Data_Recebimento_Frete" Value="2/11/2026"/><Item Nome="Ativo" Value="1"/><Item Nome="Atualizacao_Taxas_Comercial" Value="3"/></Campos></Evento></Parametros>'"
"42";"105";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"39";"OK";"-1";"'/*'#13#10'EVENTOS'#13#10'1 - Ao inserir'#13#10'2 - Ao editar'#13#10'3 - Ao excluir'#13#10'4 - Ao confirmar inserção'#13#10'5 - Ao confirmar edição'#13#10''#13#10'AÇÔES'#13#10'1 - Permitir'#13#10'2 - Exibir aviso'#13#10'3 - Solicitar confirmação'#13#10'4 - Senha'#13#10'5 - Bloquear'#13#10'*/'#13#10''#13#10'SET NOCOUNT ON'#13#10''#13#10'Declare'#13#10'  @IdUsuario IdCurto,'#13#10'  @IdBloqueio_Condicional_List VarChar(Max),'#13#10'  @Parametros Xml'#13#10''#13#10'Set @IdUsuario = ?'#13#10'Set @IdBloqueio_Condicional_List = ?'#13#10'Set @Parametros = ?'#13#10''#13#10'Declare'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @IgnorarSegurancaCount InteiroCurto,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @IgnorarSegurancaCount = Prm.value('#39'@IgnorarSegurancaCount'#39', '#39'smallint'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'Declare Bloqueio Cursor For'#13#10'Select'#13#10'  Bcn.IdBloqueio_Condicional,'#13#10'  Bcn.Ao_Inserir,'#13#10'  Bcn.Ao_Editar,'#13#10'  Bcn.Ao_Excluir,'#13#10'  Bcn.Ao_Confirmar_Edicao,'#13#10'  Bcn.Ao_Confirmar_Insercao,'#13#10'  Bcn.Dados_Registro'#13#10'From'#13#10'  string_split(@IdBloqueio_Condicional_List, '#39','#39') prm'#13#10'Join'#13#10'  cad_Bloqueio_Condicional Bcn on Bcn.IdBloqueio_Condicional = prm.value'#13#10'Where'#13#10'  (Bcn.Classe Like @Classe)'#13#10'    And (Bcn.Bloqueio_Ativo = 1)'#13#10'    And (((@Evento = 1) and (Bcn.Ao_Inserir = 1))'#13#10'      or ((@Evento = 2) and (Bcn.Ao_Editar = 1))'#13#10'      or ((@Evento = 3) and (Bcn.Ao_Excluir = 1))'#13#10'      or ((@Evento = 4) and (Bcn.Ao_Confirmar_Insercao = 1))'#13#10'      or ((@Evento = 5) and (Bcn.Ao_Confirmar_Edicao = 1)))'#13#10'  '#13#10'Open Bloqueio'#13#10''#13#10'Declare'#13#10'  @IdBloqueio_Condicional IdCurto,'#13#10'  @Ao_Inserir Boleano,'#13#10'  @Ao_Editar Boleano,'#13#10'  @Ao_Excluir Boleano,'#13#10'  @Ao_Confirmar_Edicao Boleano,'#13#10'  @Ao_Confirmar_Insercao Boleano,'#13#10'  @Dados_Registro Xml,'#13#10'  @Acao TipoFixo,'#13#10'  @Mensagem VarChar(Max),'#13#10'  @Prioridade InteiroMicro,'#13#10'  @IgnorarSegurancaAoConfirmar Bit'#13#10''#13#10'Fetch Next From Bloqueio Into'#13#10'  @IdBloqueio_Condicional,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Editar,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Confirmar_Insercao,'#13#10'  @Ao_Confirmar_Edicao,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Acoes Table ('#13#10'  IdBloqueio_Condicional IdCurto,'#13#10'  Acao TipoFixo,'#13#10'  Mensagem VarChar(Max),'#13#10'  Prioridade InteiroMicro,'#13#10'  IgnorarSegurancaCount InteiroMicro'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Acao = 0,'#13#10'    @Mensagem = NULL,'#13#10'    @Prioridade = 0,'#13#10'    @IgnorarSegurancaAoConfirmar = 1'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @Evento TipoFixo, @IgnorarSegurancaCount InteiroCurto OUTPUT, @IgnorarSegurancaAoConfirmar Bit OUTPUT, @Acao TipoFixo OUTPUT, @Mensagem VarChar(Max) OUTPUT, @Prioridade InteiroMicro OUTPUT'#39','#13#10'      @Parametros=@Parametros, @Evento=@Evento, @IgnorarSegurancaCount=@IgnorarSegurancaCount OUTPUT, @IgnorarSegurancaAoConfirmar=@IgnorarSegurancaAoConfirmar OUTPUT, @Acao=@Acao OUTPUT, @Mensagem=@Mensagem OUTPUT, @Prioridade=@Prioridade OUTPUT'#13#10''#13#10'  If (@Evento in (4 /* Ao confirmar inserção */, 5 /* Ao confirmar edição */) And @IgnorarSegurancaAoConfirmar = 1)'#13#10'    Set @IgnorarSegurancaCount = 0'#13#10''#13#10'  If (@Acao <> 0) And (@IgnorarSegurancaCount = 0)'#13#10'    Insert Into @Acoes (IdBloqueio_Condicional, Acao, Mensagem, Prioridade, IgnorarSegurancaCount) Values (@IdBloqueio_Condicional, @Acao, @Mensagem, @Prioridade, @IgnorarSegurancaCount)'#13#10''#13#10'  Fetch Next From Bloqueio Into'#13#10'    @IdBloqueio_Condicional,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Editar,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Confirmar_Insercao,'#13#10'    @Ao_Confirmar_Edicao,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Bloqueio'#13#10'Deallocate Bloqueio'#13#10''#13#10'SET NOCOUNT OFF'#13#10''#13#10'Select'#13#10'  IdBloqueio_Condicional,'#13#10'  Acao,'#13#10'  Mensagem,'#13#10'  IgnorarSegurancaCount'#13#10'From'#13#10'  @Acoes'#13#10'Order By'#13#10'  Acao Desc,'#13#10'  Prioridade'";"[0][]='122'; [1][]='1440'; [2][]='<Parametros><Evento Classe="TLogisticaHouse" Tipo="2" IgnorarSegurancaCount="4"><Campos><Item Nome="IdLogistica_House" Value="5998"/><Item Nome="IdLogistica_Master" Value="6107"/><Item Nome="IdCliente" Value="54801"/><Item Nome="IdImportador" Value="54801"/><Item Nome="IdExportador"/><Item Nome="IdNotify"/><Item Nome="IdDespachante_Aduaneiro"/><Item Nome="IdRepresentante" Value="54700"/><Item Nome="IdRepresentante_Destino_Final"/><Item Nome="IdSeguradora"/><Item Nome="IdVendedor" Value="54501"/><Item Nome="IdIncoterm" Value="2"/><Item Nome="IdMercadoria"/><Item Nome="IdMoeda_Mercadoria"/><Item Nome="IdStatus_Processo_Logistico"/><Item Nome="IdContrato_Frete"/><Item Nome="IdOferta_Frete" Value="2982"/><Item Nome="IdOferta_Frete_Original" Value="2982"/><Item Nome="IdProcesso_Origem"/><Item Nome="IdProcesso_Origem_Clonagem"/><Item Nome="IdProcesso_Primeiro_Trecho"/><Item Nome="IdTransportadora_Origem"/><Item Nome="IdTransportadora_Destino"/><Item Nome="IdProjeto_Atividade" Value="8594"/><Item Nome="IdEmpresa_Sistema" Value="12"/><Item Nome="IdTipo_Processo" Value="1"/><Item Nome="IdMoeda_Pagamento_Demurrage"/><Item Nome="IdMoeda_Recebimento_Demurrage"/><Item Nome="IdIndicacao"/><Item Nome="IdPais_Origem_Mercadoria"/><Item Nome="IdPais_Destino_Mercadoria"/><Item Nome="IdNVOCC"/><Item Nome="IdFuncionario_Criacao" Value="54979"/><Item Nome="Numero_Processo" Value="IA-YKS-0038-25"/><Item Nome="Numero_Invoices" Value=""/><Item Nome="Referencia_Interna"/><Item Nome="Referencia_Externa" Value=""/><Item Nome="Referencia_Cliente" Value=""/><Item Nome="Senha_Fatura"/><Item Nome="Local_Coleta" Value=""/><Item Nome="Local_Coleta_Destino" Value=""/><Item Nome="Local_Entrega_Origem" Value=""/><Item Nome="Local_Entrega" Value=""/><Item Nome="Local_Emissao_Outro"/><Item Nome="Consolidado_House" Value="0"/><Item Nome="Encaminhado_Por" Value="6"/><Item Nome="Modalidade_Pagamento" Value="3"/><Item Nome="Tipo_Servico" Value="1"/><Item Nome="Tipo_Frete"/><Item Nome="Modalidade_Coleta"/><Item Nome="Modalidade_Entrega"/><Item Nome="Tipo_Coleta_Entrega"/><Item Nome="Tipo_Coleta_Entrega_Destino"/><Item Nome="Tipo_Carga" Value="1"/><Item Nome="Tipo_Projeto" Value="1"/><Item Nome="Trecho" Value="0"/><Item Nome="Comissao_Coleta" Value="0"/><Item Nome="Comissao_Entrega" Value="0"/><Item Nome="Numero_DI_RE"/><Item Nome="Numero_LI_DDE"/><Item Nome="Numero_Courrier"/><Item Nome="Metros_Cubicos"/><Item Nome="Peso_Liquido"/><Item Nome="Peso_Bruto"/><Item Nome="Peso_Cubado"/><Item Nome="Peso_Considerado"/><Item Nome="Quantidade_Volumes"/><Item Nome="Data_Abertura_Processo" Value="12/22/2025 2:06:58 PM"/><Item Nome="Data_Previsao_Prontidao_Carga"/><Item Nome="Data_Prontidao_Carga"/><Item Nome="Data_Liberado_Faturamento"/><Item Nome="Data_Faturado" Value="2/11/2026"/><Item Nome="Data_Recebimento_Local" Value="2/11/2026"/><Item Nome="Data_Pagamento_Local" Value="2/11/2026"/><Item Nome="Data_Acerto_Agente"/><Item Nome="Data_Fechamento_Cambio"/><Item Nome="Data_Auditado"/><Item Nome="Data_Fechamento_Processo" Value="2/11/2026"/><Item Nome="Data_Previsao_Coleta"/><Item Nome="Data_Previsao_Coleta_Destino"/><Item Nome="Data_Coleta"/><Item Nome="Data_Coleta_Destino"/><Item Nome="Data_Previsao_Entrega_Origem"/><Item Nome="Data_Previsao_Entrega"/><Item Nome="Data_Entrega_Origem"/><Item Nome="Data_Entrega"/><Item Nome="Data_Validade_Taxas"/><Item Nome="Data_Chegada_Armazem"/><Item Nome="Canal_Liberacao"/><Item Nome="Local_Emissao"/><Item Nome="Situacao_Agenciamento" Value="5"/><Item Nome="Situacao_Pagamento" Value="3"/><Item Nome="Situacao_Recebimento" Value="3"/><Item Nome="Situacao_Demurrage"/><Item Nome="Situacao_Acerto_Agente" Value="0"/><Item Nome="Situacao_Pre_Finalizado" Value="4"/><Item Nome="Quantidade_Invoices"/><Item Nome="Total_Conhecimentos" Value="1"/><Item Nome="Valor_Mercadoria"/><Item Nome="Importancia_Segurada"/><Item Nome="Percentual_Seguro"/><Item Nome="Agenciamento_Carga" Value="1"/><Item Nome="Desembaraco_Aduaneiro" Value="0"/><Item Nome="Demurrage_Detention" Value="0"/><Item Nome="Tipo_Rota"/><Item Nome="Rota"/><Item Nome="Seguro"/><Item Nome="Carga_Perigosa"/><Item Nome="Carga_Empilhavel"/><Item Nome="Ordem_Compra" Value=""/><Item Nome="NCM_Descricao" Value=""/><Item Nome="Parecer_Auditoria" Value=""/><Item Nome="Instrucoes_Operacional" Value="TESTEEEEEEE"/><Item Nome="Instrucoes_Financeiro" Value="teste"/><Item Nome="Instrucoes_Cliente" Value=""/><Item Nome="Instrucoes_Agente" Value=""/><Item Nome="Instrucoes_Operacional_Cliente" Value=""/><Item Nome="Shipper_Exporter" Value=""/><Item Nome="Consignee" Value="APPLE COMPUTER INC.&'#39'#35'#39'xA;,  - &'#39'#35'#39'xA; -  - &'#39'#35'#39'xA;CPF/CNPJ: "/><Item Nome="Notify" Value=""/><Item Nome="Conhecimentos" Value="TESTEAWB"/><Item Nome="Numeros_Embarque" Value=""/><Item Nome="Observacao" Value=""/><Item Nome="Tipo_Declaracao"/><Item Nome="Data_LI_DDE"/><Item Nome="Data_DI_RE"/><Item Nome="Natureza_Exportacao"/><Item Nome="Data_Averbacao"/><Item Nome="Tipo_Conhecimento_Embarque"/><Item Nome="Numeros_RVS_RAS"/><Item Nome="Numeros_RF_RP"/><Item Nome="Quantidade_UN_Nacoes_Unidas"/><Item Nome="Faturas_Em_Aberto" Value="0"/><Item Nome="IdUltimo_Registro_Baixa" Value="15480"/><Item Nome="Data_Ultima_Baixa" Value="2/11/2026 1:39:28 PM"/><Item Nome="IdMotivo_Cancelamento_Processo"/><Item Nome="IdLogistica_Seguro"/><Item Nome="Data_Cancelamento"/><Item Nome="Detalhes_Cancelamento"/><Item Nome="Situacao_Siscoserv" Value="1"/><Item Nome="Situacao_Tracking"/><Item Nome="Data_Atualizacao_Tracking"/><Item Nome="Comentario_Siscoserv"/><Item Nome="Remarks" Value=""/><Item Nome="Remarks_Terrestre" Value=""/><Item Nome="Remarks_Free_Time" Value=""/><Item Nome="Situacao_Pagamento_Frete" Value="2"/><Item Nome="Data_Pagamento_Frete" Value="2/11/2026"/><Item Nome="Situacao_Recebimento_Frete" Value="2"/><Item Nome="Data_Recebimento_Frete" Value="2/11/2026"/><Item Nome="Ativo" Value="1"/><Item Nome="Atualizacao_Taxas_Comercial" Value="3"/></Campos></Evento></Parametros>'"
"42";"104";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"19";"OK";"1";"'Select'#13#10'  IdLogistica_House, IdLogistica_Master, IdCliente, IdImportador, IdExportador, IdNotify, IdDespachante_Aduaneiro, IdRepresentante, IdRepresentante_Destino_Final, IdSeguradora, IdVendedor, IdIncoterm, IdMercadoria, IdMoeda_Mercadoria, IdStatus_Processo_Logistico, IdContrato_Frete, IdOferta_Frete, IdOferta_Frete_Original, IdProcesso_Origem, IdProcesso_Origem_Clonagem, IdProcesso_Primeiro_Trecho, IdTransportadora_Origem, IdTransportadora_Destino, IdProjeto_Atividade, IdEmpresa_Sistema, IdTipo_Processo, IdMoeda_Pagamento_Demurrage, IdMoeda_Recebimento_Demurrage, IdIndicacao, IdPais_Origem_Mercadoria, IdPais_Destino_Mercadoria, IdNVOCC, IdFuncionario_Criacao, Numero_Processo, Numero_Invoices, Referencia_Interna, Referencia_Externa, Referencia_Cliente, Senha_Fatura, Local_Coleta, Local_Coleta_Destino, Local_Entrega_Origem, Local_Entrega, Local_Emissao_Outro, Consolidado_House, Encaminhado_Por, Modalidade_Pagamento, Tipo_Servico, Tipo_Frete, Modalidade_Coleta, Modalidade_Entrega, Tipo_Coleta_Entrega, Tipo_Coleta_Entrega_Destino, Tipo_Carga, Tipo_Projeto, Trecho, Comissao_Coleta, Comissao_Entrega, Numero_DI_RE, Numero_LI_DDE, Numero_Courrier, Metros_Cubicos, Peso_Liquido, Peso_Bruto, Peso_Cubado, Peso_Considerado, Quantidade_Volumes, Data_Abertura_Processo, Data_Previsao_Prontidao_Carga, Data_Prontidao_Carga, Data_Liberado_Faturamento, Data_Faturado, Data_Recebimento_Local, Data_Pagamento_Local, Data_Acerto_Agente, Data_Fechamento_Cambio, Data_Auditado, Data_Fechamento_Processo, Data_Previsao_Coleta, Data_Previsao_Coleta_Destino, Data_Coleta, Data_Coleta_Destino, Data_Previsao_Entrega_Origem, Data_Previsao_Entrega, Data_Entrega_Origem, Data_Entrega, Data_Validade_Taxas, Data_Chegada_Armazem, Canal_Liberacao, Local_Emissao, Situacao_Agenciamento, Situacao_Pagamento, Situacao_Recebimento, Situacao_Demurrage, Situacao_Acerto_Agente, Situacao_Pre_Finalizado, Quantidade_Invoices, Total_Conhecimentos, Valor_Mercadoria, Importancia_Segurada, Percentual_Seguro, Agenciamento_Carga, Desembaraco_Aduaneiro, Demurrage_Detention, Tipo_Rota, Rota, Seguro, Carga_Perigosa, Carga_Empilhavel, Ordem_Compra, NCM_Descricao, Parecer_Auditoria, Instrucoes_Operacional, Instrucoes_Financeiro, Instrucoes_Cliente, Instrucoes_Agente, Instrucoes_Operacional_Cliente, Shipper_Exporter, Consignee, Notify, Conhecimentos, Numeros_Embarque, Observacao, Tipo_Declaracao, Data_LI_DDE, Data_DI_RE, Natureza_Exportacao, Data_Averbacao, Tipo_Conhecimento_Embarque, Numeros_RVS_RAS, Numeros_RF_RP, Quantidade_UN_Nacoes_Unidas, Faturas_Em_Aberto, IdUltimo_Registro_Baixa, Data_Ultima_Baixa, IdMotivo_Cancelamento_Processo, IdLogistica_Seguro, Data_Cancelamento, Detalhes_Cancelamento, Situacao_Siscoserv, Situacao_Tracking, Data_Atualizacao_Tracking, Comentario_Siscoserv, Remarks, Remarks_Terrestre, Remarks_Free_Time, Situacao_Pagamento_Frete, Data_Pagamento_Frete, Situacao_Recebimento_Frete, Data_Recebimento_Frete, Ativo, Atualizacao_Taxas_Comercial'#13#10'From'#13#10'  mov_Logistica_House'#13#10'Where'#13#10'  IdLogistica_House = ?'";"[0]['0']='5998'"
"42";"103";"";"11/02/2026 13:39:22";"11/02/2026 13:39:22";"19";"OK";"1";"'DECLARE'#13#10'  @IdRegistro_Financeiro IdLongo,'#13#10'  @IdLogistica_House IdLongo,'#13#10'  @Ignorar_Fatura_Vendedor Boleano,'#13#10'  @Ignorar_Fatura_Cancelada Boleano'#13#10''#13#10'SET @IdRegistro_Financeiro = ?'#13#10'SET @IdLogistica_House = ?'#13#10'SET @Ignorar_Fatura_Vendedor = ?'#13#10'SET @Ignorar_Fatura_Cancelada = ?'#13#10''#13#10'IF @IdLogistica_House = 0'#13#10'  Select'#13#10'    @IdLogistica_House = Lhs.IdLogistica_House'#13#10'  From'#13#10'    mov_Logistica_Fatura Lft'#13#10'  Join'#13#10'    mov_Logistica_House Lhs On Lhs.IdLogistica_House = Lft.IdLogistica_House'#13#10'  Where'#13#10'    Lft.IdRegistro_Financeiro = @IdRegistro_Financeiro'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  Lhs.Situacao_Agenciamento,'#13#10'  Lhs.Agenciamento_Carga,'#13#10'  Lhs.Desembaraco_Aduaneiro,'#13#10'  Lhs.Demurrage_Detention,'#13#10'  COALESCE(Lhs.Situacao_Pre_Finalizado, 2 /* Em andamento */) AS Situacao_Pre_Finalizado,'#13#10'  Lhs.Data_Faturado,'#13#10'  Lhs.Data_Auditado,'#13#10'  Lhs.Data_Fechamento_Processo AS Data_Finalizado,'#13#10'  Lms.Tipo_Operacao,'#13#10'  Lms.Modalidade_Processo,'#13#10'  Lms.Data_Desembarque,'#13#10'  Ttl.Quantidade_Faturas,'#13#10'  Ttl.Quantidade_Quitadas,  '#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Faturas = Ttl.Quantidade_Quitadas THEN Ttl.Data_Pagamento'#13#10'    ELSE NULL'#13#10'  End AS Data_Finalizacao,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Pgto = 0 THEN 0 /* Sem pagamento */'#13#10'    WHEN Ttl.Quantidade_Pgto = Ttl.Quitada_Pgto THEN 3 /* Pago */'#13#10'    WHEN Ttl.Quitada_Pgto + Ttl.Parcialmente_Quitada_Pgto > 0 THEN 2 /* Parcialmente pago */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Pagamento,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Pgto > 0) AND (Ttl.Quantidade_Pgto = Ttl.Quitada_Pgto) THEN Ttl.Data_Pagamento_Pgto'#13#10'    ELSE NULL'#13#10'  End AS Data_Pagamento,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Rcbto = 0 THEN 0 /* Sem recebimento */'#13#10'    WHEN (Ttl.Quantidade_Rcbto = Ttl.Quitada_Rcbto) AND (Ttl.Quantidade_Adiantamento = 0 Or ((Ttl.Quantidade_Acerto_Saldo > 0) AND (Ttl.Quantidade_Acerto_Saldo = Ttl.Quitada_Acerto_Saldo))) THEN 3 /* Recebido */'#13#10'    WHEN Ttl.Quitada_Rcbto + Ttl.Parcialmente_Quitada_Rcbto > 0 THEN 2 /* Parcialmente recebido */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Recebimento,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Rcbto > 0) AND (Ttl.Quantidade_Rcbto = Ttl.Quitada_Rcbto) AND (Ttl.Quantidade_Adiantamento = 0 Or ((Ttl.Quantidade_Acerto_Saldo > 0) AND (Ttl.Quantidade_Acerto_Saldo = Ttl.Quitada_Acerto_Saldo))) THEN Ttl.Data_Pagamento_Rcbto'#13#10'    ELSE NULL'#13#10'  End AS Data_Recebimento,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Agente = 0 THEN 0 /* Sem acerto com agente */'#13#10'    WHEN Ttl.Quantidade_Agente = Ttl.Quitada_Agente THEN 3 /* Quitado */'#13#10'    WHEN Ttl.Quitada_Agente + Ttl.Parcialmente_Quitada_Agente > 0 THEN 2 /* Parcialmente quitado */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Acerto_Agente,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Agente > 0) AND (Ttl.Quantidade_Agente = Ttl.Quitada_Agente) THEN Ttl.Data_Pagamento_Agente'#13#10'    ELSE NULL'#13#10'  End AS Data_Acerto_Saldo,'#13#10''#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = 0 THEN 0 /* Sem pagamento */'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = 1 THEN Ttl.Situacao_Pagamento_Frete'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = Ttl.Quitada_Pgto_Frete THEN 2 /* Pago */'#13#10'    WHEN Ttl.Quitada_Pgto_Frete + Ttl.Parcialmente_Quitada_Pgto_Frete > 0 THEN 3 /* Parcialmente pago */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Pagamento_Frete,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Pgto_Frete > 0) AND (Ttl.Quantidade_Pgto_Frete = Ttl.Quitada_Pgto_Frete) THEN Ttl.Data_Pgto_Frete'#13#10'    ELSE NULL'#13#10'  End AS Data_Pagamento_Frete,'#13#10''#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = 0 THEN 0 /* Sem recebimento */'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = 1 THEN Ttl.Situacao_Recebimento_Frete'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = Ttl.Quitada_Rcbto_Frete THEN 2 /* Recebido */'#13#10'    WHEN Ttl.Quitada_Rcbto_Frete + Ttl.Parcialmente_Quitada_Rcbto_Frete > 0 THEN 3 /* Parcialmente recebido */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Recebimento_Frete,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Rcbto_Frete > 0) AND (Ttl.Quantidade_Rcbto_Frete = Ttl.Quitada_Rcbto_Frete) THEN Ttl.Data_Rcbto_Frete'#13#10'    ELSE NULL'#13#10'  End AS Data_Recebimento_Frete'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  mov_Logistica_Master Lms ON Lms.IdLogistica_Master = Lhs.IdLogistica_Master'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Lft.IdLogistica_house,'#13#10'    COUNT(Lft.IdRegistro_Financeiro) AS Quantidade_Faturas,'#13#10'    SUM(CASE'#13#10'      WHEN COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Quitadas,'#13#10'    MAX(COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)) AS Data_Pagamento,'#13#10'    /* PAGAMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Pgto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Pgto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Pgto,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Pgto,'#13#10''#13#10'    /* RECEBIMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de Saldo */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Rcbto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Rcbto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6 ,7) /* Recebimento, Adiantamento e Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Rcbto,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de saldo */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Rcbto,'#13#10''#13#10'    /* ADIANTAMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 6 /* Adiantamento */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Adiantamento,'#13#10''#13#10'    /* ACERTO DE SALDO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 7 /* Acerto de saldo */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Acerto_Saldo,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 7 /* Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Acerto_Saldo,'#13#10''#13#10'    /* AGENTE */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Agente,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Agente,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Agente,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Agente,'#13#10''#13#10'    /* RECEBIMENTO DO FRETE */  '#13#10'    SUM(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Rcbto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Frf.IdRegistro_Recebimento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Rcbto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Frf.IdRegistro_Recebimento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Rcbto_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN COALESCE(Fun.Situacao, Ffn.Situacao)'#13#10'      ELSE 0'#13#10'    END) AS Situacao_Recebimento_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Rcbto_Frete,'#13#10''#13#10'    /* PAGAMENTO DO FRETE */ '#13#10'    SUM(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Pgto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Fpf.IdRegistro_Pagamento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Pgto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Fpf.IdRegistro_Pagamento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Pgto_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN COALESCE(Fun.Situacao, Ffn.Situacao)'#13#10'      ELSE 0'#13#10'    END) AS Situacao_Pagamento_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pgto_Frete'#13#10'  FROM'#13#10'    vis_Logistica_Fatura Lft'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Fatura_Financeira Fun On Fun.IdRegistro_Financeiro = Ffn.IdRegistro_Unificador'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT DISTINCT'#13#10'      Ltx.IdRegistro_Recebimento'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica_Exibicao Tle ON Tle.IdTaxa_Logistica_Exibicao = Ltx.IdTaxa_Logistica_Exibicao'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica Tlg ON Tlg.IdTaxa_Logistica = Tle.IdTaxa_Logistica AND Tlg.Tipo = 1'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Frf ON Frf.IdRegistro_Recebimento = Lft.IdRegistro_Financeiro'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT DISTINCT'#13#10'      Ltx.IdRegistro_Pagamento'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica_Exibicao Tle ON Tle.IdTaxa_Logistica_Exibicao = Ltx.IdTaxa_Logistica_Exibicao'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica Tlg ON Tlg.IdTaxa_Logistica = Tle.IdTaxa_Logistica AND Tlg.Tipo = 1'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Fpf ON Fpf.IdRegistro_Pagamento = Lft.IdRegistro_Financeiro'#13#10'  WHERE'#13#10'    Lft.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    (@Ignorar_Fatura_Vendedor = 0 OR COALESCE(Lft.Tipo_Fatura, 0) <> 8 /* VENDEDOR */)'#13#10'  AND'#13#10'    (@Ignorar_Fatura_Cancelada = 0 OR COALESCE(Fun.Situacao, Ffn.Situacao, 0) <> 6 /* CANCELADA */)'#13#10'  GROUP BY'#13#10'    Lft.IdLogistica_House'#13#10'  ) Ttl ON Ttl.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdRegistro_Financeiro']='15480'; [1]['IdLogistica_House']='0'; [2]['Ignorar_Fatura_Vendedor']='True'; [3]['Ignorar_Fatura_Cancelada']='False'"
"42";"102";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"24";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdCondicao_Pagamento, IdForma_Cobranca, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdConversao_Moeda, IdAtraves_De, IdModelo_Registro_Financeiro, IdGrupo_Financeiro, IdEmpresa_Sistema, IdPessoa_Referencia, IdSetor, IdChave_Externa, Data, Data_Referencia, Numero, Referencia, Referencia_Externa, Natureza, Subtotal, Acrescimo, Tipo_Acrescimo, Abatimento, Tipo_Abatimento, Desconto_Incondicional, Tipo_Desconto_Incondicional, Desconto_Condicional, Tipo_Desconto_Condicional, Dias_Desconto_Condicional, Multa, Tipo_Multa, Juros, Periodo_Juros, Tipo_Juros, Tolerancia_Multa_Juros, Valor_Total, Situacao, Valor_Original, Fator_Corrente, Valor_Corrente, Registro_Unificador, Origem_Lancamento, Historico_Resumo, Codigo_Barras, Historico, Instrucao, Atalho, Observacao, Dados_Registro, Ativo, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  (IdRegistro_Financeiro in'#13#10'  (Select /* Registro da própria fatura */'#13#10'    Ffn.IdRegistro_Financeiro'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Where'#13#10'    Ffn.IdFatura_Financeira = 15849'#13#10'  Union'#13#10'  Select /* Registros das faturas unificadas */'#13#10'    Fun.IdRegistro_Financeiro'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Join'#13#10'    mov_Registro_Financeiro Rfn On Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'  Left Outer Join'#13#10'    mov_Fatura_Financeira Fun On Fun.IdRegistro_Unificador = Rfn.IdRegistro_Financeiro'#13#10'  Where'#13#10'    Ffn.IdFatura_Financeira = 15849))'";""
"42";"101";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"0";"OK";"1";"'update mov_Registro_Financeiro  set'#13#10' Situacao = ?,'#13#10' Hash = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdRegistro_Financeiro = ?'";"[0]['Param1']='1'; [1]['Param2']='ecdfa001828df4057a3a719e3ee38f42'; [2]['Param3']='11/02/2026 13:39:50'; [3]['Param4']='15480'"
"42";"100";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"16";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, Hash'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  IdRegistro_Financeiro = ?'";"[0]['0']='15480'"
"42";"99";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"16";"OK";"1";"'Select'#13#10'  Srf.IdRegistro_Financeiro,'#13#10'  Case'#13#10'    When Srf.Quantidade_Faturas = Srf.Quantidade_Canceladas Then 3 /* Cancelado */'#13#10'    When Srf.Quantidade_Faturas = (Srf.Quantidade_Quitadas + Srf.Quantidade_Unificadas + Srf.Quantidade_Canceladas) Then 2 /* Finalizado */'#13#10'    When Srf.Quantidade_Quitadas + Srf.Quantidade_Parcialmente_Quitadas > 0 Then 4 /* Parcialmente Quitado */'#13#10'    Else 1 /* Em aberto */'#13#10'  End As Situacao'#13#10'From'#13#10'  (Select'#13#10'    Ffn.IdRegistro_Financeiro,'#13#10'    Count(Ffn.IdFatura_Financeira) As Quantidade_Faturas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 2 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Quitadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 4 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Unificadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 3 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Parcialmente_Quitadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 6 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Canceladas'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Where'#13#10'    Ffn.IdRegistro_Financeiro = ?'#13#10'  Group By'#13#10'    Ffn.IdRegistro_Financeiro'#13#10'  ) Srf'";"[0]['IdRegistro_Financeiro']='15480'"
"42";"98";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"14";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdCondicao_Pagamento, IdForma_Cobranca, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdConversao_Moeda, IdAtraves_De, IdModelo_Registro_Financeiro, IdGrupo_Financeiro, IdEmpresa_Sistema, IdPessoa_Referencia, IdSetor, IdChave_Externa, Data, Data_Referencia, Numero, Referencia, Referencia_Externa, Natureza, Subtotal, Acrescimo, Tipo_Acrescimo, Abatimento, Tipo_Abatimento, Desconto_Incondicional, Tipo_Desconto_Incondicional, Desconto_Condicional, Tipo_Desconto_Condicional, Dias_Desconto_Condicional, Multa, Tipo_Multa, Juros, Periodo_Juros, Tipo_Juros, Tolerancia_Multa_Juros, Valor_Total, Situacao, Valor_Original, Fator_Corrente, Valor_Corrente, Registro_Unificador, Origem_Lancamento, Historico_Resumo, Codigo_Barras, Historico, Instrucao, Atalho, Observacao, Dados_Registro, Ativo, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  IdRegistro_Financeiro = ?'";"[0]['0']='15480'"
"42";"97";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"0";"OK";"1";"'update mov_Fatura_Financeira  set'#13#10' Data_Pagamento = ?,'#13#10' Situacao = ?,'#13#10' Valor_Residual = ?,'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Corrente = ?,'#13#10' Em_Aberto = ?,'#13#10' Hash = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdFatura_Financeira = ?'";""
"42";"96";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"8";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"42";"95";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"12";"OK";"1";"'DECLARE'#13#10'  @IdFatura_Financeira IdLongo,'#13#10'  @Valor Moeda'#13#10''#13#10'SET @IdFatura_Financeira = ?'#13#10'SET @Valor = ?'#13#10''#13#10'SELECT'#13#10'  Ttl.IdFatura_Financeira,'#13#10'  Ttl.Total_Pago,'#13#10'  Ttl.Total_Pago_Corrente,'#13#10'  Ttl.Total_Multa,'#13#10'  Ttl.Total_Juros,'#13#10'  Ttl.Total_Acrescimo,'#13#10'  Ttl.Total_Desconto,'#13#10'  Ttl.Total_Abatimento,'#13#10'  (ISNULL(@Valor, 0)'#13#10'    - ISNULL(Ttl.Total_Pago, 0)'#13#10'    + ISNULL(Ttl.Total_Multa, 0)'#13#10'    + ISNULL(Ttl.Total_Juros, 0)'#13#10'    + ISNULL(Ttl.Total_Acrescimo, 0)'#13#10'    - ISNULL(Ttl.Total_Desconto, 0)'#13#10'    - ISNULL(Ttl.Total_Abatimento, 0)) As Valor_Residual,'#13#10'  ISNULL(Ttl.Data_Pagamento, GETDATE()) As Data_Pagamento,'#13#10'  Ttl.Quantidade_Baixas'#13#10'FROM'#13#10'  (SELECT'#13#10'    Ffn.IdFatura_Financeira,'#13#10'    MAX(Mfn.Data) As Data_Pagamento,'#13#10'    SUM(Ffb.Valor_Total) As Total_Pago,'#13#10'    SUM(Ffb.Valor_Multa) As Total_Multa,'#13#10'    SUM(Ffb.Valor_Juros) As Total_Juros,'#13#10'    SUM(Ffb.Valor_Acrescimo) As Total_Acrescimo,'#13#10'    SUM(Ffb.Valor_Desconto) As Total_Desconto,'#13#10'    SUM(Ffb.Valor_Abatimento) As Total_Abatimento,'#13#10'    SUM(Ffb.Valor_Total_Corrente) As Total_Pago_Corrente,'#13#10'    COUNT(Ffb.IdFatura_Financeira_Baixa) AS Quantidade_Baixas'#13#10'  FROM'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Fatura_Financeira_Baixa Ffb On Ffb.IdFatura_Financeira = Ffn.IdFatura_Financeira'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Movimentacao_Financeira Mfn On Mfn.IdMovimentacao_Financeira = Ffb.IdMovimentacao_Financeira  '#13#10'  WHERE'#13#10'    Ffn.IdFatura_Financeira = @IdFatura_Financeira'#13#10'  GROUP BY'#13#10'    Ffn.IdFatura_Financeira'#13#10'  ) AS Ttl'";"[0]['IdFatura_Financeira']='15849'; [1]['Valor']='1625,66'"
"42";"94";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"24";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, IdRegistro_Financeiro, IdForma_Cobranca, IdResponsavel_Titulo, IdResponsavel_Conferencia, IdResponsavel_Unificacao, IdResponsavel_Cancelamento, IdResponsavel_Cobranca, IdResponsavel_Cobranca_Judic, IdResponsavel_Protesto, IdResponsavel_Negativacao, IdResponsavel_Renegociacao, IdRegistro_Unificador, IdMarcador_Fatura_Financeira, IdMarcador_Auditoria, Numero, Referencia_Externa, Data, Tipo, Data_Vencimento, Previsao_Pagamento, Data_Pagamento, Data_Conferencia, Situacao, Prioridade, Natureza, Valor, Valor_Original, Valor_Residual, Total_Pago, Total_Pago_Corrente, Total_Multa, Total_Juros, Total_Acrescimo, Total_Desconto, Total_Abatimento, Conferido, Parcela, Numero_Cobranca, Em_Aberto, Fator_Unificacao, Historico_Resumo, Historico, Data_Envio, Data_Unificacao, Data_Cancelamento, Data_Cobranca, Data_Cobranca_Judicial, Data_Negativacao, Data_Protesto, Data_Renegociacao, Numero_Nota_Fiscal, Data_Nota_Fiscal, Valor_Nota_Fiscal, Coligada, Renegociada, Competencia, Ativo, Observacao, Hash, Data_Ultima_Alteracao, IdFechamento_Cambio, Data_Primeiro_Vencimento, Porcentagem, Valor_Corrente'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"42";"93";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"16";"OK";"1";"'delete from mov_Fatura_Financeira_Baixa '#13#10'where'#13#10' IdFatura_Financeira_Baixa = ?'";"[0]['Param1']='2002'"
"42";"92";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"13";"OK";"1";"'delete from mov_Movimentacao_Financeira_Categoria '#13#10'where'#13#10' IdMovimentacao_Categoria = ?'";"[0]['Param1']='2058'"
"42";"91";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"15";"OK";"1";"'delete from mov_Movimentacao_Financeira_Custo '#13#10'where'#13#10' IdMovimentacao_Financeira_Custo = ?'";"[0]['Param1']='3337'"
"42";"90";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"4";"OK";"1";"'Select'#13#10'  IdMovimentacao_Financeira_Custo, IdMovimentacao_Categoria, IdCentro_Custo, IdFatura_Financeira_Custo, IdFatura_Financeira_Baixa, Valor, Natureza, Valor_Convertido, Observacao, Ativo'#13#10'From'#13#10'  mov_Movimentacao_Financeira_Custo'#13#10'Where'#13#10'  IdMovimentacao_Categoria = ?'";"[0]['0']='2058'"
"42";"89";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"11";"OK";"1";"'Select'#13#10'  IdMovimentacao_Categoria, IdMovimentacao_Financeira, IdCategoria_Financeira, IdFatura_Financeira_Categoria, IdFatura_Financeira_Baixa, Tipo_Custo, Valor, Natureza, Valor_Convertido, Observacao, Ativo'#13#10'From'#13#10'  mov_Movimentacao_Financeira_Categoria'#13#10'Where'#13#10'  IdFatura_Financeira_Baixa = ?'";"[0]['0']='2002'"
"42";"88";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"19";"OK";"1";"'Select'#13#10'  IdFatura_Financeira_Baixa, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa'#13#10'Where'#13#10'  IdFatura_Financeira_Baixa = ?'";"[0]['0']='2002'"
"42";"87";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"19";"OK";"1";"'Select'#13#10'  IdMovimentacao_Financeira, Numero, Origem_Lancamento, Conciliada'#13#10'From'#13#10'  mov_Movimentacao_Financeira'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"42";"86";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"26";"OK";"1";"'Select'#13#10'  IdFatura_Financeira_Baixa, IdFatura_Financeira, IdMovimentacao_Financeira, Valor_Total, Valor_Multa, Valor_Juros, Valor_Acrescimo, Valor_Desconto, Valor_Abatimento, Valor_Total_Corrente, Fator_Conversao, Valor_Convertido, Tipo_Baixa, Gerar_Recibo, Numero_Recibo, Proveniencia, Observacao, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa'#13#10'Where'#13#10'  IdFatura_Financeira_Baixa = ?'";"[0]['0']='2002'"
"42";"85";"";"11/02/2026 13:39:49";"11/02/2026 13:39:49";"0";"OK";"0";"'START TANSACTION'";""
"41";"84";"";"11/02/2026 13:39:21";"11/02/2026 13:39:21";"0";"OK";"-1";"'/*PING*/;'";""
"40";"83";"";"11/02/2026 13:39:15";"11/02/2026 13:39:15";"5";"OK";"1";"'Select'#13#10'  Ffb.IdFatura_Financeira_Baixa,'#13#10'  Ffb.IdFatura_Financeira,'#13#10'  Ffb.IdMovimentacao_Financeira,'#13#10'  Ffb.Valor_Total,'#13#10'  Ffb.Valor_Multa,'#13#10'  Ffb.Valor_Juros,'#13#10'  Ffb.Valor_Acrescimo,'#13#10'  Ffb.Valor_Desconto,'#13#10'  Ffb.Valor_Abatimento,'#13#10'  Ffb.Valor_Total_Corrente,'#13#10'  Ffb.Valor_Convertido,'#13#10'  Ffb.Fator_Conversao,'#13#10'  Ffb.Tipo_Baixa,'#13#10'  Ffb.Gerar_Recibo,'#13#10'  Ffb.Numero_Recibo,'#13#10'  Ffb.Proveniencia,'#13#10'  Ffb.Observacao,'#13#10'  Ffb.Hash,'#13#10'  Ffb.Data_Ultima_Alteracao,'#13#10'  Mfn.IdConta_Corrente,'#13#10'  Mfn.IdForma_Pagamento,'#13#10'  Mfn.Data,'#13#10'  Mfn.Data_Lancamento,'#13#10'  Mfn.Nota_Recibo_Conferido,'#13#10'  Mfn.Variacao_Cambial,'#13#10'  Ccr.Nome as Conta_Corrente,'#13#10'  Fpg.Nome as Forma_Pagamento,'#13#10'  Ffn.IdRegistro_Financeiro,'#13#10'  Ffn.Numero As Numero_Fatura,'#13#10'  Rfn.IdMoeda,'#13#10'  Mda.Nome as Moeda'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa Ffb'#13#10'Left Outer Join'#13#10'  mov_Movimentacao_Financeira Mfn on Mfn.IdMovimentacao_Financeira = Ffb.IdMovimentacao_Financeira'#13#10'Left Outer Join'#13#10'  cad_Conta_Corrente Ccr on Ccr.IdConta_Corrente = Mfn.IdConta_Corrente'#13#10'Left Outer Join'#13#10'  cad_Forma_Pagamento Fpg on Fpg.IdForma_Pagamento = Mfn.IdForma_Pagamento'#13#10'Left Outer Join'#13#10'  mov_Fatura_Financeira Ffn on Ffn.IdFatura_Financeira = Ffb.IdFatura_Financeira'#13#10'Left Outer Join'#13#10'  mov_Registro_Financeiro Rfn on Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'Left Outer Join'#13#10'  cad_Moeda Mda on Mda.IdMoeda = Rfn.IdMoeda'#13#10'Where'#13#10'  Ffb.IdFatura_Financeira = ?'";"[0]['IdFatura_Financeira']='15849'"
"39";"82";"";"11/02/2026 13:39:13";"11/02/2026 13:39:13";"31";"OK";"-1";"'/*PING*/;'";""
"38";"81";"";"11/02/2026 13:39:06";"11/02/2026 13:39:06";"9";"OK";"1";"'Select'#13#10'  IdLogistica_House, IdLogistica_Master, IdCliente, IdImportador, IdExportador, IdNotify, IdDespachante_Aduaneiro, IdRepresentante, IdRepresentante_Destino_Final, IdSeguradora, IdVendedor, IdIncoterm, IdMercadoria, IdMoeda_Mercadoria, IdStatus_Processo_Logistico, IdContrato_Frete, IdOferta_Frete, IdOferta_Frete_Original, IdProcesso_Origem, IdProcesso_Origem_Clonagem, IdProcesso_Primeiro_Trecho, IdTransportadora_Origem, IdTransportadora_Destino, IdProjeto_Atividade, IdEmpresa_Sistema, IdTipo_Processo, IdMoeda_Pagamento_Demurrage, IdMoeda_Recebimento_Demurrage, IdIndicacao, IdPais_Origem_Mercadoria, IdPais_Destino_Mercadoria, IdNVOCC, IdFuncionario_Criacao, Numero_Processo, Numero_Invoices, Referencia_Interna, Referencia_Externa, Referencia_Cliente, Senha_Fatura, Local_Coleta, Local_Coleta_Destino, Local_Entrega_Origem, Local_Entrega, Local_Emissao_Outro, Consolidado_House, Encaminhado_Por, Modalidade_Pagamento, Tipo_Servico, Tipo_Frete, Modalidade_Coleta, Modalidade_Entrega, Tipo_Coleta_Entrega, Tipo_Coleta_Entrega_Destino, Tipo_Carga, Tipo_Projeto, Trecho, Comissao_Coleta, Comissao_Entrega, Numero_DI_RE, Numero_LI_DDE, Numero_Courrier, Metros_Cubicos, Peso_Liquido, Peso_Bruto, Peso_Cubado, Peso_Considerado, Quantidade_Volumes, Data_Abertura_Processo, Data_Previsao_Prontidao_Carga, Data_Prontidao_Carga, Data_Liberado_Faturamento, Data_Faturado, Data_Recebimento_Local, Data_Pagamento_Local, Data_Acerto_Agente, Data_Fechamento_Cambio, Data_Auditado, Data_Fechamento_Processo, Data_Previsao_Coleta, Data_Previsao_Coleta_Destino, Data_Coleta, Data_Coleta_Destino, Data_Previsao_Entrega_Origem, Data_Previsao_Entrega, Data_Entrega_Origem, Data_Entrega, Data_Validade_Taxas, Data_Chegada_Armazem, Canal_Liberacao, Local_Emissao, Situacao_Agenciamento, Situacao_Pagamento, Situacao_Recebimento, Situacao_Demurrage, Situacao_Acerto_Agente, Situacao_Pre_Finalizado, Quantidade_Invoices, Total_Conhecimentos, Valor_Mercadoria, Importancia_Segurada, Percentual_Seguro, Agenciamento_Carga, Desembaraco_Aduaneiro, Demurrage_Detention, Tipo_Rota, Rota, Seguro, Carga_Perigosa, Carga_Empilhavel, Ordem_Compra, NCM_Descricao, Parecer_Auditoria, Instrucoes_Operacional, Instrucoes_Financeiro, Instrucoes_Cliente, Instrucoes_Agente, Instrucoes_Operacional_Cliente, Shipper_Exporter, Consignee, Notify, Conhecimentos, Numeros_Embarque, Observacao, Tipo_Declaracao, Data_LI_DDE, Data_DI_RE, Natureza_Exportacao, Data_Averbacao, Tipo_Conhecimento_Embarque, Numeros_RVS_RAS, Numeros_RF_RP, Quantidade_UN_Nacoes_Unidas, Faturas_Em_Aberto, IdUltimo_Registro_Baixa, Data_Ultima_Baixa, IdMotivo_Cancelamento_Processo, IdLogistica_Seguro, Data_Cancelamento, Detalhes_Cancelamento, Situacao_Siscoserv, Situacao_Tracking, Data_Atualizacao_Tracking, Comentario_Siscoserv, Remarks, Remarks_Terrestre, Remarks_Free_Time, Situacao_Pagamento_Frete, Data_Pagamento_Frete, Situacao_Recebimento_Frete, Data_Recebimento_Frete, Ativo, Atualizacao_Taxas_Comercial'#13#10'From'#13#10'  mov_Logistica_House'#13#10'Where'#13#10'  IdLogistica_House = ?'";"[0]['0']='5998'"
"37";"80";"";"11/02/2026 13:39:03";"11/02/2026 13:39:03";"30";"OK";"1";"'Select Lah.IdLogistica_House, Lah.Peso_Taxado, Lah.IdResponsavel_Validacao_Mantra, Lah.Mantra_Validado, Lah.Data_Validacao_Mantra, Coalesce(Lah.Situacao_CCT, 0) as Situacao_CCT, Lhs.IdLogistica_Master, Lhs.IdCliente, Lhs.IdImportador, Lhs.IdExportador, Lhs.IdNotify, Lhs.IdDespachante_Aduaneiro, Lhs.IdRepresentante, Lhs.IdRepresentante_Destino_Final, Lhs.IdSeguradora, Lhs.IdVendedor, Lhs.IdIncoterm, Lhs.IdMercadoria, Lhs.IdMoeda_Mercadoria, Lhs.IdTransportadora_Origem, Lhs.IdTransportadora_Destino, Lhs.IdStatus_Processo_Logistico, Lah.IdNivel_Servico_Aereo, Lhs.IdContrato_Frete, Lhs.IdOferta_Frete, Coalesce(Lhs.IdProcesso_Origem, Lhs.IdProcesso_Origem_Clonagem) as IdProcesso_Origem, Lhs.IdProjeto_Atividade, Lhs.IdEmpresa_Sistema, Lhs.IdTipo_Processo, Lhs.IdIndicacao, Lhs.IdPais_Origem_Mercadoria, Lhs.IdPais_Destino_Mercadoria, Lhs.IdNVOCC, Lhs.Numero_Processo, Lhs.Referencia_Interna, Lhs.Referencia_Externa, Lhs.Referencia_Cliente, Lhs.Senha_Fatura, Lhs.Encaminhado_Por, Lhs.Modalidade_Pagamento, Lhs.Comissao_Coleta, Lhs.Modalidade_Coleta, Lhs.Local_Coleta, Lhs.Local_Coleta_Destino, Lhs.Local_Entrega_Origem, Lhs.Local_Entrega, Lhs.Local_Emissao_Outro, Lhs.Comissao_Entrega, Lhs.Modalidade_Entrega, Lhs.Total_Conhecimentos, Lhs.Metros_Cubicos, Lhs.Tipo_Servico, Lhs.Tipo_Carga, Lhs.Tipo_Coleta_Entrega, Lhs.Tipo_Coleta_Entrega_Destino, Lah.Tipo_Servico_Aereo, Lhs.Tipo_Projeto, Lhs.Tipo_Rota, Lhs.Rota, Lhs.Canal_Liberacao, Lhs.Local_Emissao, Lhs.Trecho, Lhs.Peso_Liquido, Lhs.Peso_Bruto, Lhs.Peso_Cubado, Lhs.Peso_Considerado, Lhs.Quantidade_Volumes, Lhs.Quantidade_Invoices, Lhs.Valor_Mercadoria, Lhs.Importancia_Segurada, Lhs.Percentual_Seguro, Lhs.Numero_Invoices, Lhs.Numero_DI_RE, Lhs.Numero_LI_DDE, Lhs.Data_Abertura_Processo, Lhs.Data_Previsao_Prontidao_Carga, Lhs.Data_Prontidao_Carga, Lhs.Data_Previsao_Coleta, Lhs.Data_Previsao_Coleta_Destino, Lhs.Data_Coleta, Lhs.Data_Coleta_Destino, Lhs.Data_Previsao_Entrega_Origem, Lhs.Data_Previsao_Entrega, Lhs.Data_Entrega_Origem, Lhs.Data_Entrega, Lhs.Data_Recebimento_Local, Lhs.Data_Pagamento_Local, Lhs.Data_Acerto_Agente, Lhs.Data_Fechamento_Cambio, Lhs.Data_Auditado, Lhs.Data_Fechamento_Processo, Lhs.Data_Faturado, Lhs.Data_Liberado_Faturamento, Lhs.Data_Validade_Taxas, Lhs.Situacao_Agenciamento, Lhs.Situacao_Pagamento, Lhs.Situacao_Recebimento, Lhs.Situacao_Acerto_Agente, Lhs.Situacao_Demurrage, Lhs.Situacao_Pre_Finalizado, Lhs.Faturas_Em_Aberto, Lhs.Agenciamento_Carga, Lhs.Desembaraco_Aduaneiro, Lhs.Demurrage_Detention, Lhs.Consolidado_House, Lhs.Seguro, Lhs.Carga_Perigosa, Lhs.Quantidade_UN_Nacoes_Unidas, Lhs.Instrucoes_Operacional, Lhs.Instrucoes_Financeiro, Lhs.Instrucoes_Cliente, Lhs.Instrucoes_Agente, Lhs.Instrucoes_Operacional_Cliente, Lhs.Remarks, Lhs.Remarks_Terrestre, Lhs.Remarks_Free_Time, Lhs.NCM_Descricao, Lhs.Ordem_Compra, Lhs.Parecer_Auditoria, Lhs.Shipper_Exporter, Lhs.Consignee, Lhs.Notify, Lhs.Ativo, Lhs.Observacao, Lhs.IdMotivo_Cancelamento_Processo, Lhs.IdLogistica_Seguro, Lhs.Data_Cancelamento, Lhs.Detalhes_Cancelamento, Lhs.Situacao_Siscoserv, Lhs.Comentario_Siscoserv, Lms.Numero_Processo as Logistica_Master, Cln.Nome as Cliente, Imp.Nome as Importador, Exp.Nome as Exportador, Ntf.Nome as Notify_Nome, Dad.Nome as Despachante_Aduaneiro, Rpr.Nome as Representante, Rdf.Nome as Representante_Destino_Final, Sgr.Nome As Seguradora, Vnd.Nome as Vendedor, Inc.Nome as Incoterm, Mrc.Nome as Mercadoria, Mrc.IdGrupo_Mercadoria, Gmr.Nome As Grupo_Mercadoria, Mmr.Nome as Moeda_Mercadoria, Tor.Nome as Transportadora_Origem, Tds.Nome as Transportadora_Destino, Spl.Descricao as Status_Processo_Logistico, Nsa.Descricao as Nivel_Servico_Aereo, Cfr.Numero_Contrato as Contrato_Frete, Ofr.Numero_Oferta as Oferta_Frete, Ofo.Numero_Oferta as Oferta_Frete_Original, Por.Numero_Processo as Processo_Origem, Ess.Nome as Empresa_Sistema, Tpr.Nome as Tipo_Processo, Ind.Nome As Indicacao, Lhs.Tipo_Declaracao, Lhs.Data_LI_DDE, Lhs.Data_DI_RE, Lhs.Natureza_Exportacao, Lhs.Data_Averbacao, Lhs.Tipo_Conhecimento_Embarque, Pom.Nome As Pais_Origem_Mercadoria, Pdm.Nome As Pais_Destino_Mercadoria, Rvm.Nome As Responsavel_Validacao_Mantra, Nvo.Nome As NVOCC, Mcn.Nome As Motivo_Cancelamento_Processo, Lsg.Numero_Apolice As Numero_Apolice From mov_Logistica_Aerea_House Lah Left Outer Join mov_Logistica_House Lhs on Lhs.IdLogistica_House = Lah.IdLogistica_House Left Outer Join mov_Logistica_House Por on Por.IdLogistica_House = Coalesce(Lhs.IdProcesso_Origem, Lhs.IdProcesso_Origem_Clonagem) Left Outer Join mov_Logistica_Master Lms on Lms.IdLogistica_Master = Lhs.IdLogistica_Master Left Outer Join vis_Cliente Cln on Cln.IdPessoa = Lhs.IdCliente Left Outer Join vis_Cliente Imp on Imp.IdPessoa = Lhs.IdImportador Left Outer Join vis_Cliente Exp on Exp.IdPessoa = Lhs.IdExportador Left Outer Join vis_Cliente Ntf on Ntf.IdPessoa = Lhs.IdNotify Left Outer Join vis_Despachante_Aduaneiro Dad on Dad.IdPessoa = Lhs.IdDespachante_Aduaneiro Left Outer Join vis_Representante_Colaborador Rpr on Rpr.IdPessoa = Lhs.IdRepresentante Left Outer Join vis_Representante_Colaborador Rdf on Rdf.IdPessoa = Lhs.IdRepresentante_Destino_Final Left Outer Join vis_Seguradora Sgr On Sgr.IdPessoa = Lhs.IdSeguradora Left Outer Join vis_Funcionario Vnd on Vnd.IdPessoa = Lhs.IdVendedor Left Outer Join cad_Incoterm Inc on Inc.IdIncoterm = Lhs.IdIncoterm Left Outer Join cad_Mercadoria Mrc on Mrc.IdMercadoria = Lhs.IdMercadoria Left Outer Join cad_Grupo_Mercadoria Gmr On Gmr.IdGrupo_Mercadoria = Mrc.IdGrupo_Mercadoria Left Outer Join cad_Moeda Mmr on Mmr.IdMoeda = Lhs.IdMoeda_Mercadoria Left Outer Join vis_Companhia_Transporte Tor on Tor.IdPessoa = Lhs.IdTransportadora_Origem Left Outer Join vis_Companhia_Transporte Tds on Tds.IdPessoa = Lhs.IdTransportadora_Destino Left Outer Join cad_Status_Processo_Logistico Spl on Spl.IdStatus_Processo_Logistico = Lhs.IdStatus_Processo_Logistico Left Outer Join cad_Nivel_Servico_Aereo Nsa on Nsa.IdNivel_Servico_Aereo = Lah.IdNivel_Servico_Aereo Left Outer Join mov_Contrato_Frete Cfr on Cfr.IdContrato_Frete = Lhs.IdContrato_Frete Left Outer Join mov_Oferta_Frete Ofr on Ofr.IdOferta_Frete = Lhs.IdOferta_Frete Left Outer Join mov_Oferta_Frete Ofo on Ofo.IdOferta_Frete = Lhs.IdOferta_Frete_Original Left Outer Join sys_Empresa_Sistema Ess on Ess.IdEmpresa_Sistema = Lhs.IdEmpresa_Sistema Left Outer Join cad_Tipo_Processo Tpr on Tpr.IdTipo_Processo = Lhs.IdTipo_Processo Left Outer Join cad_Pessoa Ind On Ind.IdPessoa = Lhs.IdIndicacao Left Outer Join cad_Pais Pom On Pom.IdPais = Lhs.IdPais_Origem_Mercadoria Left Outer Join cad_Pais Pdm On Pdm.IdPais = Lhs.IdPais_Destino_Mercadoria Left Outer Join vis_Funcionario Rvm On Rvm.IdPessoa = Lah.IdResponsavel_Validacao_Mantra Left Outer Join vis_NVOCC Nvo On Nvo.IdPessoa = Lhs.IdNVOCC Left Outer Join cad_Motivo_Cancelamento_Processo Mcn On Mcn.IdMotivo_Cancelamento_Processo = Lhs.IdMotivo_Cancelamento_Processo Left Outer Join mov_Logistica_Seguro Lsg On Lsg.IdLogistica_Seguro = Lhs.IdLogistica_Seguro  Where (Lah.IdLogistica_House = ?)'";"[0]['Logistica_Aerea_House_IdLogistica_House']='5998'"
"36";"79";"";"11/02/2026 13:39:03";"11/02/2026 13:39:03";"21";"OK";"-1";"'/*PING*/;'";""
"35";"78";"";"11/02/2026 13:39:01";"11/02/2026 13:39:01";"27";"OK";"2";"'DECLARE'#13#10'  @IdLogistica_House IdLongo,'#13#10'  @Visualizar_Comissoes_Agente TipoFixo,'#13#10'  @Visualizar_Comissoes_Vendedor TipoFixo,'#13#10'  @Visualizar_Comissoes_Outro_Vend TipoFixo,'#13#10'  @Visualizar_Comissoes_Represent TipoFixo,'#13#10'  @Visualizar_Comissoes_Contato TipoFixo,'#13#10'  @Visualizar_Comissoes_Outro TipoFixo,'#13#10'  @Visualizar_Comissoes_Associac TipoFixo,'#13#10'  @IdFuncionario IdMedio,'#13#10'  @Comissoes_Restritas TipoFixo'#13#10''#13#10'SET @IdLogistica_House = ?'#13#10'SET @Visualizar_Comissoes_Agente = ?'#13#10'SET @Visualizar_Comissoes_Vendedor = ?'#13#10'SET @Visualizar_Comissoes_Outro_Vend = ?'#13#10'SET @Visualizar_Comissoes_Represent = ?'#13#10'SET @Visualizar_Comissoes_Contato = ?'#13#10'SET @Visualizar_Comissoes_Outro = ?'#13#10'SET @Visualizar_Comissoes_Associac = ?'#13#10'SET @IdFuncionario = ?'#13#10'SET @Comissoes_Restritas = ?'#13#10''#13#10'SELECT'#13#10'  Lft.IdRegistro_Financeiro,'#13#10'  Lft.IdLogistica_Master,'#13#10'  Lft.IdLogistica_House,'#13#10'  Lft.IdConversao_Taxas,'#13#10'  Lft.IdResponsavel_Faturamento,'#13#10'  Lft.Tipo_Fatura,'#13#10'  Lft.Local_Cobranca,'#13#10'  Lft.Opcao_Data_Referencia,'#13#10'  Lft.Dias_Tolerancia,'#13#10'  Lft.Opcao_Data_Conversao,'#13#10'  Lft.Data_Conversao,'#13#10'  Lft.Data_Faturamento,'#13#10'  Lft.Data_Primeira_Finalizacao,'#13#10'  Lft.Margem_Acrescimo_Cambio,'#13#10'  Lft.Conferido_Operacional,'#13#10'  Lft.Modalidade_Pagamento,'#13#10'  Lft.IdTipo_Transacao,'#13#10'  Lft.IdPessoa,'#13#10'  Lft.IdConta_Pessoa,'#13#10'  Lft.IdCondicao_Pagamento,'#13#10'  Lft.IdForma_Cobranca,'#13#10'  Lft.IdForma_Pagamento,'#13#10'  Lft.IdConta_Corrente,'#13#10'  Lft.IdMoeda,'#13#10'  Lft.IdConversao_Moeda,'#13#10'  Lft.IdEmpresa_Sistema,'#13#10'  Lft.Data,'#13#10'  Lft.Data_Referencia,'#13#10'  Lft.Numero,'#13#10'  Lft.Referencia,'#13#10'  Lft.Referencia_Externa,'#13#10'  Lft.Natureza,'#13#10'  Lft.Subtotal,'#13#10'  Lft.Acrescimo,'#13#10'  Lft.Tipo_Acrescimo,'#13#10'  Lft.Abatimento,'#13#10'  Lft.Tipo_Abatimento,'#13#10'  Lft.Desconto_Incondicional,'#13#10'  Lft.Tipo_Desconto_Incondicional,'#13#10'  Lft.Desconto_Condicional,'#13#10'  Lft.Tipo_Desconto_Condicional,'#13#10'  Lft.Dias_Desconto_Condicional,'#13#10'  Lft.Multa,'#13#10'  Lft.Tipo_Multa,'#13#10'  Lft.Juros,'#13#10'  Lft.Periodo_Juros,'#13#10'  Lft.Tipo_Juros,'#13#10'  Lft.Tolerancia_Multa_Juros,'#13#10'  Lft.Valor_Total,'#13#10'  Lft.Situacao,'#13#10'  Lft.Valor_Original,'#13#10'  Lft.Historico,'#13#10'  Lft.Instrucao,'#13#10'  Lft.Atalho,'#13#10'  Lft.Dados_Registro,'#13#10'  Lft.Observacao,'#13#10'  Lft.Hash AS Hash_Registro,'#13#10'  Ctx.Nome AS Conversao_Taxas,'#13#10'  Ttr.Nome AS Tipo_Transacao,'#13#10'  Psa.Nome AS Pessoa,'#13#10'  Psa.Cpf_Cnpj AS Pessoa_Cpf_Cnpj,'#13#10'  Cps.Nome AS Conta_Pessoa,'#13#10'  Cpg.Nome AS Condicao_Pagamento,'#13#10'  Fcb.Nome AS Forma_Cobranca,'#13#10'  Fpg.Nome AS Forma_Pagamento,'#13#10'  Ccr.Nome AS Conta_Corrente,'#13#10'  Mda.Sigla AS Moeda,'#13#10'  Cmd.Nome AS Conversao_Moeda,'#13#10'  Ess.Nome AS Empresa_Sistema,'#13#10'  Rft.Nome AS Responsavel_Faturamento,'#13#10'  CASE'#13#10'    WHEN NOT (Lft.IdLogistica_Master IS NULL) THEN 1 /* Master */'#13#10'    ELSE 0 /* House */'#13#10'  END AS Master_House,'#13#10'  Lhs.Trecho,'#13#10'  Ffn.IdFatura_Financeira,'#13#10'  Ffn.IdRegistro_Unificador,'#13#10'  Ffn.Quantidade_Faturas,'#13#10'  Ffn.Total_Residual,'#13#10'  Ffn.Primeiro_Vencimento,'#13#10'  Ffn.Ultimo_Pagamento,'#13#10'  Ffn.Tipo,'#13#10'  Ffn.Bloqueio,'#13#10'  Ffn.Hash AS Hash_Fatura,'#13#10'  Mff.Descricao AS Marcador,'#13#10'  CAST(COALESCE(Tcm.Acesso_Restrito, 0) AS Bit) AS Acesso_Restrito'#13#10'FROM'#13#10'  vis_Logistica_Fatura Lft'#13#10'JOIN'#13#10'  mov_Logistica_House Lhs ON Lhs.IdLogistica_House = Lft.IdLogistica_House'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ffn.IdRegistro_Financeiro,'#13#10'    Ffn.IdFatura_Financeira,'#13#10'    Ffn.IdRegistro_Unificador,'#13#10'    Ffn.Hash,'#13#10'    MIN(Ffn.Data_Vencimento) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Primeiro_Vencimento,'#13#10'    MAX(Ffn.Tipo) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Tipo,'#13#10'    COUNT(Ffn.IdFatura_Financeira) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Quantidade_Faturas,'#13#10'    SUM(Ffn.Valor_Residual) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Total_Residual,'#13#10'    MAX(Ffn.IdMarcador_Fatura_Financeira) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS IdMarcador_Fatura_Financeira,'#13#10'    MAX(Ffn.Data_Pagamento) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Ultimo_Pagamento,'#13#10'    MAX(CASE'#13#10'      WHEN Ffn.IdFechamento_Cambio IS NOT NULL THEN 6 /* Fechamento de câmbio */'#13#10'      WHEN Ffn.Situacao = 6 THEN 5 /* Fatura cancelada */'#13#10'      WHEN Ffn.Situacao = 4 THEN 4 /* Fatura unificada */'#13#10'      WHEN Ffn.Situacao IN (2, 3) THEN 3 /* Fatura com baixa */'#13#10'      WHEN Ffn.Conferido = 1 THEN 2 /* Fatura conferida */'#13#10'      WHEN Ffn.Tipo = 2 /* Título */ THEN 1 /* Fatura finalizada */'#13#10'      ELSE 0'#13#10'    END) OVER(PARTITION BY Ffn.IdRegistro_Financeiro) AS Bloqueio,'#13#10'    ROW_NUMBER() OVER(PARTITION BY Ffn.IdRegistro_Financeiro ORDER BY Ffn.IdFatura_Financeira) AS Indice'#13#10'  FROM'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  JOIN'#13#10'    mov_Logistica_Fatura Lft ON Lft.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'  WHERE'#13#10'    Lft.IdLogistica_House = @IdLogistica_House'#13#10'  ) AS Ffn ON Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro AND Ffn.Indice = 1'#13#10'LEFT OUTER JOIN'#13#10'  cad_Conversao_Moeda Ctx ON Ctx.IdConversao_Moeda = Lft.IdConversao_Taxas'#13#10'LEFT OUTER JOIN'#13#10'  cad_Tipo_Transacao Ttr ON Ttr.IdTipo_Transacao = Lft.IdTipo_Transacao'#13#10'LEFT OUTER JOIN'#13#10'  cad_Pessoa Psa ON Psa.IdPessoa = Lft.IdPessoa'#13#10'LEFT OUTER JOIN'#13#10'  cad_Conta_Corrente Cps ON Cps.IdConta_Corrente = Lft.IdConta_Pessoa'#13#10'LEFT OUTER JOIN'#13#10'  cad_Condicao_Pagamento Cpg ON Cpg.IdCondicao_Pagamento = Lft.IdCondicao_Pagamento'#13#10'LEFT OUTER JOIN'#13#10'  cad_Forma_Cobranca Fcb ON Fcb.IdForma_Cobranca = Lft.IdForma_Cobranca'#13#10'LEFT OUTER JOIN'#13#10'  cad_Forma_Pagamento Fpg ON Fpg.IdForma_Pagamento = Lft.IdForma_Pagamento'#13#10'LEFT OUTER JOIN'#13#10'  cad_Conta_Corrente Ccr ON Ccr.IdConta_Corrente = Lft.IdConta_Corrente'#13#10'LEFT OUTER JOIN'#13#10'  cad_Moeda Mda ON Mda.IdMoeda = Lft.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  cad_Conversao_Moeda Cmd ON Cmd.IdConversao_Moeda = Lft.IdConversao_Moeda'#13#10'LEFT OUTER JOIN'#13#10'  sys_Empresa_Sistema Ess ON Ess.IdEmpresa_Sistema = Lft.IdEmpresa_Sistema'#13#10'LEFT OUTER JOIN'#13#10'  vis_Funcionario Rft ON Rft.IdPessoa = Lft.IdResponsavel_Faturamento'#13#10'LEFT OUTER JOIN'#13#10'  cad_Marcador_Fatura_Financeira Mff ON Mff.IdMarcador_Fatura_Financeira = Ffn.IdMarcador_Fatura_Financeira'#13#10'LEFT OUTER JOIN /* Bloqueio das comissões */'#13#10'  (SELECT'#13#10'    Ltx.IdRegistro_Pagamento AS IdRegistro_Financeiro,'#13#10'    MAX(CASE '#13#10'        WHEN Coalesce(Lcm.Tipo_Comissionado, 0) = 4 /* Vendedor */ THEN Lcm.IdPessoa'#13#10'        ELSE 0'#13#10'      END'#13#10'	  ) AS IdPessoa,'#13#10'    MAX(COALESCE(Lcm.Tipo_Comissionado, 0)) AS Tipo_Comissionado,'#13#10'    MAX(COALESCE(Lcm.Acesso_Restrito, 0)) AS Acesso_Restrito'#13#10'  FROM'#13#10'    mov_Logistica_Comissao Lcm'#13#10'  JOIN'#13#10'    mov_Logistica_Taxa Ltx ON Ltx.IdLogistica_Taxa = Lcm.IdTaxa_Referente'#13#10'  WHERE'#13#10'    Lcm.IdLogistica_House = @IdLogistica_House'#13#10'  GROUP BY'#13#10'    Ltx.IdRegistro_Pagamento'#13#10'  ) AS Tcm ON Tcm.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro'#13#10'/*where*/'#13#10'WHERE'#13#10'  (Lft.IdLogistica_House = @IdLogistica_House)'#13#10'AND '#13#10'  ((Tcm.IdRegistro_Financeiro Is NULL)'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 0)'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado in (1, 2) AND @Visualizar_Comissoes_Agente <> 2) /* Comissão agentes */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 4 AND ((@Visualizar_Comissoes_Vendedor = 0) OR (@Visualizar_Comissoes_Vendedor = 1 AND Tcm.IdPessoa = @IdFuncionario))) /* Comissão vendedor */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 8 AND ((@Visualizar_Comissoes_Outro_Vend = 0) OR (@Visualizar_Comissoes_Outro_Vend = 1 AND Tcm.IdPessoa = @IdFuncionario))) /* Comissão outro vendedor */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado in (6, 10) AND @Visualizar_Comissoes_Represent = 0) /* Comissão representante */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 7 AND @Visualizar_Comissoes_Contato = 0) /* Comissão contato */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 5 AND @Visualizar_Comissoes_Outro = 0) /* Comissão outro */'#13#10'  OR'#13#10'  (Tcm.Tipo_Comissionado = 9 AND @Visualizar_Comissoes_Agente <> 2)) /* Comissão associação internacional */'#13#10'AND'#13#10'  (COALESCE(Tcm.Acesso_Restrito, 0) = 0 OR (COALESCE(Tcm.Acesso_Restrito, 0) = 1 AND @Comissoes_Restritas <> 2 /* Não exibir */))'";"[0]['IdLogistica_House']='5998'; [1]['Visualizar_Comissoes_Agente']='0'; [2]['Visualizar_Comissoes_Vendedor']='0'; [3]['Visualizar_Comissoes_Outro_Vend']='0'; [4]['Visualizar_Comissoes_Represent']='0'; [5]['Visualizar_Comissoes_Contato']='0'; [6]['Visualizar_Comissoes_Outro']='0'; [7]['Visualizar_Comissoes_Associac']='0'; [8]['IdFuncionario']='55939'; [9]['Comissoes_Restritas']='0'"
"34";"77";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"15";"OK";"-1";"'/*PING*/;'";""
"33";"76";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"49";"OK";"1";"'Declare @Parametros xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Persistencia>'#13#10'  <Item IdPersistencia="Atualizar_Fatura_Logistica" IdUsuario="1">eNrz8fTzcDTk5fIB0UZQ2hhKm0BpUyhtBgDw2wox</Item>'#13#10'</Persistencia>'#39'*/'#13#10''#13#10'Declare @Persistencia Table ('#13#10'  IdPersistencia Nome,'#13#10'  IdUsuario IdCurto,'#13#10'  Dados Image'#13#10')'#13#10''#13#10'Insert Into @Persistencia ('#13#10'  IdPersistencia,'#13#10'  IdUsuario,'#13#10'  Dados'#13#10')'#13#10'Select'#13#10'  Prs.value('#39'@IdPersistencia'#39', '#39'VarChar(Max)'#39') as IdPersistencia,'#13#10'  Prs.value('#39'@IdUsuario'#39', '#39'SmallInt'#39') as IdUsuario,'#13#10'  Prs.value('#39'xs:base64Binary(.)'#39', '#39'VarBinary(Max)'#39') as Dados'#13#10'From'#13#10'  @Parametros.nodes('#39'/Persistencia/Item'#39') as Persistencia(Prs)'#13#10''#13#10'/* INSERE OS QUE NAO EXISTEM */'#13#10'Insert Into sys_Persistencia ('#13#10'  IdPersistencia,'#13#10'  IdUsuario,'#13#10'  Dados'#13#10')'#13#10'Select'#13#10'  Dta.IdPersistencia,'#13#10'  Dta.IdUsuario,'#13#10'  Dta.Dados'#13#10'From'#13#10'  @Persistencia Dta'#13#10'Left Outer Join'#13#10'  sys_Persistencia Prs on Prs.IdPersistencia = Dta.IdPersistencia'#13#10'    And Prs.IdUsuario = Dta.IdUsuario'#13#10'Where'#13#10'  Prs.IdPersistencia Is Null'#13#10''#13#10'/* ATUALIZA OS EXISTENTES */'#13#10'Update sys_Persistencia Set'#13#10'  Dados = Dta.Dados'#13#10'From'#13#10'  sys_Persistencia Prs'#13#10'Join'#13#10'  @Persistencia Dta On Dta.IdPersistencia = Prs.IdPersistencia'#13#10'    And Dta.IdUsuario = Prs.IdUsuario'";"[0]['Parametros']='<Persistencia><Item IdPersistencia="frmBaixaUnificada" IdUsuario="122">eNrNmEtv4jAQgO+V+lO2csIjcODQBXXVlbqLUMUeEEJu4mUtQVzZDqr2128g'#13#10'LztkxhbbQ26l8xE+xvZ4hs2Cn7gSTG3v7y5/UrFJ+Okr5R9UbR9+yoSlNKZi'#13#10'9pw8UZ1JunviKU1jxiW13jGnmu2F5Pa7bISlWgo1z5QWNnR/t+n48G+SJiz3'#13#10'motDltLd5eVmxfZc5Y/ZPjynCfuYETC+5oq/HRhC/OKJ/jMLRkOQyP8t5OxL'#13#10'MI6iKAyCFldkpDKBopUHFC8sJgQI4woLqvMlsTxCDIGSYkFlXgL0SbjXiv1m'#13#10'kqUxr7UGCAGlyGSANJkIrrRkSolaZwhEIZUqXmiEhABx3OFFsKRWGHcHoSUq'#13#10'w4XAIOqO4h+/pnl0t2KKJxk9VB6Rg4KE2ly5bcKhg8Mdf5z3F/tbZ2kCxqGl'#13#10'aojCaExAwCddr0I3uZpiCCRkQYXTlGCMj9ZLdtBN7SEYgy9gCeGrV0I+Yt+z'#13#10'vMjXYiiDi5UQLlZCPmKPsWQq5sf67rgqcFccLmiAuKQB+oguclikuvEcODBc'#13#10's+Fwy4bzyuYb1fzITM2hE3Tk0yAdCTVI5x2d83ORnpjM+4vadeTikGvbBuH7'#13#10'2+Z8klrgmieN6NgJ4mXHJNHaY4J+OZX5xatZbRo5MFdGK86R0Arzy2fLceLA'#13#10'8A3adoS2p6/kpaFan7sX+yBNXRzaxpkg2sqZIC46F8d3pq1+LiQYA621BZVy'#13#10'BH2SRwaXdE+tBIYuDNJrc2j6DM5D8vKlUnWeeGrN0AmiohaJqlrklaw9fpmT'#13#10'XOcIVgPGLAiNY90suDs6aajl7qbxpXjl72JXTqDdY5tJQJ4mA1QrE7mlKQ8/'#13#10'tSkPSfipTfngv5vyya1N+VLIOD90dM+O4CxnIlCiLKgcFCKM8VjFSmjUHUQv'#13#10'avx2vrV96Ef30Cow1u9A3SXmgtgHlaAMWFIsCiwlFnXLeQ16fV7DXp3XQd/O'#13#10'67A353XUk/P6DyX8sCw='#13#10'</Item></Persistencia>'"
"32";"75";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"19";"OK";"1";"'Select'#13#10'  Dados'#13#10'From'#13#10'  sys_Persistencia'#13#10'Where'#13#10'  IdPersistencia = ?'#13#10'    And IdUsuario = ?'";"[0]['IdPersistencia']='frmBaixaUnificada'; [1]['IdUsuario']='122'"
"31";"74";"";"11/02/2026 13:39:26";"11/02/2026 13:39:29";"2562";"OK";"0";"'COMMIT TANSACTION'";""
"31";"73";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"20";"OK";"1";"'Insert Into sys_Log_Tabela WITH (ROWLOCK) (IdUsuario, Data_Inicio, Data_Termino, Dados_Log) Values (?, ?, ?, ?)'";"[0]['Param1']='122'; [1]['Param2']='11/02/2026 13:39:27'; [2]['Param3']='11/02/2026 13:39:29'; [3]['Param4']='<Log IdUsuario="122" WindowsUser="Kauan Lauer" ComputerName="KAUAN_LAUER" Hash="e76535be588703aad5436e4ab2e0bb52"><Tabela Nome="mov_Movimentacao_Financeira" Tipo="1" Data="2/11/2026 1:39:27 PM" Indice="1"><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="IdTipo_Transacao" Value="2"/><Campo Nome="IdPessoa" Value="54988"/><Campo Nome="IdConta_Pessoa" Value="89"/><Campo Nome="IdForma_Pagamento" Value="1"/><Campo Nome="IdConta_Corrente" Value="36"/><Campo Nome="IdMoeda" Value="52"/><Campo Nome="IdEmpresa_Sistema" Value="12"/><Campo Nome="Numero" Value="000142/26"/><Campo Nome="Referencia" Value="IA-YKS-0038-25"/><Campo Nome="Referencia_Externa" Value=""/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Valor_Original" Value="-1625.66"/><Campo Nome="Valor_Corrente" Value="1625.66"/><Campo Nome="Fator_Corrente" Value="1"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Data" Value="2/11/2026"/><Campo Nome="Previsao_Compensacao" Value="2/11/2026"/><Campo Nome="Data_Compensacao" Value="2/11/2026"/><Campo Nome="Historico_Resumo" Value=""/><Campo Nome="Historico" Value=""/><Campo Nome="Compensada" Value="1"/><Campo Nome="Conciliada" Value="0"/><Campo Nome="Estornada" Value="0"/><Campo Nome="Utilizar_Saldo_Pessoa" Value="0"/><Campo Nome="Origem_Lancamento" Value="2"/><Campo Nome="Data_Lancamento" Value="2/11/2026 1:39:27 PM"/><Campo Nome="Nota_Recibo_Conferido" Value="0"/><Campo Nome="Variacao_Cambial" Value="0"/><Campo Nome="Competencia" Value="2/1/2026"/><Campo Nome="Atalho" Value=""/><Campo Nome="Observacao" Value=""/><Campo Nome="Identificacao_Extrato" Value=""/><Campo Nome="Ativo" Value="1"/><Campo Nome="Hash" Value="f2e1af18d7822140c4df5c2fe669b6ff"/><Campo Nome="Data_Ultima_Alteracao" Value="2/11/2026 1:39:27 PM"/></Tabela><Tabela Nome="mov_Fatura_Financeira_Baixa" Tipo="1" Data="2/11/2026 1:39:27 PM" Indice="2"><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="IdFatura_Financeira" Value="15849"/><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="Valor_Total" Value="1625.66"/><Campo Nome="Valor_Total_Corrente" Value="1625.66"/><Campo Nome="Fator_Conversao" Value="1"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Tipo_Baixa" Value="1"/><Campo Nome="Gerar_Recibo" Value="0"/><Campo Nome="Proveniencia" Value=""/><Campo Nome="Observacao" Value=""/><Campo Nome="Hash" Value="0921106f02220ec2e776c1cca3b90bf3"/><Campo Nome="Data_Ultima_Alteracao" Value="2/11/2026 1:39:27 PM"/></Tabela><Tabela Nome="mov_Fatura_Financeira" Tipo="3" Data="2/11/2026 1:39:27 PM" Indice="3"><Campo Nome="IdFatura_Financeira" Value="15849"/><Campo Nome="Data_Pagamento" Value="2/11/2026"/><Campo Nome="Situacao" OldValue="1" Value="2"/><Campo Nome="Valor_Residual" OldValue="1625.66" Value="0"/><Campo Nome="Total_Pago" Value="1625.66"/><Campo Nome="Total_Pago_Corrente" Value="1625.66"/><Campo Nome="Em_Aberto" OldValue="1" Value="0"/><Campo Nome="Hash" OldValue="7f7ef49436beccf094558333ea4a914f" Value="df1dbb9904b7659413806d3920f590eb"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:38:52 PM" Value="2/11/2026 1:39:27 PM"/></Tabela><Tabela Nome="mov_Registro_Financeiro" Tipo="3" Data="2/11/2026 1:39:27 PM" Indice="4"><Campo Nome="IdRegistro_Financeiro" Value="15480"/><Campo Nome="Situacao" OldValue="1" Value="2"/><Campo Nome="Hash" OldValue="1b0043613dcce76293242fdf9510e11a" Value="284186f24cc7f91109fd7de691271955"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:38:52 PM" Value="2/11/2026 1:39:27 PM"/></Tabela><Tabela Nome="mov_Logistica_House" Tipo="3" Data="2/11/2026 1:39:28 PM" Indice="5"><Campo Nome="IdLogistica_House" Value="5998"/><Campo Nome="Data_Pagamento_Local" Value="2/11/2026"/><Campo Nome="Situacao_Pagamento" OldValue="1" Value="3"/><Campo Nome="Faturas_Em_Aberto" OldValue="1" Value="0"/><Campo Nome="Data_Ultima_Baixa" OldValue="2/11/2026 1:38:52 PM" Value="2/11/2026 1:39:28 PM"/><Campo Nome="Situacao_Pagamento_Frete" OldValue="1" Value="2"/><Campo Nome="Data_Pagamento_Frete" Value="2/11/2026"/></Tabela><Tabela Nome="mov_Logistica_Moeda" Tipo="3" Data="2/11/2026 1:39:28 PM" Indice="6"><Campo Nome="IdLogistica_Moeda" Value="8662"/><Campo Nome="Total_Pago" OldValue="0" Value="250"/><Campo Nome="Total_Pago_Local" OldValue="0" Value="250"/><Campo Nome="Lucro_Efetivo" OldValue="500" Value="250"/></Tabela><Tabela Nome="mov_Logistica_Moeda" Tipo="3" Data="2/11/2026 1:39:29 PM" Indice="7"><Campo Nome="IdLogistica_Moeda" Value="8663"/><Campo Nome="Total_Pago" OldValue="0" Value="1625.66"/><Campo Nome="Total_Pago_Local" OldValue="0" Value="1625.66"/><Campo Nome="Lucro_Efetivo" OldValue="2861.16" Value="1235.5"/></Tabela><Tabela Nome="mov_Logistica_Fiscal" Tipo="3" Data="2/11/2026 1:39:29 PM" Indice="8"><Campo Nome="IdLogistica_Fiscal" Value="1727"/><Campo Nome="Lucro_Contabil_Total" OldValue="2861.16" Value="1235.5"/><Campo Nome="Lucro_Contabil_Saldo" OldValue="2861.16" Value="1235.5"/><Campo Nome="Data_Ultima_Alteracao" OldValue="2/11/2026 1:38:53 PM" Value="2/11/2026 1:39:29 PM"/></Tabela><Tabela Nome="mov_Movimentacao_Financeira_Categoria" Tipo="1" Data="2/11/2026 1:39:29 PM" Indice="9"><Campo Nome="IdMovimentacao_Categoria" Value="2058"/><Campo Nome="IdMovimentacao_Financeira" Value="1844"/><Campo Nome="IdCategoria_Financeira" Value="16"/><Campo Nome="IdFatura_Financeira_Categoria" Value="16233"/><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="Tipo_Custo" Value="2"/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Observacao" Value=""/><Campo Nome="Ativo" Value="1"/></Tabela><Tabela Nome="mov_Movimentacao_Financeira_Custo" Tipo="1" Data="2/11/2026 1:39:29 PM" Indice="10"><Campo Nome="IdMovimentacao_Financeira_Custo" Value="3337"/><Campo Nome="IdMovimentacao_Categoria" Value="2058"/><Campo Nome="IdCentro_Custo" Value="2"/><Campo Nome="IdFatura_Financeira_Custo" Value="31184"/><Campo Nome="IdFatura_Financeira_Baixa" Value="2002"/><Campo Nome="Valor" Value="1625.66"/><Campo Nome="Natureza" Value="0"/><Campo Nome="Valor_Convertido" Value="1625.66"/><Campo Nome="Observacao" Value=""/><Campo Nome="Ativo" Value="1"/></Tabela></Log>'"
"31";"72";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"4";"OK";"1";"'insert into mov_Movimentacao_Financeira_Custo'#13#10'  (IdMovimentacao_Financeira_Custo, IdMovimentacao_Categoria, IdCentro_Custo, IdFatura_Financeira_Custo, IdFatura_Financeira_Baixa, Valor, Natureza, Valor_Convertido, Observacao, Ativo)'#13#10'values'#13#10'  (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'";""
"31";"71";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"30";"OK";"1";"'Declare'#13#10'  @Tabela Nome,'#13#10'  @FieldName Nome,'#13#10'  @SQL nVarChar(Max),'#13#10'  @Result IdLongo'#13#10''#13#10'Select'#13#10'  @Tabela = ?,'#13#10'  @FieldName = ?'#13#10''#13#10'Set @SQL = '#39'EXECUTE @Result = HeadSoft.'#39'+DB_NAME()+'#39'.dbo.hsGerarCodigo '#39''#39''#39'+@Tabela+'#39''#39''#39','#39''#39''#39'+@FieldName+'#39''#39''#39''#39''#13#10'exec sp_executesql @SQL, N'#39'@Result IdLongo OUTPUT'#39', @Result=@Result OUTPUT'#13#10''#13#10'Set ?=@Result'";"[0][]='mov_Movimentacao_Financeira_Custo'; [1][]='IdMovimentacao_Financeira_Custo'; [2][]='NULL'"
"31";"70";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"16";"OK";"1";"'insert into mov_Movimentacao_Financeira_Categoria'#13#10'  (IdMovimentacao_Categoria, IdMovimentacao_Financeira, IdCategoria_Financeira, IdFatura_Financeira_Categoria, IdFatura_Financeira_Baixa, Tipo_Custo, Valor, Natureza, Valor_Convertido, Observacao, Ativo)'#13#10'values'#13#10'  (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'";""
"31";"69";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"83";"OK";"1";"'Declare'#13#10'  @Tabela Nome,'#13#10'  @FieldName Nome,'#13#10'  @SQL nVarChar(Max),'#13#10'  @Result IdLongo'#13#10''#13#10'Select'#13#10'  @Tabela = ?,'#13#10'  @FieldName = ?'#13#10''#13#10'Set @SQL = '#39'EXECUTE @Result = HeadSoft.'#39'+DB_NAME()+'#39'.dbo.hsGerarCodigo '#39''#39''#39'+@Tabela+'#39''#39''#39','#39''#39''#39'+@FieldName+'#39''#39''#39''#39''#13#10'exec sp_executesql @SQL, N'#39'@Result IdLongo OUTPUT'#39', @Result=@Result OUTPUT'#13#10''#13#10'Set ?=@Result'";"[0][]='mov_Movimentacao_Financeira_Categoria'; [1][]='IdMovimentacao_Categoria'; [2][]='NULL'"
"31";"68";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"50";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaMoeda" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_Moeda" Valor="8663"/></PrimaryKeys><Campos><Item Nome="Total_Pago" OldValue="0" Value="1625.66"/><Item Nome="Total_Pago_Local" OldValue="0" Value="1625.66"/><Item Nome="Lucro_Efetivo" OldValue="2861.16" Value="1235.5"/></Campos></Evento></Parametros>'"
"31";"67";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"12";"OK";"1";"'update mov_Logistica_Fiscal  set'#13#10' Lucro_Contabil_Total = ?,'#13#10' Lucro_Contabil_Saldo = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdLogistica_Fiscal = ?'";""
"31";"66";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"17";"OK";"1";"'Select'#13#10'  IdLogistica_Fiscal, IdLogistica_House, IdEmpresa_Sistema, IdTomador, IdTipo_Movimentacao, IdResponsavel_Apuracao, Taxas_Tributaveis_Total, Taxas_Tributaveis_Tributado, Taxas_Tributaveis_Saldo, Taxas_Tributaveis_Pendente, Lucro_Contabil_Total, Lucro_Contabil_Tributado, Lucro_Contabil_Saldo, Lucro_Contabil_Pendente, Disponivel_Apuracao, Data_Ultima_Alteracao, Data_Apuracao, Situacao, Ativo, Observacao'#13#10'From'#13#10'  mov_Logistica_Fiscal'#13#10'Where'#13#10'  IdLogistica_Fiscal = ?'";"[0]['0']='1727'"
"31";"65";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"9";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  ISNULL(Lmc.Lucro_Efetivo, 0) - ISNULL(Txs.Total_Taxas_Tributaveis, 0) AS Lucro_Contabil_Total,'#13#10'  CAST(CASE '#13#10'    WHEN Lhs.Situacao_Agenciamento = 5 /* Finalizado */ THEN 1'#13#10'    ELSE 0'#13#10'  END AS BIT) AS Disponivel_Apuracao'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Moeda Lmc ON Lmc.IdLogistica_House = Lhs.IdLogistica_House'#13#10'    AND Lmc.IdMoeda = Mcr.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Total_Taxas_Tributaveis'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Ltx.Tributavel = 1'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"31";"64";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"10";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  ISNULL(Lmc.Lucro_Efetivo, 0) - ISNULL(Txs.Total_Taxas_Tributaveis, 0) AS Lucro_Contabil_Total,'#13#10'  CAST(CASE '#13#10'    WHEN Lhs.Situacao_Agenciamento = 5 /* Finalizado */ THEN 1'#13#10'    ELSE 0'#13#10'  END AS BIT) AS Disponivel_Apuracao'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Moeda Lmc ON Lmc.IdLogistica_House = Lhs.IdLogistica_House'#13#10'    AND Lmc.IdMoeda = Mcr.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Total_Taxas_Tributaveis'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Ltx.Tributavel = 1'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"31";"63";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"5";"OK";"1";"'Select'#13#10'  IdFonte_Dados, Nome, Dados'#13#10'From'#13#10'  cad_Fonte_Dados'#13#10'Where'#13#10'  IdFonte_Dados = ?'";"[0]['0']='356'"
"31";"62";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"31";"OK";"1";"'DECLARE'#13#10'  @IdLogistica_House Integer = ?'#13#10''#13#10'SELECT'#13#10'  Lfs.IdLogistica_Fiscal,'#13#10'  Lhs.IdEmpresa_Sistema,'#13#10'  Txs.Taxas_Tributaveis_Total,'#13#10'  Txs.Taxas_Tributaveis_Tributado,'#13#10'  Nlt.Lucro_Contabil_Tributado'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Ltx.IdLogistica_House,'#13#10'    SUM(CASE'#13#10'      WHEN Ltx.Tributavel = 1 AND Ltx.IdMoeda_Recebimento = Mcr.IdMoeda THEN Ltx.Valor_Recebimento_Total'#13#10'      WHEN Ltx.Tributavel = 1 AND Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda THEN ROUND(Ltx.Valor_Recebimento_Total * Lfc.Fator_Conversao, 2)'#13#10'      WHEN Ltx.Tributavel = 1 AND Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento AND ISNULL(Lfc.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Recebimento_Total * ROUND(1 / Lfc.Fator_Conversao, 6), 2)'#13#10'      ELSE 0'#13#10'    END) AS Taxas_Tributaveis_Total,'#13#10'    SUM(Nfs.Taxas_Tributaveis_Tributado) AS Taxas_Tributaveis_Tributado'#13#10'  FROM'#13#10'    mov_Logistica_Taxa Ltx'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Moeda Mcr ON Mcr.Moeda_Corrente = 1'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ltx.IdRegistro_Recebimento'#13#10'      AND ((Lfc.IdMoeda_Origem = Ltx.IdMoeda_Recebimento AND Lfc.IdMoeda_Destino = Mcr.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Mcr.IdMoeda AND Lfc.IdMoeda_Destino = Ltx.IdMoeda_Recebimento))'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT'#13#10'      Ltx.IdLogistica_Taxa,'#13#10'      SUM(Nfi.Valor_Total) AS Taxas_Tributaveis_Tributado'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    LEFT OUTER JOIN'#13#10'      aux_Nota_Fiscal_Servico_Item_Taxa Nft ON Nft.IdLogistica_Taxa = Ltx.IdLogistica_Taxa'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Nota_Fiscal_Servico_Item Nfi ON Nfi.IdNota_Fiscal_Servico_Item = Nft.IdNota_Fiscal_Servico_Item'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Nota_Fiscal_Servico Nfs ON Nfs.IdNota_Fiscal_Servico = Nfi.IdNota_Fiscal_Servico'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    AND'#13#10'      Nfs.Situacao <> 8 /* Cancelada */'#13#10'    GROUP BY'#13#10'      Ltx.IdLogistica_Taxa'#13#10'    ) Nfs ON Nfs.IdLogistica_Taxa = Ltx.IdLogistica_Taxa'#13#10'  WHERE'#13#10'    Ltx.IdLogistica_House = @IdLogistica_House'#13#10'  GROUP BY'#13#10'    Ltx.IdLogistica_House'#13#10'  ) Txs ON Txs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Lfs.IdLogistica_House,'#13#10'    SUM(Nfs.Valor_Servicos) AS Lucro_Contabil_Tributado'#13#10'  FROM'#13#10'    aux_Logistica_Fiscal_Nota Lfn'#13#10'  JOIN'#13#10'    mov_Logistica_Fiscal Lfs ON Lfs.IdLogistica_Fiscal = Lfn.IdLogistica_Fiscal'#13#10'  JOIN'#13#10'    mov_Nota_Fiscal_Servico Nfs ON Lfn.IdNota_Fiscal_Servico = Nfs.IdNota_Fiscal_Servico'#13#10'  WHERE'#13#10'    Lfs.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    Nfs.Situacao <> 8 /* Cancelada */'#13#10'  GROUP BY'#13#10'    Lfs.IdLogistica_House'#13#10'  ) Nlt ON Nlt.IdLogistica_House = Lhs.IdLogistica_House'#13#10'LEFT OUTER JOIN'#13#10'  mov_Logistica_Fiscal Lfs ON Lfs.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'"
"31";"61";"";"11/02/2026 13:39:00";"11/02/2026 13:39:00";"9";"OK";"1";"'update mov_Logistica_Moeda  set'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Local = ?,'#13#10' Lucro_Efetivo = ?'#13#10'where'#13#10' IdLogistica_Moeda = ?'";""
"31";"60";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"19";"OK";"1";"'Select'#13#10'  IdLogistica_Moeda, IdLogistica_House, IdMoeda, Total_Pagamento, Total_Recebimento, Total_Pago, Total_Recebido, Total_Pagamento_Local, Total_Pagamento_Exterior, Total_Recebimento_Local, Total_Recebimento_Exterior, Total_Pago_Local, Total_Pago_Exterior, Total_Recebido_Local, Total_Recebido_Exterior, Lucro_Estimado, Lucro_Efetivo, Lucro_Abertura, Lucro_Momento, Lucro_Estimado_Faturado, Comissao_Agente_Orig_Estimada, Comissao_Agente_Dest_Estimada, Comissao_Vendedor_Estimada, Comissao_Representante_Estimada, Comissao_Associacao_Estimada, Comissao_Empresa_Estimada, Comissao_Outros_Estimada, Comissao_Agente_Orig_Efetiva, Comissao_Agente_Dest_Efetiva, Comissao_Vendedor_Efetiva, Comissao_Representante_Efetiva, Comissao_Associacao_Efetiva, Comissao_Empresa_Efetiva, Comissao_Outros_Efetiva, Lucro_Abertura_Frete, Lucro_Abertura_Origem, Lucro_Abertura_Destino, Observacao'#13#10'From'#13#10'  mov_Logistica_Moeda'#13#10'Where'#13#10'  IdLogistica_Moeda = ?'";"[0]['0']='8663'"
"31";"59";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"32";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaMoeda" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_Moeda" Valor="8662"/></PrimaryKeys><Campos><Item Nome="Total_Pago" OldValue="0" Value="250"/><Item Nome="Total_Pago_Local" OldValue="0" Value="250"/><Item Nome="Lucro_Efetivo" OldValue="500" Value="250"/></Campos></Evento></Parametros>'"
"31";"58";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"9";"OK";"1";"'update mov_Logistica_Moeda  set'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Local = ?,'#13#10' Lucro_Efetivo = ?'#13#10'where'#13#10' IdLogistica_Moeda = ?'";""
"31";"57";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"16";"OK";"1";"'Select'#13#10'  IdLogistica_Moeda, IdLogistica_House, IdMoeda, Total_Pagamento, Total_Recebimento, Total_Pago, Total_Recebido, Total_Pagamento_Local, Total_Pagamento_Exterior, Total_Recebimento_Local, Total_Recebimento_Exterior, Total_Pago_Local, Total_Pago_Exterior, Total_Recebido_Local, Total_Recebido_Exterior, Lucro_Estimado, Lucro_Efetivo, Lucro_Abertura, Lucro_Momento, Lucro_Estimado_Faturado, Comissao_Agente_Orig_Estimada, Comissao_Agente_Dest_Estimada, Comissao_Vendedor_Estimada, Comissao_Representante_Estimada, Comissao_Associacao_Estimada, Comissao_Empresa_Estimada, Comissao_Outros_Estimada, Comissao_Agente_Orig_Efetiva, Comissao_Agente_Dest_Efetiva, Comissao_Vendedor_Efetiva, Comissao_Representante_Efetiva, Comissao_Associacao_Efetiva, Comissao_Empresa_Efetiva, Comissao_Outros_Efetiva, Lucro_Abertura_Frete, Lucro_Abertura_Origem, Lucro_Abertura_Destino, Observacao'#13#10'From'#13#10'  mov_Logistica_Moeda'#13#10'Where'#13#10'  IdLogistica_Moeda = ?'";"[0]['0']='8662'"
"31";"56";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"29";"OK";"-1";"'DECLARE'#13#10'  @IdLogistica_House IdLongo,'#13#10'  @IdMoeda_Corrente IdCurto,'#13#10'  @Profit_Estimado_Sem_Canceladas Boleano'#13#10''#13#10'SET @IdLogistica_House = ?'#13#10'SET @Profit_Estimado_Sem_Canceladas = ?'#13#10''#13#10'SELECT'#13#10'  @IdMoeda_Corrente = Mcr.IdMoeda'#13#10'FROM'#13#10'  cad_Moeda Mcr'#13#10'WHERE'#13#10'  Mcr.Moeda_Corrente = 1'#13#10''#13#10'DECLARE @Faturas TABLE('#13#10'  IdRegistro_Financeiro IdLongo, '#13#10'  IdLogistica_House IdLongo, '#13#10'  IdMoeda IdCurto, '#13#10'  Local_Cobranca TipoFixo, '#13#10'  Natureza TipoFixo, '#13#10'  Valor_Total Moeda, '#13#10'  Total_Pago Moeda, '#13#10'  Total_Pago_Corrente Moeda,'#13#10'  Valor_Residual Moeda'#13#10')'#13#10'INSERT INTO @Faturas'#13#10'  (IdRegistro_Financeiro, IdLogistica_House, IdMoeda, Local_Cobranca, Natureza, Valor_Total, Total_Pago, Total_Pago_Corrente, Valor_Residual)'#13#10'SELECT'#13#10'  Lft.IdRegistro_Financeiro,'#13#10'  Lft.IdLogistica_House,'#13#10'  Lft.IdMoeda,'#13#10'  Lft.Local_Cobranca,'#13#10'  Lft.Natureza,'#13#10'  Lft.Valor_Total,'#13#10'  SUM(ISNULL(Ffn.Total_Pago, 0) + '#13#10'    ISNULL(CASE'#13#10'      WHEN (Run.IdRegistro_Financeiro Is NULL) OR ((ISNULL(Run.Valor_Total, 0) <> 0) AND (ISNULL(Run.Total_Pago, 0) = 0)) THEN 0'#13#10'      WHEN (ISNULL(Run.Valor_Total, 0) = 0) /* A unificação equiparou AS faturas é pq deu baixa */'#13#10'        OR (ISNULL(Run.Valor_Total, 0) = ISNULL(Run.Total_Pago, 0)) /* O total pago é igual ao unificado, baixa de 100% */ THEN Ffn.Valor_Residual'#13#10'      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * 100 / NULLIF(Run.Valor_Total, 0)) * (Run.Total_Pago / NULLIF(Ffn.Fator_Unificacao, 0))) / 100, 2)'#13#10'    END, 0)) AS Total_Pago,'#13#10'  SUM(ISNULL(Ffn.Total_Pago_Corrente, 0) + '#13#10'    ISNULL(CASE'#13#10'      WHEN (Run.IdRegistro_Financeiro Is NULL) OR ((ISNULL(Run.Valor_Total, 0) <> 0) AND (ISNULL(Run.Total_Pago, 0) = 0)) THEN 0'#13#10'      WHEN (ISNULL(Run.Valor_Total, 0) = 0) /* A unificação equiparou AS faturas é pq deu baixa */ THEN ROUND(Ffn.Valor_Residual / NULLIF(Ffn.Fator_Unificacao, 0), 2)'#13#10'      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * 100 / NULLIF(Run.Valor_Total, 0)) * (Run.Total_Pago_Corrente)) / 100, 2)'#13#10'    END, 0)) AS Total_Pago_Corrente,'#13#10'  SUM(ISNULL(CASE'#13#10'      WHEN Run.IdRegistro_Financeiro IS NULL THEN Ffn.Valor_Residual'#13#10'--      ELSE ROUND(((Ffn.Valor_Residual * Ffn.Fator_Unificacao * Run.Valor_Residual) / NULLIF(Run.Valor_Total, 0)) / NULLIF(Ffn.Fator_Unificacao, 0), 2)'#13#10'      ELSE ROUND((Ffn.Valor_Residual * Run.Valor_Residual) / NULLIF(Run.Valor_Total, 0), 2)'#13#10'    END, 0)) AS Valor_Residual'#13#10'FROM'#13#10'  vis_Logistica_Fatura Lft'#13#10'JOIN'#13#10'  mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Run.IdRegistro_Financeiro,'#13#10'    Run.IdMoeda,'#13#10'    Run.Valor_Total,'#13#10'    SUM(Ffu.Total_Pago) AS Total_Pago,'#13#10'    SUM(Ffu.Total_Pago_Corrente) AS Total_Pago_Corrente,'#13#10'    SUM(Ffu.Valor_Residual) AS Valor_Residual,'#13#10'    Ffu.Situacao'#13#10'  FROM'#13#10'    mov_Registro_Financeiro Run'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffu ON Ffu.IdRegistro_Financeiro = Run.IdRegistro_Financeiro'#13#10'  WHERE'#13#10'    Run.Origem_Lancamento = 3'#13#10'  GROUP BY'#13#10'    Run.IdRegistro_Financeiro,'#13#10'    Run.IdMoeda,'#13#10'    Run.Valor_Total,'#13#10'    Ffu.Situacao'#13#10'  ) AS Run ON Run.IdRegistro_Financeiro = Ffn.IdRegistro_Unificador'#13#10'WHERE'#13#10'  (Lft.IdLogistica_House = @IdLogistica_House)'#13#10'AND'#13#10'  (@Profit_Estimado_Sem_Canceladas = 0 OR ISNULL(Run.Situacao, Ffn.Situacao) <> 6 /* Cancelada */)'#13#10'GROUP BY'#13#10'  Lft.IdRegistro_Financeiro,'#13#10'  Lft.IdLogistica_House,'#13#10'  Lft.IdMoeda,'#13#10'  Lft.Local_Cobranca,'#13#10'  Lft.Natureza,'#13#10'  Lft.Valor_Total'#13#10''#13#10'SELECT'#13#10'  Lmd.IdLogistica_Moeda,'#13#10'  Vlr.Total_Pagamento AS Total_Pagamento,'#13#10'  Vlr.Total_Recebimento AS Total_Recebimento,'#13#10'  Vlr.Total_Pago AS Total_Pago,'#13#10'  Vlr.Total_Recebido AS Total_Recebido,'#13#10'  Vlr.Total_Pagamento_Local AS Total_Pagamento_Local,'#13#10'  Vlr.Total_Pagamento_Exterior AS Total_Pagamento_Exterior,'#13#10'  Vlr.Total_Recebimento_Local AS Total_Recebimento_Local,'#13#10'  Vlr.Total_Recebimento_Exterior AS Total_Recebimento_Exterior,'#13#10'  Vlr.Total_Pago_Local AS Total_Pago_Local,'#13#10'  Vlr.Total_Pago_Exterior AS Total_Pago_Exterior,'#13#10'  Vlr.Total_Recebido_Local AS Total_Recebido_Local,'#13#10'  Vlr.Total_Recebido_Exterior AS Total_Recebido_Exterior,'#13#10'  Vlr.Lucro_Estimado AS Lucro_Estimado,'#13#10'  Vlr.Lucro_Efetivo AS Lucro_Efetivo,'#13#10'  Vlr.Lucro_Momento AS Lucro_Momento,'#13#10'  ISNULL(Cms.Comissao_Agente_Orig_Estimada, 0) AS Comissao_Agente_Orig_Estimada,'#13#10'  ISNULL(Cms.Comissao_Agente_Dest_Estimada, 0) AS Comissao_Agente_Dest_Estimada,'#13#10'  ISNULL(Cms.Comissao_Vendedor_Estimada, 0) AS Comissao_Vendedor_Estimada,'#13#10'  ISNULL(Cms.Comissao_Representante_Estimada, 0) AS Comissao_Representante_Estimada,'#13#10'  ISNULL(Cms.Comissao_Associacao_Estimada, 0) AS Comissao_Associacao_Estimada,'#13#10'  ISNULL(Cms.Comissao_Outros_Estimada, 0) AS Comissao_Outros_Estimada,'#13#10'  ISNULL(Cms.Comissao_Agente_Orig_Efetiva, 0) AS Comissao_Agente_Orig_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Agente_Dest_Efetiva, 0) AS Comissao_Agente_Dest_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Vendedor_Efetiva, 0) AS Comissao_Vendedor_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Representante_Efetiva, 0) AS Comissao_Representante_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Associacao_Efetiva, 0) AS Comissao_Associacao_Efetiva,'#13#10'  ISNULL(Cms.Comissao_Outros_Efetiva, 0) AS Comissao_Outros_Efetiva'#13#10'FROM'#13#10'  mov_Logistica_Moeda Lmd'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Rft.IdLogistica_Moeda,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN -Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Pagamento_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN Rft.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebimento_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 0 /* Débito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN -Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Pago_Exterior,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 1 /* Local */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido_Local,'#13#10'    SUM(CASE'#13#10'      WHEN Rft.Natureza = 1 /* Crédito */ AND Rft.Local_Cobranca = 2 /* Exterior */ THEN Rft.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Total_Recebido_Exterior,'#13#10'    SUM(Rft.Valor_Estimado) AS Lucro_Estimado,'#13#10'    SUM(Rft.Valor_Efetivo) AS Lucro_Efetivo,'#13#10'    SUM(Rft.Valor_Momento) AS Lucro_Momento'#13#10'  FROM'#13#10'    /* Resumo das Faturas */'#13#10'    (SELECT'#13#10'      Lmd.IdLogistica_Moeda,'#13#10'      Ftr.Natureza,'#13#10'      Ftr.Local_Cobranca,'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Valor_Total'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Valor_Total * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Valor_Total / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE   '#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Valor_Total'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Valor_Total * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Valor_Total / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          End'#13#10'      End, 0) AS Valor_Estimado,'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        Else'#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          End'#13#10'      End, 0) AS Valor_Efetivo,'#13#10'      /* ESTIMADO */'#13#10'      ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN (Ftr.Valor_Residual)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND((Ftr.Valor_Residual) * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND((Ftr.Valor_Residual) / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE   '#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN (Ftr.Valor_Residual)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND((Ftr.Valor_Residual) * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND((Ftr.Valor_Residual) / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END'#13#10'      END, 0) '#13#10'      /* EFETIVO */'#13#10'      + ISNULL(CASE'#13#10'        WHEN Ftr.Natureza = 0 /* Débito */ THEN'#13#10'          -(CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END)'#13#10'        ELSE'#13#10'          CASE'#13#10'            WHEN (Lmd.IdMoeda = @IdMoeda_Corrente) THEN Ftr.Total_Pago_Corrente'#13#10'            WHEN (Lmd.IdMoeda = Ftr.IdMoeda) THEN Ftr.Total_Pago'#13#10'            WHEN (Lfc.IdMoeda_Origem = Ftr.IdMoeda) AND (Lfc.IdMoeda_Destino = Lmd.IdMoeda) THEN ROUND(Ftr.Total_Pago * Lfc.Fator_Conversao, 2)'#13#10'            WHEN (Lfc.IdMoeda_Origem = Lmd.IdMoeda) AND (Lfc.IdMoeda_Destino = Ftr.IdMoeda) AND (ISNULL(Lfc.Fator_Conversao, 0) <> 0) THEN ROUND(Ftr.Total_Pago / Lfc.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END'#13#10'        END, 0) AS Valor_Momento'#13#10'    FROM'#13#10'      mov_Logistica_Moeda Lmd'#13#10'    LEFT OUTER JOIN'#13#10'      @Faturas Ftr ON Ftr.IdLogistica_House = Lmd.IdLogistica_House'#13#10'    LEFT OUTER JOIN'#13#10'      mov_Logistica_Fatura_Conversao Lfc ON Lfc.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Lfc.IdMoeda_Origem = Ftr.IdMoeda AND Lfc.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Lfc.IdMoeda_Origem = Lmd.IdMoeda AND Lfc.IdMoeda_Destino = Ftr.IdMoeda))'#13#10'    WHERE'#13#10'      Lmd.IdLogistica_House = @IdLogistica_House'#13#10'    ) Rft'#13#10'  GROUP BY'#13#10'    Rft.IdLogistica_Moeda'#13#10'  ) AS Vlr ON Vlr.IdLogistica_Moeda = Lmd.IdLogistica_Moeda'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Rcm.IdLogistica_Moeda,'#13#10'    /* Estimadas */'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 1 /* Agente destino */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Dest_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 2 /* Agente origem */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Orig_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (6, 10) /* Representante e Representante destino final */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Representante_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (4, 8) /* Vendedor e Outro Vendedor */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Vendedor_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 9 /* Associação internacional */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Associacao_Estimada,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (5, 7) /* Outro e Contato */ THEN Rcm.Valor_Estimado'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Outros_Estimada,'#13#10'    /* Efetivas */'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 1 /* Agente destino */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Dest_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 2 /* Agente origem */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Agente_Orig_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (6, 10) /* Representante destino final */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Representante_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (4, 8) /* Vendedor e Outro Vendedor */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Vendedor_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado = 9 /* Associação internacional */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Associacao_Efetiva,'#13#10'    SUM(CASE'#13#10'      WHEN Rcm.Tipo_Comissionado in (5, 7) /* Outro e Contato */ THEN Rcm.Valor_Efetivo'#13#10'      ELSE 0'#13#10'    END) AS Comissao_Outros_Efetiva'#13#10'  FROM'#13#10'    /* Resumo das Comissões */'#13#10'    (SELECT'#13#10'      Lmd.IdLogistica_Moeda,'#13#10'      Lcm.Tipo_Comissionado,'#13#10'      CASE'#13#10'        WHEN Lmd.IdMoeda = Ltx.IdMoeda_Pagamento THEN Ltx.Valor_Pagamento_Total'#13#10'        WHEN Ctm.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctm.IdMoeda_Destino = Lmd.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctm.Fator_Conversao, 2)'#13#10'        WHEN Ctm.IdMoeda_Origem = Lmd.IdMoeda AND Ctm.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctm.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctm.Fator_Conversao, 2)'#13#10'        ELSE 0'#13#10'      END AS Valor_Estimado,'#13#10'      CASE'#13#10'        WHEN Lmd.IdMoeda = @IdMoeda_Corrente THEN'#13#10'          ROUND(((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago_Corrente) / 100, 2)'#13#10'        WHEN Lmd.IdMoeda = Ftr.IdMoeda THEN'#13#10'          ROUND(((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100, 2)'#13#10'        WHEN Cfm.IdMoeda_Origem = Ftr.IdMoeda AND Cfm.IdMoeda_Destino = Lmd.IdMoeda THEN'#13#10'          ROUND((((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100) * Cfm.Fator_Conversao, 2)'#13#10'        WHEN Cfm.IdMoeda_Origem = Lmd.IdMoeda AND Cfm.IdMoeda_Destino = Ftr.IdMoeda AND ISNULL(Cfm.Fator_Conversao, 0) <> 0 THEN'#13#10'          ROUND((((((CASE'#13#10'            WHEN Ltx.IdMoeda_Pagamento = Ftr.IdMoeda THEN Ltx.Valor_Pagamento_Total'#13#10'            WHEN Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda THEN ROUND(Ltx.Valor_Pagamento_Total * Ctf.Fator_Conversao, 2)'#13#10'            WHEN Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento AND ISNULL(Ctf.Fator_Conversao, 0) <> 0 THEN ROUND(Ltx.Valor_Pagamento_Total / Ctf.Fator_Conversao, 2)'#13#10'            ELSE 0'#13#10'          END) * 100) / NULLIF(Ftr.Valor_Total, 0)) * Ftr.Total_Pago) / 100) / NULLIF(Cfm.Fator_Conversao, 0), 2)'#13#10'        ELSE 0'#13#10'      END AS Valor_Efetivo'#13#10'    FROM'#13#10'      mov_Logistica_Moeda Lmd'#13#10'    JOIN'#13#10'      mov_Logistica_Comissao Lcm ON Lcm.IdLogistica_House = Lmd.IdLogistica_House'#13#10'    JOIN'#13#10'      mov_Logistica_Taxa Ltx ON Ltx.IdLogistica_Taxa = Lcm.IdTaxa_Referente'#13#10'    JOIN'#13#10'      @Faturas Ftr ON Ftr.IdRegistro_Financeiro = Ltx.IdRegistro_Pagamento'#13#10'    LEFT OUTER JOIN /* Conversão Taxa - Logistica Moeda */'#13#10'      mov_Logistica_Fatura_Conversao Ctm ON Ctm.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Ctm.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctm.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Ctm.IdMoeda_Origem = Lmd.IdMoeda AND Ctm.IdMoeda_Destino = Ltx.IdMoeda_Pagamento)) '#13#10'    LEFT OUTER JOIN /* Conversão Taxa - Fatura */'#13#10'      mov_Logistica_Fatura_Conversao Ctf ON Ctf.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Ctf.IdMoeda_Origem = Ltx.IdMoeda_Pagamento AND Ctf.IdMoeda_Destino = Ftr.IdMoeda)'#13#10'        OR (Ctf.IdMoeda_Origem = Ftr.IdMoeda AND Ctf.IdMoeda_Destino = Ltx.IdMoeda_Pagamento))'#13#10'    LEFT OUTER JOIN /* Conversão Fatura - Logistica Moeda */'#13#10'      mov_Logistica_Fatura_Conversao Cfm ON Cfm.IdLogistica_Fatura = Ftr.IdRegistro_Financeiro'#13#10'        AND ((Cfm.IdMoeda_Origem = Ftr.IdMoeda AND Cfm.IdMoeda_Destino = Lmd.IdMoeda)'#13#10'        OR (Cfm.IdMoeda_Origem = Lmd.IdMoeda AND Cfm.IdMoeda_Destino = Ftr.IdMoeda))'#13#10'    WHERE'#13#10'      Lmd.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Rcm'#13#10'  GROUP BY'#13#10'    Rcm.IdLogistica_Moeda'#13#10'  ) AS Cms ON Cms.IdLogistica_Moeda = Lmd.IdLogistica_Moeda'#13#10'WHERE'#13#10'  Lmd.IdLogistica_House = @IdLogistica_House'";"[0]['IdLogistica_House']='5998'; [1]['Profit_Estimado_Sem_Canceladas']='False'"
"31";"55";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"207";"OK";"-1";"'Declare'#13#10'  @Parametros Xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Parametros>'#13#10'  <Evento Classe="TAcompanhamento" Tipo="3">'#13#10'    <CommandText>Select @IdProjeto_Atividade=5, @Projeto_Atividade = (Select Lhs.IdProjeto_Atividade From mov_Logistica_Master Lms Join mov_Logistica_House Lhs on Lhs.IdLogistica_Master = Lms.IdLogistica_Master Where Lms.IdLogistica_Master = 1 For XML Path('#39''#39''#39''#39'), Root('#39''#39'Parametros'#39''#39'), Type)</CommandText>'#13#10'    <PrimaryKeys>'#13#10'      <Item Nome="IdAcompanhamento" Valor="466"/>'#13#10'    </PrimaryKeys>'#13#10'    <Campos>'#13#10'      <Item Nome="Descricao" OldValue="AAQAaaaa" Value="AAQAaaaaaa"/>'#13#10'    </Campos>'#13#10'  </Evento>'#13#10'</Parametros>'#39'*/'#13#10''#13#10'Declare'#13#10'  @IdProjeto_Atividade IdLongo,'#13#10'  @Projeto_Atividade Xml,'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39'),'#13#10'  @CommandText = Prm.value('#39'(CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'exec sp_executesql @CommandText, N'#39'@IdProjeto_Atividade IdLongo OUTPUT, @Projeto_Atividade Xml OUTPUT'#39', @IdProjeto_Atividade=@IdProjeto_Atividade OUTPUT, @Projeto_Atividade=@Projeto_Atividade OUTPUT'#13#10''#13#10'Declare Monitor_Tarefa Cursor For'#13#10'Select'#13#10'  Prj.IdProjeto_Atividade,'#13#10'  Trf.IdTarefa,'#13#10'  Tmn.IdProjeto_Tarefa_Monitor,'#13#10'  Ptm.Ao_Inserir,'#13#10'  Ptm.Ao_Excluir,'#13#10'  Ptm.Ao_Atualizar,'#13#10'  Ptm.Dados_Registro'#13#10'From'#13#10'('#13#10'  Select'#13#10'    @IdProjeto_Atividade as IdProjeto_Atividade'#13#10'  Where'#13#10'    @IdProjeto_Atividade Is Not Null'#13#10'  Union Select'#13#10'    Prj.value('#39'.'#39', '#39'int'#39') as IdProjeto_Atividade'#13#10'  From'#13#10'    @Projeto_Atividade.nodes('#39'/Parametros/IdProjeto_Atividade'#39') as Projeto_Atividade(Prj)'#13#10') Prj'#13#10'Join'#13#10'  mov_Projeto_Atividade Pat on Pat.IdProjeto_Atividade = Prj.IdProjeto_Atividade'#13#10'Join'#13#10'  cad_Projeto_Tarefa Ptr on Ptr.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa Trf on Trf.IdProjeto_Tarefa = Pat.IdProjeto_Tarefa'#13#10'Join'#13#10'  cad_Tarefa_Monitor Tmn on Tmn.IdTarefa = Trf.IdTarefa'#13#10'Join'#13#10'  cad_Projeto_Tarefa_Monitor Ptm on Ptm.IdProjeto_Tarefa_Monitor = Tmn.IdProjeto_Tarefa_Monitor'#13#10'    And Ptm.Ativo = 1'#13#10'And'#13#10'  Ptm.Classe Like @Classe'#13#10'Left Outer Join ('#13#10'  Select'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa'#13#10'  From'#13#10'    mov_Atividade'#13#10'  Group By'#13#10'    IdProjeto_Atividade,'#13#10'    IdTarefa) Atv on Atv.IdProjeto_Atividade = Pat.IdProjeto_Atividade'#13#10'And'#13#10'  Atv.IdTarefa = Trf.IdTarefa'#13#10'Where'#13#10'  ((Atv.IdProjeto_Atividade Is Not Null)'#13#10'Or'#13#10'  (Case Tmn.Geracao_Atividade'#13#10'    When 1 /* depende monitor projeto */ Then Ptm.Geracao_Atividades'#13#10'    When 2 /* sim */ Then 1'#13#10'    When 3 /* não */ Then 0'#13#10'  End = 1 /* sim */))'#13#10'  '#13#10'Declare'#13#10'  @IdTarefa IdCurto,'#13#10'  @IdProjeto_Tarefa_Monitor IdCurto,'#13#10'  @Ao_Inserir TipoFixo,'#13#10'  @Ao_Excluir TipoFixo,'#13#10'  @Ao_Atualizar TipoFixo,'#13#10'  @Dados_Registro Xml,'#13#10'  @Situacao TipoFixo,'#13#10'  @Ignorar_Eventos Boleano,'#13#10'  @Preview_Mensagem Boleano,'#13#10'  @Monitoramentos Xml'#13#10'  '#13#10'Open Monitor_Tarefa'#13#10''#13#10'Fetch Next From Monitor_Tarefa Into'#13#10'  @IdProjeto_Atividade,'#13#10'  @IdTarefa,'#13#10'  @IdProjeto_Tarefa_Monitor,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Atualizar,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Tarefa Table ('#13#10'  IdProjeto_Atividade IdLongo,'#13#10'  IdTarefa IdCurto,'#13#10'  Situacao TipoFixo,'#13#10'  Ignorar_Eventos Boleano,'#13#10'  Preview_Mensagem Boleano,'#13#10'  Monitoramentos Xml'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Ignorar_Eventos = 0,'#13#10'    @Preview_Mensagem = 1,'#13#10'    @Situacao = Case'#13#10'        When @Evento = 1 Then @Ao_Inserir'#13#10'        When @Evento = 2 Then @Ao_Excluir'#13#10'        When @Evento = 3 Then @Ao_Atualizar'#13#10'      End'#13#10''#13#10'  If (@Evento = 3) And (@Situacao <> 0) And (@Dados_Registro.value('#39'count(/Dados_Registro/Monitoramento/Campos/Item)'#39', '#39'int'#39') > 0)'#13#10'  Begin'#13#10'    If Not Exists(Select'#13#10'        Itn.query('#39'.'#39')'#13#10'      From'#13#10'        @Dados_Registro.nodes('#39'/Dados_Registro/Monitoramento/Campos/Item'#39') as Campos(Itn)'#13#10'      Cross Apply'#13#10'        @Parametros.nodes('#39'/Parametros/Evento/Campos/Item'#39') as Parametros(Prm)'#13#10'      Where'#13#10'        Prm.value('#39'@Nome'#39', '#39'VarChar(Max)'#39') Like Itn.value('#39'@Nome'#39', '#39'VarChar(Max)'#39'))'#13#10'    Begin'#13#10'      Set @Situacao = 0'#13#10'    End'#13#10'  End'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/Monitoramento/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @IdProjeto_Atividade IdLongo, @IdTarefa IdCurto, @Evento TipoFixo, @Situacao TipoFixo OUTPUT, @Ignorar_Eventos Boleano OUTPUT, @Preview_Mensagem Boleano OUTPUT'#39','#13#10'      @Parametros=@Parametros, @IdProjeto_Atividade=@IdProjeto_Atividade, @IdTarefa=@IdTarefa, @Evento=@Evento, @Situacao=@Situacao OUTPUT, @Ignorar_Eventos=@Ignorar_Eventos OUTPUT, @Preview_Mensagem=@Preview_Mensagem OUTPUT'#13#10'																																			'#13#10'  If @Situacao <> 0'#13#10'  Begin'#13#10'    if Exists(Select IdTarefa From @Tarefa Where IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade)'#13#10'    Begin'#13#10'      Update @Tarefa Set'#13#10'        Monitoramentos.modify('#39'insert'#13#10'          <Descartado IdProjeto_Tarefa_Monitor="{sql:variable("@IdProjeto_Tarefa_Monitor")}"'#13#10'            Situacao="{sql:variable("@Situacao")}"'#13#10'            Ignorar_Eventos="{sql:variable("@Ignorar_Eventos") cast as xs:int?}"'#13#10'            Preview_Mensagem="{sql:variable("@Preview_Mensagem") cast as xs:int?}">'#13#10'          </Descartado> as last into (/Monitoramentos)[1]'#39')'#13#10'      From'#13#10'        @Tarefa Trf'#13#10'      Where'#13#10'        IdTarefa = @IdTarefa And IdProjeto_Atividade = @IdProjeto_Atividade'#13#10'    End'#13#10'    Else'#13#10'    Begin'#13#10'      Insert Into @Tarefa (IdProjeto_Atividade, IdTarefa, Situacao, Ignorar_Eventos, Preview_Mensagem, Monitoramentos)'#13#10'      Values (@IdProjeto_Atividade, @IdTarefa, @Situacao, @Ignorar_Eventos, @Preview_Mensagem, (Select'#13#10'        @IdProjeto_Tarefa_Monitor as [@IdProjeto_Tarefa_Monitor],'#13#10'        @Situacao as [@Situacao],'#13#10'        @Ignorar_Eventos as [@Ignorar_Eventos],'#13#10'        @Preview_Mensagem as [@Preview_Mensagem]'#13#10'      For Xml Path('#39'Monitoramentos'#39')))'#13#10'    End'#13#10'  End'#13#10''#13#10'  Fetch Next From Monitor_Tarefa Into'#13#10'    @IdProjeto_Atividade,'#13#10'    @IdTarefa,'#13#10'    @IdProjeto_Tarefa_Monitor,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Atualizar,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Monitor_Tarefa'#13#10'Deallocate Monitor_Tarefa'#13#10''#13#10'Select'#13#10'  IdProjeto_Atividade,'#13#10'  IdTarefa,'#13#10'  Situacao,'#13#10'  Ignorar_Eventos,'#13#10'  Preview_Mensagem,'#13#10'  Monitoramentos'#13#10'From'#13#10'  @Tarefa'#13#10'Order By'#13#10'  IdTarefa'";"[0]['0']='<Parametros><Evento Classe="TLogisticaHouse" Tipo="3"><CommandText>Select @IdProjeto_Atividade = IdProjeto_Atividade From mov_Logistica_House Where IdLogistica_House = 5998</CommandText><PrimaryKeys><Item Nome="IdLogistica_House" Valor="5998"/></PrimaryKeys><Campos><Item Nome="Data_Pagamento_Local" Value="2/11/2026"/><Item Nome="Situacao_Pagamento" OldValue="1" Value="3"/><Item Nome="Faturas_Em_Aberto" OldValue="-1" Value="0"/><Item Nome="Data_Ultima_Baixa" OldValue="2/11/2026 1:38:52 PM" Value="2/11/2026 1:39:28 PM"/><Item Nome="Situacao_Pagamento_Frete" OldValue="1" Value="2"/><Item Nome="Data_Pagamento_Frete" Value="2/11/2026"/></Campos></Evento></Parametros>'"
"31";"54";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"11";"OK";"1";"'update mov_Logistica_House  set'#13#10' Data_Pagamento_Local = ?,'#13#10' Situacao_Pagamento = ?,'#13#10' Faturas_Em_Aberto = ?,'#13#10' Data_Ultima_Baixa = ?,'#13#10' Situacao_Pagamento_Frete = ?,'#13#10' Data_Pagamento_Frete = ?'#13#10'where'#13#10' IdLogistica_House = ?'";"[0]['Param1']='11/02/2026'; [1]['Param2']='3'; [2]['Param3']='False'; [3]['Param4']='11/02/2026 13:39:28'; [4]['Param5']='2'; [5]['Param6']='11/02/2026'; [6]['Param7']='5998'"
"31";"53";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"19";"OK";"-1";"'/*'#13#10'EVENTOS'#13#10'1 - Ao inserir'#13#10'2 - Ao editar'#13#10'3 - Ao excluir'#13#10'4 - Ao confirmar inserção'#13#10'5 - Ao confirmar edição'#13#10''#13#10'AÇÔES'#13#10'1 - Permitir'#13#10'2 - Exibir aviso'#13#10'3 - Solicitar confirmação'#13#10'4 - Senha'#13#10'5 - Bloquear'#13#10'*/'#13#10''#13#10'SET NOCOUNT ON'#13#10''#13#10'Declare'#13#10'  @IdUsuario IdCurto,'#13#10'  @IdBloqueio_Condicional_List VarChar(Max),'#13#10'  @Parametros Xml'#13#10''#13#10'Set @IdUsuario = ?'#13#10'Set @IdBloqueio_Condicional_List = ?'#13#10'Set @Parametros = ?'#13#10''#13#10'Declare'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @IgnorarSegurancaCount InteiroCurto,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @IgnorarSegurancaCount = Prm.value('#39'@IgnorarSegurancaCount'#39', '#39'smallint'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'Declare Bloqueio Cursor For'#13#10'Select'#13#10'  Bcn.IdBloqueio_Condicional,'#13#10'  Bcn.Ao_Inserir,'#13#10'  Bcn.Ao_Editar,'#13#10'  Bcn.Ao_Excluir,'#13#10'  Bcn.Ao_Confirmar_Edicao,'#13#10'  Bcn.Ao_Confirmar_Insercao,'#13#10'  Bcn.Dados_Registro'#13#10'From'#13#10'  string_split(@IdBloqueio_Condicional_List, '#39','#39') prm'#13#10'Join'#13#10'  cad_Bloqueio_Condicional Bcn on Bcn.IdBloqueio_Condicional = prm.value'#13#10'Where'#13#10'  (Bcn.Classe Like @Classe)'#13#10'    And (Bcn.Bloqueio_Ativo = 1)'#13#10'    And (((@Evento = 1) and (Bcn.Ao_Inserir = 1))'#13#10'      or ((@Evento = 2) and (Bcn.Ao_Editar = 1))'#13#10'      or ((@Evento = 3) and (Bcn.Ao_Excluir = 1))'#13#10'      or ((@Evento = 4) and (Bcn.Ao_Confirmar_Insercao = 1))'#13#10'      or ((@Evento = 5) and (Bcn.Ao_Confirmar_Edicao = 1)))'#13#10'  '#13#10'Open Bloqueio'#13#10''#13#10'Declare'#13#10'  @IdBloqueio_Condicional IdCurto,'#13#10'  @Ao_Inserir Boleano,'#13#10'  @Ao_Editar Boleano,'#13#10'  @Ao_Excluir Boleano,'#13#10'  @Ao_Confirmar_Edicao Boleano,'#13#10'  @Ao_Confirmar_Insercao Boleano,'#13#10'  @Dados_Registro Xml,'#13#10'  @Acao TipoFixo,'#13#10'  @Mensagem VarChar(Max),'#13#10'  @Prioridade InteiroMicro,'#13#10'  @IgnorarSegurancaAoConfirmar Bit'#13#10''#13#10'Fetch Next From Bloqueio Into'#13#10'  @IdBloqueio_Condicional,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Editar,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Confirmar_Insercao,'#13#10'  @Ao_Confirmar_Edicao,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Acoes Table ('#13#10'  IdBloqueio_Condicional IdCurto,'#13#10'  Acao TipoFixo,'#13#10'  Mensagem VarChar(Max),'#13#10'  Prioridade InteiroMicro,'#13#10'  IgnorarSegurancaCount InteiroMicro'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Acao = 0,'#13#10'    @Mensagem = NULL,'#13#10'    @Prioridade = 0,'#13#10'    @IgnorarSegurancaAoConfirmar = 1'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @Evento TipoFixo, @IgnorarSegurancaCount InteiroCurto OUTPUT, @IgnorarSegurancaAoConfirmar Bit OUTPUT, @Acao TipoFixo OUTPUT, @Mensagem VarChar(Max) OUTPUT, @Prioridade InteiroMicro OUTPUT'#39','#13#10'      @Parametros=@Parametros, @Evento=@Evento, @IgnorarSegurancaCount=@IgnorarSegurancaCount OUTPUT, @IgnorarSegurancaAoConfirmar=@IgnorarSegurancaAoConfirmar OUTPUT, @Acao=@Acao OUTPUT, @Mensagem=@Mensagem OUTPUT, @Prioridade=@Prioridade OUTPUT'#13#10''#13#10'  If (@Evento in (4 /* Ao confirmar inserção */, 5 /* Ao confirmar edição */) And @IgnorarSegurancaAoConfirmar = 1)'#13#10'    Set @IgnorarSegurancaCount = 0'#13#10''#13#10'  If (@Acao <> 0) And (@IgnorarSegurancaCount = 0)'#13#10'    Insert Into @Acoes (IdBloqueio_Condicional, Acao, Mensagem, Prioridade, IgnorarSegurancaCount) Values (@IdBloqueio_Condicional, @Acao, @Mensagem, @Prioridade, @IgnorarSegurancaCount)'#13#10''#13#10'  Fetch Next From Bloqueio Into'#13#10'    @IdBloqueio_Condicional,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Editar,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Confirmar_Insercao,'#13#10'    @Ao_Confirmar_Edicao,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Bloqueio'#13#10'Deallocate Bloqueio'#13#10''#13#10'SET NOCOUNT OFF'#13#10''#13#10'Select'#13#10'  IdBloqueio_Condicional,'#13#10'  Acao,'#13#10'  Mensagem,'#13#10'  IgnorarSegurancaCount'#13#10'From'#13#10'  @Acoes'#13#10'Order By'#13#10'  Acao Desc,'#13#10'  Prioridade'";"[0][]='122'; [1][]='1440'; [2][]='<Parametros><Evento Classe="TLogisticaHouse" Tipo="5" IgnorarSegurancaCount="5"><Campos><Item Nome="IdLogistica_House" Value="5998"/><Item Nome="IdLogistica_Master" Value="6107"/><Item Nome="IdCliente" Value="54801"/><Item Nome="IdImportador" Value="54801"/><Item Nome="IdExportador"/><Item Nome="IdNotify"/><Item Nome="IdDespachante_Aduaneiro"/><Item Nome="IdRepresentante" Value="54700"/><Item Nome="IdRepresentante_Destino_Final"/><Item Nome="IdSeguradora"/><Item Nome="IdVendedor" Value="54501"/><Item Nome="IdIncoterm" Value="2"/><Item Nome="IdMercadoria"/><Item Nome="IdMoeda_Mercadoria"/><Item Nome="IdStatus_Processo_Logistico"/><Item Nome="IdContrato_Frete"/><Item Nome="IdOferta_Frete" Value="2982"/><Item Nome="IdOferta_Frete_Original" Value="2982"/><Item Nome="IdProcesso_Origem"/><Item Nome="IdProcesso_Origem_Clonagem"/><Item Nome="IdProcesso_Primeiro_Trecho"/><Item Nome="IdTransportadora_Origem"/><Item Nome="IdTransportadora_Destino"/><Item Nome="IdProjeto_Atividade" Value="8594"/><Item Nome="IdEmpresa_Sistema" Value="12"/><Item Nome="IdTipo_Processo" Value="1"/><Item Nome="IdMoeda_Pagamento_Demurrage"/><Item Nome="IdMoeda_Recebimento_Demurrage"/><Item Nome="IdIndicacao"/><Item Nome="IdPais_Origem_Mercadoria"/><Item Nome="IdPais_Destino_Mercadoria"/><Item Nome="IdNVOCC"/><Item Nome="IdFuncionario_Criacao" Value="54979"/><Item Nome="Numero_Processo" Value="IA-YKS-0038-25"/><Item Nome="Numero_Invoices" Value=""/><Item Nome="Referencia_Interna"/><Item Nome="Referencia_Externa" Value=""/><Item Nome="Referencia_Cliente" Value=""/><Item Nome="Senha_Fatura"/><Item Nome="Local_Coleta" Value=""/><Item Nome="Local_Coleta_Destino" Value=""/><Item Nome="Local_Entrega_Origem" Value=""/><Item Nome="Local_Entrega" Value=""/><Item Nome="Local_Emissao_Outro"/><Item Nome="Consolidado_House" Value="0"/><Item Nome="Encaminhado_Por" Value="6"/><Item Nome="Modalidade_Pagamento" Value="3"/><Item Nome="Tipo_Servico" Value="1"/><Item Nome="Tipo_Frete"/><Item Nome="Modalidade_Coleta"/><Item Nome="Modalidade_Entrega"/><Item Nome="Tipo_Coleta_Entrega"/><Item Nome="Tipo_Coleta_Entrega_Destino"/><Item Nome="Tipo_Carga" Value="1"/><Item Nome="Tipo_Projeto" Value="1"/><Item Nome="Trecho" Value="0"/><Item Nome="Comissao_Coleta" Value="0"/><Item Nome="Comissao_Entrega" Value="0"/><Item Nome="Numero_DI_RE"/><Item Nome="Numero_LI_DDE"/><Item Nome="Numero_Courrier"/><Item Nome="Metros_Cubicos"/><Item Nome="Peso_Liquido"/><Item Nome="Peso_Bruto"/><Item Nome="Peso_Cubado"/><Item Nome="Peso_Considerado"/><Item Nome="Quantidade_Volumes"/><Item Nome="Data_Abertura_Processo" Value="12/22/2025 2:06:58 PM"/><Item Nome="Data_Previsao_Prontidao_Carga"/><Item Nome="Data_Prontidao_Carga"/><Item Nome="Data_Liberado_Faturamento"/><Item Nome="Data_Faturado" Value="2/11/2026"/><Item Nome="Data_Recebimento_Local" Value="2/11/2026"/><Item Nome="Data_Pagamento_Local" Value="2/11/2026" Changed="True"/><Item Nome="Data_Acerto_Agente"/><Item Nome="Data_Fechamento_Cambio"/><Item Nome="Data_Auditado"/><Item Nome="Data_Fechamento_Processo" Value="2/11/2026"/><Item Nome="Data_Previsao_Coleta"/><Item Nome="Data_Previsao_Coleta_Destino"/><Item Nome="Data_Coleta"/><Item Nome="Data_Coleta_Destino"/><Item Nome="Data_Previsao_Entrega_Origem"/><Item Nome="Data_Previsao_Entrega"/><Item Nome="Data_Entrega_Origem"/><Item Nome="Data_Entrega"/><Item Nome="Data_Validade_Taxas"/><Item Nome="Data_Chegada_Armazem"/><Item Nome="Canal_Liberacao"/><Item Nome="Local_Emissao"/><Item Nome="Situacao_Agenciamento" Value="5"/><Item Nome="Situacao_Pagamento" Value="3" OldValue="1" Changed="True"/><Item Nome="Situacao_Recebimento" Value="3"/><Item Nome="Situacao_Demurrage"/><Item Nome="Situacao_Acerto_Agente" Value="0"/><Item Nome="Situacao_Pre_Finalizado" Value="4"/><Item Nome="Quantidade_Invoices"/><Item Nome="Total_Conhecimentos" Value="1"/><Item Nome="Valor_Mercadoria"/><Item Nome="Importancia_Segurada"/><Item Nome="Percentual_Seguro"/><Item Nome="Agenciamento_Carga" Value="1"/><Item Nome="Desembaraco_Aduaneiro" Value="0"/><Item Nome="Demurrage_Detention" Value="0"/><Item Nome="Tipo_Rota"/><Item Nome="Rota"/><Item Nome="Seguro"/><Item Nome="Carga_Perigosa"/><Item Nome="Carga_Empilhavel"/><Item Nome="Ordem_Compra" Value=""/><Item Nome="NCM_Descricao" Value=""/><Item Nome="Parecer_Auditoria" Value=""/><Item Nome="Instrucoes_Operacional" Value="TESTEEEEEEE"/><Item Nome="Instrucoes_Financeiro" Value="teste"/><Item Nome="Instrucoes_Cliente" Value=""/><Item Nome="Instrucoes_Agente" Value=""/><Item Nome="Instrucoes_Operacional_Cliente" Value=""/><Item Nome="Shipper_Exporter" Value=""/><Item Nome="Consignee" Value="APPLE COMPUTER INC.&'#39'#35'#39'xA;,  - &'#39'#35'#39'xA; -  - &'#39'#35'#39'xA;CPF/CNPJ: "/><Item Nome="Notify" Value=""/><Item Nome="Conhecimentos" Value="TESTEAWB"/><Item Nome="Numeros_Embarque" Value=""/><Item Nome="Observacao" Value=""/><Item Nome="Tipo_Declaracao"/><Item Nome="Data_LI_DDE"/><Item Nome="Data_DI_RE"/><Item Nome="Natureza_Exportacao"/><Item Nome="Data_Averbacao"/><Item Nome="Tipo_Conhecimento_Embarque"/><Item Nome="Numeros_RVS_RAS"/><Item Nome="Numeros_RF_RP"/><Item Nome="Quantidade_UN_Nacoes_Unidas"/><Item Nome="Faturas_Em_Aberto" Value="0" OldValue="1" Changed="True"/><Item Nome="IdUltimo_Registro_Baixa" Value="15480"/><Item Nome="Data_Ultima_Baixa" Value="2/11/2026 1:39:28 PM" OldValue="2/11/2026 1:38:52 PM" Changed="True"/><Item Nome="IdMotivo_Cancelamento_Processo"/><Item Nome="IdLogistica_Seguro"/><Item Nome="Data_Cancelamento"/><Item Nome="Detalhes_Cancelamento"/><Item Nome="Situacao_Siscoserv" Value="1"/><Item Nome="Situacao_Tracking"/><Item Nome="Data_Atualizacao_Tracking"/><Item Nome="Comentario_Siscoserv"/><Item Nome="Remarks" Value=""/><Item Nome="Remarks_Terrestre" Value=""/><Item Nome="Remarks_Free_Time" Value=""/><Item Nome="Situacao_Pagamento_Frete" Value="2" OldValue="1" Changed="True"/><Item Nome="Data_Pagamento_Frete" Value="2/11/2026" Changed="True"/><Item Nome="Situacao_Recebimento_Frete" Value="2"/><Item Nome="Data_Recebimento_Frete" Value="2/11/2026"/><Item Nome="Ativo" Value="1"/><Item Nome="Atualizacao_Taxas_Comercial" Value="3"/></Campos></Evento></Parametros>'"
"31";"52";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"49";"OK";"-1";"'/*'#13#10'EVENTOS'#13#10'1 - Ao inserir'#13#10'2 - Ao editar'#13#10'3 - Ao excluir'#13#10'4 - Ao confirmar inserção'#13#10'5 - Ao confirmar edição'#13#10''#13#10'AÇÔES'#13#10'1 - Permitir'#13#10'2 - Exibir aviso'#13#10'3 - Solicitar confirmação'#13#10'4 - Senha'#13#10'5 - Bloquear'#13#10'*/'#13#10''#13#10'SET NOCOUNT ON'#13#10''#13#10'Declare'#13#10'  @IdUsuario IdCurto,'#13#10'  @IdBloqueio_Condicional_List VarChar(Max),'#13#10'  @Parametros Xml'#13#10''#13#10'Set @IdUsuario = ?'#13#10'Set @IdBloqueio_Condicional_List = ?'#13#10'Set @Parametros = ?'#13#10''#13#10'Declare'#13#10'  @Classe AlfaNumericoLongo,'#13#10'  @Evento TipoFixo,'#13#10'  @IgnorarSegurancaCount InteiroCurto,'#13#10'  @CommandText nVarChar(Max)'#13#10''#13#10'Select'#13#10'  @Classe = Prm.value('#39'@Classe'#39', '#39'VarChar(Max)'#39'),'#13#10'  @IgnorarSegurancaCount = Prm.value('#39'@IgnorarSegurancaCount'#39', '#39'smallint'#39'),'#13#10'  @Evento = Prm.value('#39'@Tipo'#39', '#39'int'#39')'#13#10'From'#13#10'  @Parametros.nodes('#39'/Parametros/Evento'#39') as Parametros(Prm)'#13#10''#13#10'Declare Bloqueio Cursor For'#13#10'Select'#13#10'  Bcn.IdBloqueio_Condicional,'#13#10'  Bcn.Ao_Inserir,'#13#10'  Bcn.Ao_Editar,'#13#10'  Bcn.Ao_Excluir,'#13#10'  Bcn.Ao_Confirmar_Edicao,'#13#10'  Bcn.Ao_Confirmar_Insercao,'#13#10'  Bcn.Dados_Registro'#13#10'From'#13#10'  string_split(@IdBloqueio_Condicional_List, '#39','#39') prm'#13#10'Join'#13#10'  cad_Bloqueio_Condicional Bcn on Bcn.IdBloqueio_Condicional = prm.value'#13#10'Where'#13#10'  (Bcn.Classe Like @Classe)'#13#10'    And (Bcn.Bloqueio_Ativo = 1)'#13#10'    And (((@Evento = 1) and (Bcn.Ao_Inserir = 1))'#13#10'      or ((@Evento = 2) and (Bcn.Ao_Editar = 1))'#13#10'      or ((@Evento = 3) and (Bcn.Ao_Excluir = 1))'#13#10'      or ((@Evento = 4) and (Bcn.Ao_Confirmar_Insercao = 1))'#13#10'      or ((@Evento = 5) and (Bcn.Ao_Confirmar_Edicao = 1)))'#13#10'  '#13#10'Open Bloqueio'#13#10''#13#10'Declare'#13#10'  @IdBloqueio_Condicional IdCurto,'#13#10'  @Ao_Inserir Boleano,'#13#10'  @Ao_Editar Boleano,'#13#10'  @Ao_Excluir Boleano,'#13#10'  @Ao_Confirmar_Edicao Boleano,'#13#10'  @Ao_Confirmar_Insercao Boleano,'#13#10'  @Dados_Registro Xml,'#13#10'  @Acao TipoFixo,'#13#10'  @Mensagem VarChar(Max),'#13#10'  @Prioridade InteiroMicro,'#13#10'  @IgnorarSegurancaAoConfirmar Bit'#13#10''#13#10'Fetch Next From Bloqueio Into'#13#10'  @IdBloqueio_Condicional,'#13#10'  @Ao_Inserir,'#13#10'  @Ao_Editar,'#13#10'  @Ao_Excluir,'#13#10'  @Ao_Confirmar_Insercao,'#13#10'  @Ao_Confirmar_Edicao,'#13#10'  @Dados_Registro'#13#10''#13#10'Declare @Acoes Table ('#13#10'  IdBloqueio_Condicional IdCurto,'#13#10'  Acao TipoFixo,'#13#10'  Mensagem VarChar(Max),'#13#10'  Prioridade InteiroMicro,'#13#10'  IgnorarSegurancaCount InteiroMicro'#13#10')'#13#10''#13#10'While @@FETCH_STATUS = 0'#13#10'Begin'#13#10'  Select'#13#10'    @Acao = 0,'#13#10'    @Mensagem = NULL,'#13#10'    @Prioridade = 0,'#13#10'    @IgnorarSegurancaAoConfirmar = 1'#13#10''#13#10'  Set @CommandText = @Dados_Registro.value('#39'(Dados_Registro/CommandText)[1]'#39', '#39'nVarChar(Max)'#39')'#13#10''#13#10'  If NullIf(LTrim(@CommandText), '#39''#39') Is Not Null'#13#10'    exec sp_executesql @CommandText, N'#39'@Parametros Xml, @Evento TipoFixo, @IgnorarSegurancaCount InteiroCurto OUTPUT, @IgnorarSegurancaAoConfirmar Bit OUTPUT, @Acao TipoFixo OUTPUT, @Mensagem VarChar(Max) OUTPUT, @Prioridade InteiroMicro OUTPUT'#39','#13#10'      @Parametros=@Parametros, @Evento=@Evento, @IgnorarSegurancaCount=@IgnorarSegurancaCount OUTPUT, @IgnorarSegurancaAoConfirmar=@IgnorarSegurancaAoConfirmar OUTPUT, @Acao=@Acao OUTPUT, @Mensagem=@Mensagem OUTPUT, @Prioridade=@Prioridade OUTPUT'#13#10''#13#10'  If (@Evento in (4 /* Ao confirmar inserção */, 5 /* Ao confirmar edição */) And @IgnorarSegurancaAoConfirmar = 1)'#13#10'    Set @IgnorarSegurancaCount = 0'#13#10''#13#10'  If (@Acao <> 0) And (@IgnorarSegurancaCount = 0)'#13#10'    Insert Into @Acoes (IdBloqueio_Condicional, Acao, Mensagem, Prioridade, IgnorarSegurancaCount) Values (@IdBloqueio_Condicional, @Acao, @Mensagem, @Prioridade, @IgnorarSegurancaCount)'#13#10''#13#10'  Fetch Next From Bloqueio Into'#13#10'    @IdBloqueio_Condicional,'#13#10'    @Ao_Inserir,'#13#10'    @Ao_Editar,'#13#10'    @Ao_Excluir,'#13#10'    @Ao_Confirmar_Insercao,'#13#10'    @Ao_Confirmar_Edicao,'#13#10'    @Dados_Registro'#13#10'End'#13#10''#13#10'Close Bloqueio'#13#10'Deallocate Bloqueio'#13#10''#13#10'SET NOCOUNT OFF'#13#10''#13#10'Select'#13#10'  IdBloqueio_Condicional,'#13#10'  Acao,'#13#10'  Mensagem,'#13#10'  IgnorarSegurancaCount'#13#10'From'#13#10'  @Acoes'#13#10'Order By'#13#10'  Acao Desc,'#13#10'  Prioridade'";"[0][]='122'; [1][]='1440'; [2][]='<Parametros><Evento Classe="TLogisticaHouse" Tipo="2" IgnorarSegurancaCount="5"><Campos><Item Nome="IdLogistica_House" Value="5998"/><Item Nome="IdLogistica_Master" Value="6107"/><Item Nome="IdCliente" Value="54801"/><Item Nome="IdImportador" Value="54801"/><Item Nome="IdExportador"/><Item Nome="IdNotify"/><Item Nome="IdDespachante_Aduaneiro"/><Item Nome="IdRepresentante" Value="54700"/><Item Nome="IdRepresentante_Destino_Final"/><Item Nome="IdSeguradora"/><Item Nome="IdVendedor" Value="54501"/><Item Nome="IdIncoterm" Value="2"/><Item Nome="IdMercadoria"/><Item Nome="IdMoeda_Mercadoria"/><Item Nome="IdStatus_Processo_Logistico"/><Item Nome="IdContrato_Frete"/><Item Nome="IdOferta_Frete" Value="2982"/><Item Nome="IdOferta_Frete_Original" Value="2982"/><Item Nome="IdProcesso_Origem"/><Item Nome="IdProcesso_Origem_Clonagem"/><Item Nome="IdProcesso_Primeiro_Trecho"/><Item Nome="IdTransportadora_Origem"/><Item Nome="IdTransportadora_Destino"/><Item Nome="IdProjeto_Atividade" Value="8594"/><Item Nome="IdEmpresa_Sistema" Value="12"/><Item Nome="IdTipo_Processo" Value="1"/><Item Nome="IdMoeda_Pagamento_Demurrage"/><Item Nome="IdMoeda_Recebimento_Demurrage"/><Item Nome="IdIndicacao"/><Item Nome="IdPais_Origem_Mercadoria"/><Item Nome="IdPais_Destino_Mercadoria"/><Item Nome="IdNVOCC"/><Item Nome="IdFuncionario_Criacao" Value="54979"/><Item Nome="Numero_Processo" Value="IA-YKS-0038-25"/><Item Nome="Numero_Invoices" Value=""/><Item Nome="Referencia_Interna"/><Item Nome="Referencia_Externa" Value=""/><Item Nome="Referencia_Cliente" Value=""/><Item Nome="Senha_Fatura"/><Item Nome="Local_Coleta" Value=""/><Item Nome="Local_Coleta_Destino" Value=""/><Item Nome="Local_Entrega_Origem" Value=""/><Item Nome="Local_Entrega" Value=""/><Item Nome="Local_Emissao_Outro"/><Item Nome="Consolidado_House" Value="0"/><Item Nome="Encaminhado_Por" Value="6"/><Item Nome="Modalidade_Pagamento" Value="3"/><Item Nome="Tipo_Servico" Value="1"/><Item Nome="Tipo_Frete"/><Item Nome="Modalidade_Coleta"/><Item Nome="Modalidade_Entrega"/><Item Nome="Tipo_Coleta_Entrega"/><Item Nome="Tipo_Coleta_Entrega_Destino"/><Item Nome="Tipo_Carga" Value="1"/><Item Nome="Tipo_Projeto" Value="1"/><Item Nome="Trecho" Value="0"/><Item Nome="Comissao_Coleta" Value="0"/><Item Nome="Comissao_Entrega" Value="0"/><Item Nome="Numero_DI_RE"/><Item Nome="Numero_LI_DDE"/><Item Nome="Numero_Courrier"/><Item Nome="Metros_Cubicos"/><Item Nome="Peso_Liquido"/><Item Nome="Peso_Bruto"/><Item Nome="Peso_Cubado"/><Item Nome="Peso_Considerado"/><Item Nome="Quantidade_Volumes"/><Item Nome="Data_Abertura_Processo" Value="12/22/2025 2:06:58 PM"/><Item Nome="Data_Previsao_Prontidao_Carga"/><Item Nome="Data_Prontidao_Carga"/><Item Nome="Data_Liberado_Faturamento"/><Item Nome="Data_Faturado" Value="2/11/2026"/><Item Nome="Data_Recebimento_Local" Value="2/11/2026"/><Item Nome="Data_Pagamento_Local"/><Item Nome="Data_Acerto_Agente"/><Item Nome="Data_Fechamento_Cambio"/><Item Nome="Data_Auditado"/><Item Nome="Data_Fechamento_Processo" Value="2/11/2026"/><Item Nome="Data_Previsao_Coleta"/><Item Nome="Data_Previsao_Coleta_Destino"/><Item Nome="Data_Coleta"/><Item Nome="Data_Coleta_Destino"/><Item Nome="Data_Previsao_Entrega_Origem"/><Item Nome="Data_Previsao_Entrega"/><Item Nome="Data_Entrega_Origem"/><Item Nome="Data_Entrega"/><Item Nome="Data_Validade_Taxas"/><Item Nome="Data_Chegada_Armazem"/><Item Nome="Canal_Liberacao"/><Item Nome="Local_Emissao"/><Item Nome="Situacao_Agenciamento" Value="5"/><Item Nome="Situacao_Pagamento" Value="1"/><Item Nome="Situacao_Recebimento" Value="3"/><Item Nome="Situacao_Demurrage"/><Item Nome="Situacao_Acerto_Agente" Value="0"/><Item Nome="Situacao_Pre_Finalizado" Value="4"/><Item Nome="Quantidade_Invoices"/><Item Nome="Total_Conhecimentos" Value="1"/><Item Nome="Valor_Mercadoria"/><Item Nome="Importancia_Segurada"/><Item Nome="Percentual_Seguro"/><Item Nome="Agenciamento_Carga" Value="1"/><Item Nome="Desembaraco_Aduaneiro" Value="0"/><Item Nome="Demurrage_Detention" Value="0"/><Item Nome="Tipo_Rota"/><Item Nome="Rota"/><Item Nome="Seguro"/><Item Nome="Carga_Perigosa"/><Item Nome="Carga_Empilhavel"/><Item Nome="Ordem_Compra" Value=""/><Item Nome="NCM_Descricao" Value=""/><Item Nome="Parecer_Auditoria" Value=""/><Item Nome="Instrucoes_Operacional" Value="TESTEEEEEEE"/><Item Nome="Instrucoes_Financeiro" Value="teste"/><Item Nome="Instrucoes_Cliente" Value=""/><Item Nome="Instrucoes_Agente" Value=""/><Item Nome="Instrucoes_Operacional_Cliente" Value=""/><Item Nome="Shipper_Exporter" Value=""/><Item Nome="Consignee" Value="APPLE COMPUTER INC.&'#39'#35'#39'xA;,  - &'#39'#35'#39'xA; -  - &'#39'#35'#39'xA;CPF/CNPJ: "/><Item Nome="Notify" Value=""/><Item Nome="Conhecimentos" Value="TESTEAWB"/><Item Nome="Numeros_Embarque" Value=""/><Item Nome="Observacao" Value=""/><Item Nome="Tipo_Declaracao"/><Item Nome="Data_LI_DDE"/><Item Nome="Data_DI_RE"/><Item Nome="Natureza_Exportacao"/><Item Nome="Data_Averbacao"/><Item Nome="Tipo_Conhecimento_Embarque"/><Item Nome="Numeros_RVS_RAS"/><Item Nome="Numeros_RF_RP"/><Item Nome="Quantidade_UN_Nacoes_Unidas"/><Item Nome="Faturas_Em_Aberto" Value="1"/><Item Nome="IdUltimo_Registro_Baixa" Value="15480"/><Item Nome="Data_Ultima_Baixa" Value="2/11/2026 1:38:52 PM"/><Item Nome="IdMotivo_Cancelamento_Processo"/><Item Nome="IdLogistica_Seguro"/><Item Nome="Data_Cancelamento"/><Item Nome="Detalhes_Cancelamento"/><Item Nome="Situacao_Siscoserv" Value="1"/><Item Nome="Situacao_Tracking"/><Item Nome="Data_Atualizacao_Tracking"/><Item Nome="Comentario_Siscoserv"/><Item Nome="Remarks" Value=""/><Item Nome="Remarks_Terrestre" Value=""/><Item Nome="Remarks_Free_Time" Value=""/><Item Nome="Situacao_Pagamento_Frete" Value="1"/><Item Nome="Data_Pagamento_Frete"/><Item Nome="Situacao_Recebimento_Frete" Value="2"/><Item Nome="Data_Recebimento_Frete" Value="2/11/2026"/><Item Nome="Ativo" Value="1"/><Item Nome="Atualizacao_Taxas_Comercial" Value="3"/></Campos></Evento></Parametros>'"
"31";"51";"";"11/02/2026 13:38:59";"11/02/2026 13:38:59";"19";"OK";"1";"'Select'#13#10'  IdLogistica_House, IdLogistica_Master, IdCliente, IdImportador, IdExportador, IdNotify, IdDespachante_Aduaneiro, IdRepresentante, IdRepresentante_Destino_Final, IdSeguradora, IdVendedor, IdIncoterm, IdMercadoria, IdMoeda_Mercadoria, IdStatus_Processo_Logistico, IdContrato_Frete, IdOferta_Frete, IdOferta_Frete_Original, IdProcesso_Origem, IdProcesso_Origem_Clonagem, IdProcesso_Primeiro_Trecho, IdTransportadora_Origem, IdTransportadora_Destino, IdProjeto_Atividade, IdEmpresa_Sistema, IdTipo_Processo, IdMoeda_Pagamento_Demurrage, IdMoeda_Recebimento_Demurrage, IdIndicacao, IdPais_Origem_Mercadoria, IdPais_Destino_Mercadoria, IdNVOCC, IdFuncionario_Criacao, Numero_Processo, Numero_Invoices, Referencia_Interna, Referencia_Externa, Referencia_Cliente, Senha_Fatura, Local_Coleta, Local_Coleta_Destino, Local_Entrega_Origem, Local_Entrega, Local_Emissao_Outro, Consolidado_House, Encaminhado_Por, Modalidade_Pagamento, Tipo_Servico, Tipo_Frete, Modalidade_Coleta, Modalidade_Entrega, Tipo_Coleta_Entrega, Tipo_Coleta_Entrega_Destino, Tipo_Carga, Tipo_Projeto, Trecho, Comissao_Coleta, Comissao_Entrega, Numero_DI_RE, Numero_LI_DDE, Numero_Courrier, Metros_Cubicos, Peso_Liquido, Peso_Bruto, Peso_Cubado, Peso_Considerado, Quantidade_Volumes, Data_Abertura_Processo, Data_Previsao_Prontidao_Carga, Data_Prontidao_Carga, Data_Liberado_Faturamento, Data_Faturado, Data_Recebimento_Local, Data_Pagamento_Local, Data_Acerto_Agente, Data_Fechamento_Cambio, Data_Auditado, Data_Fechamento_Processo, Data_Previsao_Coleta, Data_Previsao_Coleta_Destino, Data_Coleta, Data_Coleta_Destino, Data_Previsao_Entrega_Origem, Data_Previsao_Entrega, Data_Entrega_Origem, Data_Entrega, Data_Validade_Taxas, Data_Chegada_Armazem, Canal_Liberacao, Local_Emissao, Situacao_Agenciamento, Situacao_Pagamento, Situacao_Recebimento, Situacao_Demurrage, Situacao_Acerto_Agente, Situacao_Pre_Finalizado, Quantidade_Invoices, Total_Conhecimentos, Valor_Mercadoria, Importancia_Segurada, Percentual_Seguro, Agenciamento_Carga, Desembaraco_Aduaneiro, Demurrage_Detention, Tipo_Rota, Rota, Seguro, Carga_Perigosa, Carga_Empilhavel, Ordem_Compra, NCM_Descricao, Parecer_Auditoria, Instrucoes_Operacional, Instrucoes_Financeiro, Instrucoes_Cliente, Instrucoes_Agente, Instrucoes_Operacional_Cliente, Shipper_Exporter, Consignee, Notify, Conhecimentos, Numeros_Embarque, Observacao, Tipo_Declaracao, Data_LI_DDE, Data_DI_RE, Natureza_Exportacao, Data_Averbacao, Tipo_Conhecimento_Embarque, Numeros_RVS_RAS, Numeros_RF_RP, Quantidade_UN_Nacoes_Unidas, Faturas_Em_Aberto, IdUltimo_Registro_Baixa, Data_Ultima_Baixa, IdMotivo_Cancelamento_Processo, IdLogistica_Seguro, Data_Cancelamento, Detalhes_Cancelamento, Situacao_Siscoserv, Situacao_Tracking, Data_Atualizacao_Tracking, Comentario_Siscoserv, Remarks, Remarks_Terrestre, Remarks_Free_Time, Situacao_Pagamento_Frete, Data_Pagamento_Frete, Situacao_Recebimento_Frete, Data_Recebimento_Frete, Ativo, Atualizacao_Taxas_Comercial'#13#10'From'#13#10'  mov_Logistica_House'#13#10'Where'#13#10'  IdLogistica_House = ?'";"[0]['0']='5998'"
"31";"50";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"25";"OK";"1";"'DECLARE'#13#10'  @IdRegistro_Financeiro IdLongo,'#13#10'  @IdLogistica_House IdLongo,'#13#10'  @Ignorar_Fatura_Vendedor Boleano,'#13#10'  @Ignorar_Fatura_Cancelada Boleano'#13#10''#13#10'SET @IdRegistro_Financeiro = ?'#13#10'SET @IdLogistica_House = ?'#13#10'SET @Ignorar_Fatura_Vendedor = ?'#13#10'SET @Ignorar_Fatura_Cancelada = ?'#13#10''#13#10'IF @IdLogistica_House = 0'#13#10'  Select'#13#10'    @IdLogistica_House = Lhs.IdLogistica_House'#13#10'  From'#13#10'    mov_Logistica_Fatura Lft'#13#10'  Join'#13#10'    mov_Logistica_House Lhs On Lhs.IdLogistica_House = Lft.IdLogistica_House'#13#10'  Where'#13#10'    Lft.IdRegistro_Financeiro = @IdRegistro_Financeiro'#13#10''#13#10'SELECT'#13#10'  Lhs.IdLogistica_House,'#13#10'  Lhs.Situacao_Agenciamento,'#13#10'  Lhs.Agenciamento_Carga,'#13#10'  Lhs.Desembaraco_Aduaneiro,'#13#10'  Lhs.Demurrage_Detention,'#13#10'  COALESCE(Lhs.Situacao_Pre_Finalizado, 2 /* Em andamento */) AS Situacao_Pre_Finalizado,'#13#10'  Lhs.Data_Faturado,'#13#10'  Lhs.Data_Auditado,'#13#10'  Lhs.Data_Fechamento_Processo AS Data_Finalizado,'#13#10'  Lms.Tipo_Operacao,'#13#10'  Lms.Modalidade_Processo,'#13#10'  Lms.Data_Desembarque,'#13#10'  Ttl.Quantidade_Faturas,'#13#10'  Ttl.Quantidade_Quitadas,  '#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Faturas = Ttl.Quantidade_Quitadas THEN Ttl.Data_Pagamento'#13#10'    ELSE NULL'#13#10'  End AS Data_Finalizacao,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Pgto = 0 THEN 0 /* Sem pagamento */'#13#10'    WHEN Ttl.Quantidade_Pgto = Ttl.Quitada_Pgto THEN 3 /* Pago */'#13#10'    WHEN Ttl.Quitada_Pgto + Ttl.Parcialmente_Quitada_Pgto > 0 THEN 2 /* Parcialmente pago */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Pagamento,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Pgto > 0) AND (Ttl.Quantidade_Pgto = Ttl.Quitada_Pgto) THEN Ttl.Data_Pagamento_Pgto'#13#10'    ELSE NULL'#13#10'  End AS Data_Pagamento,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Rcbto = 0 THEN 0 /* Sem recebimento */'#13#10'    WHEN (Ttl.Quantidade_Rcbto = Ttl.Quitada_Rcbto) AND (Ttl.Quantidade_Adiantamento = 0 Or ((Ttl.Quantidade_Acerto_Saldo > 0) AND (Ttl.Quantidade_Acerto_Saldo = Ttl.Quitada_Acerto_Saldo))) THEN 3 /* Recebido */'#13#10'    WHEN Ttl.Quitada_Rcbto + Ttl.Parcialmente_Quitada_Rcbto > 0 THEN 2 /* Parcialmente recebido */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Recebimento,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Rcbto > 0) AND (Ttl.Quantidade_Rcbto = Ttl.Quitada_Rcbto) AND (Ttl.Quantidade_Adiantamento = 0 Or ((Ttl.Quantidade_Acerto_Saldo > 0) AND (Ttl.Quantidade_Acerto_Saldo = Ttl.Quitada_Acerto_Saldo))) THEN Ttl.Data_Pagamento_Rcbto'#13#10'    ELSE NULL'#13#10'  End AS Data_Recebimento,'#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Agente = 0 THEN 0 /* Sem acerto com agente */'#13#10'    WHEN Ttl.Quantidade_Agente = Ttl.Quitada_Agente THEN 3 /* Quitado */'#13#10'    WHEN Ttl.Quitada_Agente + Ttl.Parcialmente_Quitada_Agente > 0 THEN 2 /* Parcialmente quitado */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Acerto_Agente,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Agente > 0) AND (Ttl.Quantidade_Agente = Ttl.Quitada_Agente) THEN Ttl.Data_Pagamento_Agente'#13#10'    ELSE NULL'#13#10'  End AS Data_Acerto_Saldo,'#13#10''#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = 0 THEN 0 /* Sem pagamento */'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = 1 THEN Ttl.Situacao_Pagamento_Frete'#13#10'    WHEN Ttl.Quantidade_Pgto_Frete = Ttl.Quitada_Pgto_Frete THEN 2 /* Pago */'#13#10'    WHEN Ttl.Quitada_Pgto_Frete + Ttl.Parcialmente_Quitada_Pgto_Frete > 0 THEN 3 /* Parcialmente pago */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Pagamento_Frete,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Pgto_Frete > 0) AND (Ttl.Quantidade_Pgto_Frete = Ttl.Quitada_Pgto_Frete) THEN Ttl.Data_Pgto_Frete'#13#10'    ELSE NULL'#13#10'  End AS Data_Pagamento_Frete,'#13#10''#13#10'  CASE'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = 0 THEN 0 /* Sem recebimento */'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = 1 THEN Ttl.Situacao_Recebimento_Frete'#13#10'    WHEN Ttl.Quantidade_Rcbto_Frete = Ttl.Quitada_Rcbto_Frete THEN 2 /* Recebido */'#13#10'    WHEN Ttl.Quitada_Rcbto_Frete + Ttl.Parcialmente_Quitada_Rcbto_Frete > 0 THEN 3 /* Parcialmente recebido */'#13#10'    ELSE 1 /* Em aberto*/'#13#10'  End AS Situacao_Recebimento_Frete,'#13#10'  CASE'#13#10'    WHEN (Ttl.Quantidade_Rcbto_Frete > 0) AND (Ttl.Quantidade_Rcbto_Frete = Ttl.Quitada_Rcbto_Frete) THEN Ttl.Data_Rcbto_Frete'#13#10'    ELSE NULL'#13#10'  End AS Data_Recebimento_Frete'#13#10'FROM'#13#10'  mov_Logistica_House Lhs'#13#10'JOIN'#13#10'  mov_Logistica_Master Lms ON Lms.IdLogistica_Master = Lhs.IdLogistica_Master'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Lft.IdLogistica_house,'#13#10'    COUNT(Lft.IdRegistro_Financeiro) AS Quantidade_Faturas,'#13#10'    SUM(CASE'#13#10'      WHEN COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Quitadas,'#13#10'    MAX(COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)) AS Data_Pagamento,'#13#10'    /* PAGAMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Pgto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Pgto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Pgto,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 1 /* Pagamento */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Pgto,'#13#10''#13#10'    /* RECEBIMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de Saldo */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Rcbto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Rcbto,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6 ,7) /* Recebimento, Adiantamento e Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Rcbto,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura IN (2, 6, 7) /* Recebimento, Adiantamento e Acerto de saldo */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Rcbto,'#13#10''#13#10'    /* ADIANTAMENTO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 6 /* Adiantamento */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Adiantamento,'#13#10''#13#10'    /* ACERTO DE SALDO */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 7 /* Acerto de saldo */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Acerto_Saldo,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 7 /* Acerto de Saldo */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Acerto_Saldo,'#13#10''#13#10'    /* AGENTE */'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Agente,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Agente,'#13#10'    SUM(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ AND COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */ THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Agente,'#13#10'    MAX(CASE'#13#10'      WHEN Lft.Tipo_Fatura = 3 /* Agente */ THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pagamento_Agente,'#13#10''#13#10'    /* RECEBIMENTO DO FRETE */  '#13#10'    SUM(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Rcbto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Frf.IdRegistro_Recebimento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Rcbto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Frf.IdRegistro_Recebimento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Rcbto_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN COALESCE(Fun.Situacao, Ffn.Situacao)'#13#10'      ELSE 0'#13#10'    END) AS Situacao_Recebimento_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Frf.IdRegistro_Recebimento IS NULL THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Rcbto_Frete,'#13#10''#13#10'    /* PAGAMENTO DO FRETE */ '#13#10'    SUM(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quantidade_Pgto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Fpf.IdRegistro_Pagamento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 2 /* Quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Quitada_Pgto_Frete,'#13#10'    SUM(CASE'#13#10'      WHEN (NOT Fpf.IdRegistro_Pagamento IS NULL) AND (COALESCE(Fun.Situacao, Ffn.Situacao) = 3 /* Parcialmente quitada */) THEN 1'#13#10'      ELSE 0'#13#10'    END) AS Parcialmente_Quitada_Pgto_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN COALESCE(Fun.Situacao, Ffn.Situacao)'#13#10'      ELSE 0'#13#10'    END) AS Situacao_Pagamento_Frete,'#13#10'    MAX(CASE'#13#10'      WHEN NOT Fpf.IdRegistro_Pagamento IS NULL THEN COALESCE(Fun.Data_Pagamento, Ffn.Data_Pagamento)'#13#10'      ELSE NULL'#13#10'    END) AS Data_Pgto_Frete'#13#10'  FROM'#13#10'    vis_Logistica_Fatura Lft'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffn ON Ffn.IdRegistro_Financeiro = Lft.IdRegistro_Financeiro'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Fatura_Financeira Fun On Fun.IdRegistro_Financeiro = Ffn.IdRegistro_Unificador'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT DISTINCT'#13#10'      Ltx.IdRegistro_Recebimento'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica_Exibicao Tle ON Tle.IdTaxa_Logistica_Exibicao = Ltx.IdTaxa_Logistica_Exibicao'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica Tlg ON Tlg.IdTaxa_Logistica = Tle.IdTaxa_Logistica AND Tlg.Tipo = 1'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Frf ON Frf.IdRegistro_Recebimento = Lft.IdRegistro_Financeiro'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT DISTINCT'#13#10'      Ltx.IdRegistro_Pagamento'#13#10'    FROM'#13#10'      mov_Logistica_Taxa Ltx'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica_Exibicao Tle ON Tle.IdTaxa_Logistica_Exibicao = Ltx.IdTaxa_Logistica_Exibicao'#13#10'    JOIN'#13#10'      cad_Taxa_Logistica Tlg ON Tlg.IdTaxa_Logistica = Tle.IdTaxa_Logistica AND Tlg.Tipo = 1'#13#10'    WHERE'#13#10'      Ltx.IdLogistica_House = @IdLogistica_House'#13#10'    ) AS Fpf ON Fpf.IdRegistro_Pagamento = Lft.IdRegistro_Financeiro'#13#10'  WHERE'#13#10'    Lft.IdLogistica_House = @IdLogistica_House'#13#10'  AND'#13#10'    (@Ignorar_Fatura_Vendedor = 0 OR COALESCE(Lft.Tipo_Fatura, 0) <> 8 /* VENDEDOR */)'#13#10'  AND'#13#10'    (@Ignorar_Fatura_Cancelada = 0 OR COALESCE(Fun.Situacao, Ffn.Situacao, 0) <> 6 /* CANCELADA */)'#13#10'  GROUP BY'#13#10'    Lft.IdLogistica_House'#13#10'  ) Ttl ON Ttl.IdLogistica_House = Lhs.IdLogistica_House'#13#10'WHERE'#13#10'  Lhs.IdLogistica_House = @IdLogistica_House'";"[0]['IdRegistro_Financeiro']='15480'; [1]['IdLogistica_House']='0'; [2]['Ignorar_Fatura_Vendedor']='True'; [3]['Ignorar_Fatura_Cancelada']='False'"
"31";"49";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"16";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdCondicao_Pagamento, IdForma_Cobranca, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdConversao_Moeda, IdAtraves_De, IdModelo_Registro_Financeiro, IdGrupo_Financeiro, IdEmpresa_Sistema, IdPessoa_Referencia, IdSetor, IdChave_Externa, Data, Data_Referencia, Numero, Referencia, Referencia_Externa, Natureza, Subtotal, Acrescimo, Tipo_Acrescimo, Abatimento, Tipo_Abatimento, Desconto_Incondicional, Tipo_Desconto_Incondicional, Desconto_Condicional, Tipo_Desconto_Condicional, Dias_Desconto_Condicional, Multa, Tipo_Multa, Juros, Periodo_Juros, Tipo_Juros, Tolerancia_Multa_Juros, Valor_Total, Situacao, Valor_Original, Fator_Corrente, Valor_Corrente, Registro_Unificador, Origem_Lancamento, Historico_Resumo, Codigo_Barras, Historico, Instrucao, Atalho, Observacao, Dados_Registro, Ativo, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  (IdRegistro_Financeiro in'#13#10'  (Select /* Registro da própria fatura */'#13#10'    Ffn.IdRegistro_Financeiro'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Where'#13#10'    Ffn.IdFatura_Financeira = 15849'#13#10'  Union'#13#10'  Select /* Registros das faturas unificadas */'#13#10'    Fun.IdRegistro_Financeiro'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Join'#13#10'    mov_Registro_Financeiro Rfn On Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'  Left Outer Join'#13#10'    mov_Fatura_Financeira Fun On Fun.IdRegistro_Unificador = Rfn.IdRegistro_Financeiro'#13#10'  Where'#13#10'    Ffn.IdFatura_Financeira = 15849))'";""
"31";"48";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"10";"OK";"1";"'update mov_Registro_Financeiro  set'#13#10' Situacao = ?,'#13#10' Hash = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdRegistro_Financeiro = ?'";"[0]['Param1']='2'; [1]['Param2']='284186f24cc7f91109fd7de691271955'; [2]['Param3']='11/02/2026 13:39:27'; [3]['Param4']='15480'"
"31";"47";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"9";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, Hash'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  IdRegistro_Financeiro = ?'";"[0]['0']='15480'"
"31";"46";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"10";"OK";"1";"'Select'#13#10'  Srf.IdRegistro_Financeiro,'#13#10'  Case'#13#10'    When Srf.Quantidade_Faturas = Srf.Quantidade_Canceladas Then 3 /* Cancelado */'#13#10'    When Srf.Quantidade_Faturas = (Srf.Quantidade_Quitadas + Srf.Quantidade_Unificadas + Srf.Quantidade_Canceladas) Then 2 /* Finalizado */'#13#10'    When Srf.Quantidade_Quitadas + Srf.Quantidade_Parcialmente_Quitadas > 0 Then 4 /* Parcialmente Quitado */'#13#10'    Else 1 /* Em aberto */'#13#10'  End As Situacao'#13#10'From'#13#10'  (Select'#13#10'    Ffn.IdRegistro_Financeiro,'#13#10'    Count(Ffn.IdFatura_Financeira) As Quantidade_Faturas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 2 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Quitadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 4 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Unificadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 3 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Parcialmente_Quitadas,'#13#10'    Sum(Case'#13#10'      When Ffn.Situacao = 6 Then 1'#13#10'      Else 0'#13#10'    End) As Quantidade_Canceladas'#13#10'  From'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  Where'#13#10'    Ffn.IdRegistro_Financeiro = ?'#13#10'  Group By'#13#10'    Ffn.IdRegistro_Financeiro'#13#10'  ) Srf'";"[0]['IdRegistro_Financeiro']='15480'"
"31";"45";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"24";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdCondicao_Pagamento, IdForma_Cobranca, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdConversao_Moeda, IdAtraves_De, IdModelo_Registro_Financeiro, IdGrupo_Financeiro, IdEmpresa_Sistema, IdPessoa_Referencia, IdSetor, IdChave_Externa, Data, Data_Referencia, Numero, Referencia, Referencia_Externa, Natureza, Subtotal, Acrescimo, Tipo_Acrescimo, Abatimento, Tipo_Abatimento, Desconto_Incondicional, Tipo_Desconto_Incondicional, Desconto_Condicional, Tipo_Desconto_Condicional, Dias_Desconto_Condicional, Multa, Tipo_Multa, Juros, Periodo_Juros, Tipo_Juros, Tolerancia_Multa_Juros, Valor_Total, Situacao, Valor_Original, Fator_Corrente, Valor_Corrente, Registro_Unificador, Origem_Lancamento, Historico_Resumo, Codigo_Barras, Historico, Instrucao, Atalho, Observacao, Dados_Registro, Ativo, Hash, Data_Ultima_Alteracao'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  IdRegistro_Financeiro = ?'";"[0]['0']='15480'"
"31";"44";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"5";"OK";"1";"'update mov_Fatura_Financeira  set'#13#10' Data_Pagamento = ?,'#13#10' Situacao = ?,'#13#10' Valor_Residual = ?,'#13#10' Total_Pago = ?,'#13#10' Total_Pago_Corrente = ?,'#13#10' Em_Aberto = ?,'#13#10' Hash = ?,'#13#10' Data_Ultima_Alteracao = ?'#13#10'where'#13#10' IdFatura_Financeira = ?'";""
"31";"43";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"20";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"31";"42";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"8";"OK";"1";"'DECLARE'#13#10'  @IdFatura_Financeira IdLongo,'#13#10'  @Valor Moeda'#13#10''#13#10'SET @IdFatura_Financeira = ?'#13#10'SET @Valor = ?'#13#10''#13#10'SELECT'#13#10'  Ttl.IdFatura_Financeira,'#13#10'  Ttl.Total_Pago,'#13#10'  Ttl.Total_Pago_Corrente,'#13#10'  Ttl.Total_Multa,'#13#10'  Ttl.Total_Juros,'#13#10'  Ttl.Total_Acrescimo,'#13#10'  Ttl.Total_Desconto,'#13#10'  Ttl.Total_Abatimento,'#13#10'  (ISNULL(@Valor, 0)'#13#10'    - ISNULL(Ttl.Total_Pago, 0)'#13#10'    + ISNULL(Ttl.Total_Multa, 0)'#13#10'    + ISNULL(Ttl.Total_Juros, 0)'#13#10'    + ISNULL(Ttl.Total_Acrescimo, 0)'#13#10'    - ISNULL(Ttl.Total_Desconto, 0)'#13#10'    - ISNULL(Ttl.Total_Abatimento, 0)) As Valor_Residual,'#13#10'  ISNULL(Ttl.Data_Pagamento, GETDATE()) As Data_Pagamento,'#13#10'  Ttl.Quantidade_Baixas'#13#10'FROM'#13#10'  (SELECT'#13#10'    Ffn.IdFatura_Financeira,'#13#10'    MAX(Mfn.Data) As Data_Pagamento,'#13#10'    SUM(Ffb.Valor_Total) As Total_Pago,'#13#10'    SUM(Ffb.Valor_Multa) As Total_Multa,'#13#10'    SUM(Ffb.Valor_Juros) As Total_Juros,'#13#10'    SUM(Ffb.Valor_Acrescimo) As Total_Acrescimo,'#13#10'    SUM(Ffb.Valor_Desconto) As Total_Desconto,'#13#10'    SUM(Ffb.Valor_Abatimento) As Total_Abatimento,'#13#10'    SUM(Ffb.Valor_Total_Corrente) As Total_Pago_Corrente,'#13#10'    COUNT(Ffb.IdFatura_Financeira_Baixa) AS Quantidade_Baixas'#13#10'  FROM'#13#10'    mov_Fatura_Financeira Ffn'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Fatura_Financeira_Baixa Ffb On Ffb.IdFatura_Financeira = Ffn.IdFatura_Financeira'#13#10'  LEFT OUTER JOIN'#13#10'    mov_Movimentacao_Financeira Mfn On Mfn.IdMovimentacao_Financeira = Ffb.IdMovimentacao_Financeira  '#13#10'  WHERE'#13#10'    Ffn.IdFatura_Financeira = @IdFatura_Financeira'#13#10'  GROUP BY'#13#10'    Ffn.IdFatura_Financeira'#13#10'  ) AS Ttl'";"[0]['IdFatura_Financeira']='15849'; [1]['Valor']='1625,66'"
"31";"41";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"23";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, IdRegistro_Financeiro, IdForma_Cobranca, IdResponsavel_Titulo, IdResponsavel_Conferencia, IdResponsavel_Unificacao, IdResponsavel_Cancelamento, IdResponsavel_Cobranca, IdResponsavel_Cobranca_Judic, IdResponsavel_Protesto, IdResponsavel_Negativacao, IdResponsavel_Renegociacao, IdRegistro_Unificador, IdMarcador_Fatura_Financeira, IdMarcador_Auditoria, Numero, Referencia_Externa, Data, Tipo, Data_Vencimento, Previsao_Pagamento, Data_Pagamento, Data_Conferencia, Situacao, Prioridade, Natureza, Valor, Valor_Original, Valor_Residual, Total_Pago, Total_Pago_Corrente, Total_Multa, Total_Juros, Total_Acrescimo, Total_Desconto, Total_Abatimento, Conferido, Parcela, Numero_Cobranca, Em_Aberto, Fator_Unificacao, Historico_Resumo, Historico, Data_Envio, Data_Unificacao, Data_Cancelamento, Data_Cobranca, Data_Cobranca_Judicial, Data_Negativacao, Data_Protesto, Data_Renegociacao, Numero_Nota_Fiscal, Data_Nota_Fiscal, Valor_Nota_Fiscal, Coligada, Renegociada, Competencia, Ativo, Observacao, Hash, Data_Ultima_Alteracao, IdFechamento_Cambio, Data_Primeiro_Vencimento, Porcentagem, Valor_Corrente'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"31";"40";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"10";"OK";"1";"'insert into mov_Fatura_Financeira_Baixa'#13#10'  (IdFatura_Financeira_Baixa, IdFatura_Financeira, IdMovimentacao_Financeira, Valor_Total, Valor_Total_Corrente, Fator_Conversao, Valor_Convertido, Tipo_Baixa, Gerar_Recibo, Proveniencia, Observacao, Hash, Data_Ultima_Alteracao)'#13#10'values'#13#10'  (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'";""
"31";"39";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"13";"OK";"0";"'Select'#13#10'  IdFatura_Financeira_Baixa, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa'#13#10'Where'#13#10'  IdFatura_Financeira_Baixa = ?'";"[0]['0']='2002'"
"31";"38";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"19";"OK";"0";"'Select'#13#10'  IdFatura_Financeira_Baixa, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira_Baixa'#13#10'Where'#13#10'  IdFatura_Financeira_Baixa = ?'";"[0]['0']='2002'"
"31";"37";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"20";"OK";"1";"'Declare'#13#10'  @Tabela Nome,'#13#10'  @FieldName Nome,'#13#10'  @SQL nVarChar(Max),'#13#10'  @Result IdLongo'#13#10''#13#10'Select'#13#10'  @Tabela = ?,'#13#10'  @FieldName = ?'#13#10''#13#10'Set @SQL = '#39'EXECUTE @Result = HeadSoft.'#39'+DB_NAME()+'#39'.dbo.hsGerarCodigo '#39''#39''#39'+@Tabela+'#39''#39''#39','#39''#39''#39'+@FieldName+'#39''#39''#39''#39''#13#10'exec sp_executesql @SQL, N'#39'@Result IdLongo OUTPUT'#39', @Result=@Result OUTPUT'#13#10''#13#10'Set ?=@Result'";"[0][]='mov_Fatura_Financeira_Baixa'; [1][]='IdFatura_Financeira_Baixa'; [2][]='NULL'"
"31";"36";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"9";"OK";"1";"'insert into mov_Movimentacao_Financeira'#13#10'  (IdMovimentacao_Financeira, IdTipo_Transacao, IdPessoa, IdConta_Pessoa, IdForma_Pagamento, IdConta_Corrente, IdMoeda, IdEmpresa_Sistema, Numero, Referencia, Referencia_Externa, Valor, Valor_Original, Valor_Corrente, Fator_Corrente, Natureza, Data, Previsao_Compensacao, Data_Compensacao, Historico_Resumo, Historico, Compensada, Conciliada, Estornada, Utilizar_Saldo_Pessoa, Origem_Lancamento, Data_Lancamento, Nota_Recibo_Conferido, Variacao_Cambial, Competencia, Atalho, Observacao, Identificacao_Extrato, Ativo, Hash, Data_Ultima_Alteracao)'#13#10'values'#13#10'  (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'";""
"31";"35";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"9";"OK";"0";"'Select'#13#10'  IdMovimentacao_Financeira, Hash'#13#10'From'#13#10'  mov_Movimentacao_Financeira'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"31";"34";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"20";"OK";"0";"'Select'#13#10'  IdMovimentacao_Financeira, Hash'#13#10'From'#13#10'  mov_Movimentacao_Financeira'#13#10'Where'#13#10'  IdMovimentacao_Financeira = ?'";"[0]['0']='1844'"
"31";"33";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"17";"OK";"1";"'Declare'#13#10'  @Tabela Nome,'#13#10'  @FieldName Nome,'#13#10'  @SQL nVarChar(Max),'#13#10'  @Result IdLongo'#13#10''#13#10'Select'#13#10'  @Tabela = ?,'#13#10'  @FieldName = ?'#13#10''#13#10'Set @SQL = '#39'EXECUTE @Result = HeadSoft.'#39'+DB_NAME()+'#39'.dbo.hsGerarCodigo '#39''#39''#39'+@Tabela+'#39''#39''#39','#39''#39''#39'+@FieldName+'#39''#39''#39''#39''#13#10'exec sp_executesql @SQL, N'#39'@Result IdLongo OUTPUT'#39', @Result=@Result OUTPUT'#13#10''#13#10'Set ?=@Result'";"[0][]='mov_Movimentacao_Financeira'; [1][]='IdMovimentacao_Financeira'; [2][]='NULL'"
"31";"32";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"29";"OK";"1";"'Declare'#13#10'  @IdEmpresa_Sistema IdCurto,'#13#10'  @Chave Nome,'#13#10'  @Campo Nome,'#13#10'  @Data Data,'#13#10'  @Numeracao_Automatica Boleano,'#13#10'  @Mascara AlfaNumericoLongo,'#13#10'  @Quantidade_Digitos InteiroCurto,'#13#10'  @Opcao_Zeramento TipoFixo,'#13#10'  @Numero InteiroLongo'#13#10'  '#13#10'Select'#13#10'  @IdEmpresa_Sistema=?,'#13#10'  @Chave=?,'#13#10'  @Campo=?,'#13#10'  @Data=?,'#13#10'  @Numeracao_Automatica=?,'#13#10'  @Mascara=?,'#13#10'  @Quantidade_Digitos=?,'#13#10'  @Opcao_Zeramento=?'#13#10''#13#10'/*'#13#10'Select'#13#10'  @IdEmpresa_Sistema=1,'#13#10'  @Chave='#39'cad_Cargo'#39','#13#10'  @Campo='#39'Codigo'#39','#13#10'  @Data=getdate(),'#13#10'  @Numeracao_Automatica=1,'#13#10'  @Mascara='#39'[Numero]'#39','#13#10'  @Quantidade_Digitos=6,'#13#10'  @Opcao_Zeramento=0'#13#10'*/'#13#10''#13#10'Declare'#13#10'  @SQL nVarChar(Max)'#13#10''#13#10'Set @SQL = '#39'exec HeadSoft.'#39'+DB_NAME()+'#39'.dbo.hsGerarNumeracao'#13#10'  @IdEmpresa_Sistema=@IdEmpresa_Sistema,'#13#10'  @Chave=@Chave,'#13#10'  @Campo=@Campo,'#13#10'  @Data=@Data OUTPUT,'#13#10'  @Numeracao_Automatica=@Numeracao_Automatica,'#13#10'  @Mascara=@Mascara OUTPUT,'#13#10'  @Quantidade_Digitos=@Quantidade_Digitos OUTPUT,'#13#10'  @Opcao_Zeramento=@Opcao_Zeramento,'#13#10'  @Numero=@Numero OUTPUT'#39''#13#10''#13#10'exec sp_executesql @SQL, N'#39''#13#10'  @IdEmpresa_Sistema IdCurto,'#13#10'  @Chave Nome,'#13#10'  @Campo Nome,'#13#10'  @Data Data OUTPUT,'#13#10'  @Numeracao_Automatica Boleano,'#13#10'  @Mascara AlfaNumericoLongo OUTPUT,'#13#10'  @Quantidade_Digitos InteiroCurto OUTPUT,'#13#10'  @Opcao_Zeramento TipoFixo,'#13#10'  @Numero InteiroLongo OUTPUT'#39','#13#10''#13#10'  @IdEmpresa_Sistema=@IdEmpresa_Sistema,'#13#10'  @Chave=@Chave,'#13#10'  @Campo=@Campo,'#13#10'  @Data=@Data OUTPUT,'#13#10'  @Numeracao_Automatica=@Numeracao_Automatica,'#13#10'  @Mascara=@Mascara OUTPUT,'#13#10'  @Quantidade_Digitos=@Quantidade_Digitos OUTPUT,'#13#10'  @Opcao_Zeramento=@Opcao_Zeramento,'#13#10'  @Numero=@Numero OUTPUT'#13#10''#13#10'Set ? = @Mascara'#13#10'Set ? = @Quantidade_Digitos'#13#10'Set ? = @Data'#13#10'Set ? = @Numero'";"[0]['IdEmpresa_Sistema']='2'; [1]['Chave']='mov_Movimentacao_Financeira'; [2]['Campo']='Numero'; [3]['Data']='NULL'; [4]['Numeracao_Automatica']='True'; [5]['Mascara']='[Numero]/[YY]'; [6]['Quantidade_Digitos']='6'; [7]['Opcao_Zeramento']='3'; [8]['Mascara_Result']='[Numero]'; [9]['Quantidade_Digitos_Result']='6'; [10]['Data_Result']='11/10/2013'; [11]['Numero_Result']='3642'"
"31";"31";"";"11/02/2026 13:39:26";"11/02/2026 13:39:26";"0";"OK";"0";"'START TANSACTION'";""
"30";"30";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"21";"OK";"-1";"'/*PING*/;'";""
"29";"29";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"9";"OK";"1";"'DECLARE '#13#10'  @XML_Faturas Xml'#13#10''#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10''#13#10'SELECT'#13#10'  Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39') AS IdFatura_Financeira,'#13#10'  Xft.value('#39'@Hash'#39', '#39'varchar(50)'#39') AS Hash,'#13#10'  Ffn.Numero,'#13#10'  Ffn.Hash AS Hash_Atual'#13#10'FROM'#13#10'  @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'JOIN'#13#10'  mov_Fatura_Financeira Ffn ON Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'"
"28";"28";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"18";"OK";"1";"'Select Dados From sys_Parametro Where IdParametro Like ? and IdSistema Like ?'";"[0]['IdParametro']='Proxy'; [1]['IdSistema']='HeadSoft'"
"27";"27";"";"11/02/2026 13:38:58";"11/02/2026 13:38:58";"23";"OK";"0";"'Select'#13#10'  Dados'#13#10'From'#13#10'  sys_Persistencia'#13#10'Where'#13#10'  IdPersistencia = ?'#13#10'    And IdUsuario = ?'";"[0]['IdPersistencia']='Internet_Config'; [1]['IdUsuario']='122'"
"26";"26";"";"11/02/2026 13:38:54";"11/02/2026 13:38:54";"49";"OK";"1";"'Declare @Parametros xml'#13#10''#13#10'Set @Parametros = ?'#13#10'/*'#39'<Persistencia>'#13#10'  <Item IdPersistencia="Atualizar_Fatura_Logistica" IdUsuario="1">eNrz8fTzcDTk5fIB0UZQ2hhKm0BpUyhtBgDw2wox</Item>'#13#10'</Persistencia>'#39'*/'#13#10''#13#10'Declare @Persistencia Table ('#13#10'  IdPersistencia Nome,'#13#10'  IdUsuario IdCurto,'#13#10'  Dados Image'#13#10')'#13#10''#13#10'Insert Into @Persistencia ('#13#10'  IdPersistencia,'#13#10'  IdUsuario,'#13#10'  Dados'#13#10')'#13#10'Select'#13#10'  Prs.value('#39'@IdPersistencia'#39', '#39'VarChar(Max)'#39') as IdPersistencia,'#13#10'  Prs.value('#39'@IdUsuario'#39', '#39'SmallInt'#39') as IdUsuario,'#13#10'  Prs.value('#39'xs:base64Binary(.)'#39', '#39'VarBinary(Max)'#39') as Dados'#13#10'From'#13#10'  @Parametros.nodes('#39'/Persistencia/Item'#39') as Persistencia(Prs)'#13#10''#13#10'/* INSERE OS QUE NAO EXISTEM */'#13#10'Insert Into sys_Persistencia ('#13#10'  IdPersistencia,'#13#10'  IdUsuario,'#13#10'  Dados'#13#10')'#13#10'Select'#13#10'  Dta.IdPersistencia,'#13#10'  Dta.IdUsuario,'#13#10'  Dta.Dados'#13#10'From'#13#10'  @Persistencia Dta'#13#10'Left Outer Join'#13#10'  sys_Persistencia Prs on Prs.IdPersistencia = Dta.IdPersistencia'#13#10'    And Prs.IdUsuario = Dta.IdUsuario'#13#10'Where'#13#10'  Prs.IdPersistencia Is Null'#13#10''#13#10'/* ATUALIZA OS EXISTENTES */'#13#10'Update sys_Persistencia Set'#13#10'  Dados = Dta.Dados'#13#10'From'#13#10'  sys_Persistencia Prs'#13#10'Join'#13#10'  @Persistencia Dta On Dta.IdPersistencia = Prs.IdPersistencia'#13#10'    And Dta.IdUsuario = Prs.IdUsuario'";"[0]['Parametros']='<Persistencia><Item IdPersistencia="rlcConta_Corrente" IdUsuario="122">eNrtmcFy2zYQhu+a0TvkBeqxZFtyDjzIkp2qbSJN7HEOHg8GImEZLUUoIKmk'#13#10'fdtOD3mNAiAokiJ2QTWTQ2d0s70fyB/L3cUu/DTN00xsyFRsVuJsHk1FklGy'#13#10'ZGkq6HO/p374nPOUSjJPeMgFWdKY7iQNBv3eTZ6GlNzzTR5nNGGUTOlmK1Jt'#13#10'+pnx9WsWDMbDfm8q4jyh5J2kEXuarFkScvp8NomiO87iKDg/JDK+E4j9hiYh'#13#10'Zp+KiK/rwMAJkBuWsBe1JSq5/3FkOl+ikHKaz65cLCVLtyKJWJIxDN++kGmy'#13#10'/Z088CyPqUTQGUtDyUOKbcH6nMwevRJRZL7ZKv0pFWSS5TTmf9GIkkmcMUlx'#13#10'AXO13bWBlA9WUn1AtU59Zsxlv/ENR530XrAIe8AHsWEdHLhYpUzuPBtYbL17'#13#10'XNJI4kCRUg2g33ua8R1PBUtVrhmXBLVYUW7r9wxAxVPEd8ZUWp7PFlIFkpYV'#13#10'wJT6ZccSHeEu+kXSg2dOQiWCLemaBXdCqsz+W6UHJqJY8EBXej/QcysVwPON'#13#10'I1RqpCaU+z25Tso1aTAT4R/NP50tviRMtlzV/J2U+NmS6j8E9SeYV+6Lmy50'#13#10'RV0jt19pRvVe5utESFX33tNURbj5nKa8kUeeqi1wU+fUQ5z1c++fUwU9VdBT'#13#10'Bf2hFdTdwNA13aggEacMPGXgKQN/bAb+ojIn1tPCJ55E4st9RjMWDI1psc24'#13#10'SFJji7JXcsekNIlJg+FQRXX1e9H90DC743Em9Ql9E4vPOVNpexvp6LDn7TuZ'#13#10'61N4EhZN0yLX8JtYhLQ4ku2H+vaPeBOaD/XNJPqMZTR+ZeWpbV+iu648E5Nt'#13#10'rN4g6y2Zs9kpVj1rr+SqofDhxmnPR0bgXKXW16PjVjclq5gdvc58lWBweew6'#13#10'BQsZ/DQYjcfj4WCAFJxiPxgBaa8zVucQYzppapbMQtywC+pR2YQ9cpuwT7er'#13#10'7hbCLzqxsHIXbaWPutG4dnsOFmIv3UZInTUXcq7Gbiv+eqRmF5Kuui8AEwxe'#13#10'AuYWvKRLCJfiR4AVD1TQo6UZl6BPpFLA2GkrX+9eWbz8YnDltOLvLk+f4u3X'#13#10'gBV6f2mH4ru04xps51ZIeOs2Qh/AmiEB1uzJqLL3tGX1HLKDaVUCUGKV9k46'#13#10'TLNlpWCIR41hcEEG6VAp93KGbitaDJHkMNYulbrmkQsQwEsy4o0KwLVU3Z7V'#13#10'cgkCkJaKALRUAK6lbIOtkivADOko7TZvziE7LsK22lbDyG2FJFgzlLnW7K+c'#13#10'VS9vdYxRCJLTpCBVTcoTuq1pzQq89oJgKLdIKKRbIK61Ni5akW9hAlJXQ6Be'#13#10'rYZ4ziU7NtlmEpqqwIPJ2gH3lGZPvtdGQKsDQ8CcrzGQX+pMSxQyD1WXwEeN'#13#10'UdUy5zh1m2bY3LQ3QzveA9B294AvvVX7QD7kGyZVf1/vErqQcKa3WaitdLGe'#13#10'Q3w5J/cslCyDJqE6AZ7hNabQNjzHGL+m+QwacEorpkXbMR3a7tfwK/sTHFxK'#13#10'M6bCAJgMA+A6HvhWkAc1IKQbrmdxaGxpc5CyNgmdHm3yiFFv9B2jXjuw//Os'#13#10'N6UyY1xSaGDB1xwz8VWrIH/iq75zjr3+f82xJrY+sZUqCXLHQwbNU20OjesG'#13#10'icZ1g/TU9aKe6iNJ0kyAg1eLA0v6IQgdPC3Q08LZYLInADiWtTioL2mB4KXW'#13#10'IdhRaPM6oz2wHXJgp3kIgldYh2CXTw9Ocz7/+dzW0VtNJ116Ln0G6KUPdCF5'#13#10'zK0PcHXT5drHPaN0jpdHKnljph35SW/MVCg0XzpQ34CSpDxSP5GPbKMv0cFx'#13#10'z0HCA0sLLQRfdyBxvR/ZmqeqISfzRPW6if4/qAAHQDcMqXbT0IHiprsMX2T6'#13#10'YXIDzoMNBpLagADXNhifU3libvjJTF/zm/9xMXBGBGjYrU4c9qsT73TwHYTw'#13#10'0Id5jr2D4AVPPTh0+71/AYpDGyI='#13#10'</Item></Persistencia>'"
"25";"25";"";"11/02/2026 13:38:54";"11/02/2026 13:38:54";"10";"OK";"1";"'Select Nome From cad_Conta_Corrente Where IdConta_Corrente = 36'";""
"24";"24";"";"11/02/2026 13:38:54";"11/02/2026 13:38:54";"16";"OK";"1";"'Select Nome From cad_Moeda Where IdMoeda = 52'";""
"23";"23";"";"11/02/2026 13:38:54";"11/02/2026 13:38:54";"20";"OK";"1";"'DECLARE'#13#10'  @XML_Faturas Xml,'#13#10'  @IdMoeda_Movimentacao IdCurto,'#13#10'  @IdConversao_Moeda IdCurto,'#13#10'  @Margem_Acrescimo Float,'#13#10'  @Data_Conversao DateTime'#13#10'  '#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10'Set @IdMoeda_Movimentacao = ?'#13#10'Set @IdConversao_Moeda = ?'#13#10'Set @Margem_Acrescimo = ?'#13#10'Set @Data_Conversao = ?'#13#10''#13#10'SELECT'#13#10'  Mda.IdMoeda_Origem,'#13#10'  Mda.IdMoeda_Destino,'#13#10'  Mor.Sigla As Moeda_Origem,'#13#10'  Mds.Sigla As Moeda_Destino,'#13#10'  Cast(Round(Case'#13#10'    When Cmf.IdMoeda_Origem = Mda.IdMoeda_Destino And Cmf.IdMoeda_Destino = Mda.IdMoeda_Origem And Coalesce(Cmf.Fator, 0) <> 0 Then Round(1 / Cmf.Fator, 6)'#13#10'    Else Cmf.Fator'#13#10'  End, 6) As Float) As Fator,'#13#10'  Cast(Round(Case'#13#10'    When Cmf.IdMoeda_Origem = Mda.IdMoeda_Destino And Cmf.IdMoeda_Destino = Mda.IdMoeda_Origem And Coalesce(Cmf.Fator, 0) <> 0 Then Round(1 / Cmf.Fator, 6) + Round((Round(1 / Cmf.Fator, 6) * @Margem_Acrescimo / 100), 6)'#13#10'    Else Cmf.Fator + Round(Cmf.Fator * @Margem_Acrescimo / 100, 6)'#13#10'  End, 6) As Float) As Fator_Margem,'#13#10'  Cmf.Data'#13#10'FROM'#13#10'  (SELECT'#13#10'    Case'#13#10'      When Pmd.IdMoeda_Origem = Mmv.IdMoeda Then Mmv.IdMoeda'#13#10'      Else Mft.IdMoeda'#13#10'    End As IdMoeda_Origem, '#13#10'    Case'#13#10'      When Pmd.IdMoeda_Destino = Mft.IdMoeda Then Mft.IdMoeda'#13#10'      Else Mmv.IdMoeda'#13#10'    End As IdMoeda_Destino'#13#10'  FROM'#13#10'    (SELECT DISTINCT'#13#10'      Rfn.IdMoeda'#13#10'    FROM'#13#10'      @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'    JOIN'#13#10'      mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'#13#10'    JOIN'#13#10'      mov_Registro_Financeiro Rfn On Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'    ) As Mft'#13#10'  CROSS JOIN'#13#10'    (SELECT'#13#10'      Mda.IdMoeda,'#13#10'      Mda.Sigla'#13#10'    FROM'#13#10'      cad_Moeda Mda'#13#10'    WHERE'#13#10'      Mda.IdMoeda = @IdMoeda_Movimentacao Or Mda.Moeda_Corrente = 1    '#13#10'    ) Mmv'#13#10'  LEFT OUTER JOIN'#13#10'    cad_Paridade_Moedas Pmd On (Pmd.IdMoeda_Origem = Mft.IdMoeda And Pmd.IdMoeda_Destino = Mmv.IdMoeda)'#13#10'      Or (Pmd.IdMoeda_Origem = Mmv.IdMoeda And Pmd.IdMoeda_Destino = Mft.IdMoeda)'#13#10'  WHERE'#13#10'    Mft.IdMoeda <> Mmv.IdMoeda'#13#10'  ) As Mda'#13#10'JOIN'#13#10'  cad_Moeda Mor On Mor.IdMoeda = Mda.IdMoeda_Origem'#13#10'JOIN'#13#10'  cad_Moeda Mds On Mds.IdMoeda = Mda.IdMoeda_Destino'#13#10'LEFT OUTER JOIN'#13#10'  (SELECT'#13#10'    Cmf.IdMoeda_Origem,'#13#10'    Cmf.IdMoeda_Destino,'#13#10'    Cmf.Fator,'#13#10'    Cmf.Data,'#13#10'    Rank() Over (Partition By Cmf.IdMoeda_Origem, Cmf.IdMoeda_Destino Order By Cmf.Data Desc) As Ranking'#13#10'  FROM'#13#10'    cad_Conversao_Moeda_Fator Cmf'#13#10'  WHERE'#13#10'    Cmf.IdConversao_Moeda = @IdConversao_Moeda  '#13#10'  AND'#13#10'    Cmf.Data <= @Data_Conversao  '#13#10'  ) As Cmf On (Cmf.Ranking = 1)'#13#10'    And ((Cmf.IdMoeda_Origem = Mda.IdMoeda_Origem And Cmf.IdMoeda_Destino = Mda.IdMoeda_Destino)'#13#10'    Or (Cmf.IdMoeda_Origem = Mda.IdMoeda_Destino And Cmf.IdMoeda_Destino = Mda.IdMoeda_Origem))'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'; [1]['IdMoeda_Movimentacao']='52'; [2]['IdConversao_Moeda']='0'; [3]['Margem_Acrescimo']='0'; [4]['Data_Conversao']='11/02/2026'"
"22";"22";"";"11/02/2026 13:38:54";"11/02/2026 13:38:54";"20";"OK";"1";"'Select'#13#10'  IdConta_Corrente, IdMoeda'#13#10'From'#13#10'  cad_Conta_Corrente'#13#10'Where'#13#10'  IdConta_Corrente = ?'";"[0]['0']='36'"
"21";"21";"";"11/02/2026 13:38:53";"11/02/2026 13:38:53";"28";"OK";"-1";"'Select Cbn.IdConta_Corrente as IdConta_Corrente, Cbn.Nome as Nome, Cbn.Ativo as Ativo, Cbn.Codigo as Codigo From cad_Conta_Corrente Cbn Left Outer Join cad_Pessoa Psa on Psa.IdPessoa = Cbn.IdPessoa Left Outer Join cad_Banco Bnc on Bnc.IdBanco = Cbn.IdBanco Left Outer Join cad_Moeda Mda on Mda.IdMoeda = Cbn.IdMoeda Left Outer Join cad_Conta_Corrente Ccr on Ccr.IdConta_Corrente = Cbn.IdConta_Correspondente  Where ((Cbn.IdPessoa in (Select Emp.IdPessoa From cad_Empresa Emp)) and (Cbn.Ativo = 1))'";""
"20";"20";"";"11/02/2026 13:38:52";"11/02/2026 13:38:52";"19";"OK";"1";"'Select'#13#10'  Dados'#13#10'From'#13#10'  sys_Persistencia'#13#10'Where'#13#10'  IdPersistencia = ?'#13#10'    And IdUsuario = ?'";"[0]['IdPersistencia']='rlcConta_Corrente'; [1]['IdUsuario']='122'"
"19";"19";"";"11/02/2026 13:38:52";"11/02/2026 13:38:52";"26";"OK";"-1";"'/*PING*/;'";""
"18";"18";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"12";"OK";"1";"'Select Nome From sys_Empresa_Sistema Where IdEmpresa_Sistema = 12'";""
"17";"17";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"15";"OK";"1";"'Select Nome From cad_Conta_Corrente Where IdConta_Corrente = 89'";""
"16";"16";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"13";"OK";"1";"'Select Nome From cad_Pessoa Where IdPessoa = 54988'";""
"15";"15";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"17";"OK";"1";"'Select Nome From cad_Forma_Pagamento Where IdForma_Pagamento = 1'";""
"14";"14";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"13";"OK";"1";"'Select'#13#10'  IdForma_Pagamento, Compensacao_Automatica'#13#10'From'#13#10'  cad_Forma_Pagamento'#13#10'Where'#13#10'  IdForma_Pagamento = ?'";"[0]['0']='1'"
"13";"13";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"16";"OK";"1";"'Select'#13#10'  IdForma_Pagamento, Compensacao_Automatica'#13#10'From'#13#10'  cad_Forma_Pagamento'#13#10'Where'#13#10'  IdForma_Pagamento = ?'";"[0]['0']='1'"
"12";"12";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"16";"OK";"1";"'Select'#13#10'  IdForma_Pagamento, Dias_Compensar'#13#10'From'#13#10'  cad_Forma_Pagamento'#13#10'Where'#13#10'  IdForma_Pagamento = ?'";"[0]['0']='1'"
"11";"11";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"8";"OK";"1";"'Select Nome From cad_Tipo_Transacao Where IdTipo_Transacao = 2'";""
"10";"10";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"19";"OK";"1";"'DECLARE'#13#10'  @XML_Faturas Xml'#13#10''#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10''#13#10'SELECT'#13#10'  Ccs.IdFatura_Financeira_Custo,'#13#10'  Ccs.IdFatura_Financeira_Categoria,'#13#10'  Ccs.IdFatura_Financeira,'#13#10'  Ccs.IdCentro_Custo,'#13#10'  Abs(Ccs.Valor) As Valor_Residual,'#13#10'  Abs(Ccs.Valor) As Valor,'#13#10'  Case'#13#10'    When Ccs.Valor_Residual_Categoria = 0 Then 0'#13#10'    Else Abs(Round(Ccs.Valor * 100 / Ccs.Valor_Residual_Categoria, 4)) '#13#10'  End As Porcentagem,'#13#10'  Cast(NULL As Float) As Fator_Conversao,'#13#10'  Cast(NULL As Numeric(19,2)) As Valor_Convertido,'#13#10'  Cast(Case'#13#10'    When Coalesce(Ccs.Valor, 0) < 0 Then 0'#13#10'    Else 1'#13#10'  End As Bit) As Natureza,'#13#10'  Cct.Nome As Centro_Custo,'#13#10'  Row_Number() Over (Order By Ccs.IdFatura_Financeira_Custo) As IdCentro_Custo_Temp,'#13#10'  Cast(NULL As Integer) As IdCategoria_Temp'#13#10'FROM'#13#10'  (SELECT'#13#10'    Ffn.IdFatura_Financeira,'#13#10'    Ctg.Valor_Residual_Categoria,'#13#10'    Ffs.IdFatura_Financeira_Custo,'#13#10'    Ffs.IdFatura_Financeira_Categoria,'#13#10'    Ffs.IdCentro_Custo,'#13#10'    Ffs.Porcentagem,'#13#10'    Coalesce(Case'#13#10'      When Ffs.Natureza = 0 Then -Ffs.Valor'#13#10'      Else Ffs.Valor'#13#10'    End, 0)'#13#10'    - Coalesce(Mfs.Valor, 0)'#13#10'    As Valor'#13#10'  FROM'#13#10'    @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira_Categoria Ffc On Ffc.IdFatura_Financeira = Ffn.IdFatura_Financeira'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira_Custo Ffs On Ffs.IdFatura_Financeira_Categoria = Ffc.IdFatura_Financeira_Categoria  '#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT'#13#10'      Mfs.IdFatura_Financeira_Custo,'#13#10'      Sum(Case'#13#10'        When Mfs.Natureza = 0 Then -Mfs.Valor'#13#10'        Else Mfs.Valor'#13#10'      End) As Valor'#13#10'    FROM'#13#10'      mov_Movimentacao_Financeira_Custo Mfs'#13#10'    WHERE'#13#10'      Not (Mfs.IdFatura_Financeira_Custo Is NULL)'#13#10'    GROUP BY'#13#10'      Mfs.IdFatura_Financeira_Custo'#13#10'    ) Mfs On Mfs.IdFatura_Financeira_Custo = Ffs.IdFatura_Financeira_Custo'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT'#13#10'      Ffc.IdFatura_Financeira_Categoria,'#13#10'      Coalesce(Case'#13#10'        When Ffc.Natureza = 0 Then -Ffc.Valor'#13#10'        Else Ffc.Valor'#13#10'      End, 0)'#13#10'      - Coalesce(Mfc.Valor, 0)'#13#10'      As Valor_Residual_Categoria    '#13#10'    FROM'#13#10'      @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'    JOIN'#13#10'      mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'#13#10'    JOIN'#13#10'      mov_Fatura_Financeira_Categoria Ffc On Ffc.IdFatura_Financeira = Ffn.IdFatura_Financeira'#13#10'    LEFT OUTER JOIN'#13#10'      (SELECT'#13#10'        Mfc.IdFatura_Financeira_Categoria,'#13#10'        Sum(Case'#13#10'          When Mfc.Natureza = 0 Then -Mfc.Valor'#13#10'          Else Mfc.Valor'#13#10'        End) As Valor'#13#10'      FROM'#13#10'        mov_Movimentacao_Financeira_Categoria Mfc'#13#10'      WHERE'#13#10'        Not (Mfc.IdFatura_Financeira_Categoria Is NULL)'#13#10'      GROUP BY'#13#10'        Mfc.IdFatura_Financeira_Categoria'#13#10'      ) Mfc On Mfc.IdFatura_Financeira_Categoria = Ffc.IdFatura_Financeira_Categoria'#13#10'    ) As Ctg On Ctg.IdFatura_Financeira_Categoria = Ffs.IdFatura_Financeira_Categoria'#13#10'  ) As Ccs'#13#10'LEFT OUTER JOIN'#13#10'  cad_Centro_Custo Cct On Cct.IdCentro_Custo = Ccs.IdCentro_Custo'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'"
"9";"9";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"30";"OK";"1";"'DECLARE'#13#10'  @XML_Faturas Xml'#13#10''#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10''#13#10'SELECT'#13#10'  Ctg.IdFatura_Financeira_Categoria,'#13#10'  Ctg.IdFatura_Financeira,'#13#10'  Ctg.IdCategoria_Financeira,'#13#10'  Ctg.Tipo_Custo,'#13#10'  Abs(Ctg.Valor) As Valor_Residual,'#13#10'  Abs(Ctg.Valor) As Valor,'#13#10'  Case'#13#10'    When Ctg.Valor_Residual_Fatura = 0 Then 0'#13#10'    Else Abs(Round(Ctg.Valor * 100 / Ctg.Valor_Residual_Fatura, 4)) '#13#10'  End As Porcentagem,'#13#10'  Cast(NULL As Float) As Fator_Conversao,'#13#10'  Cast(NULL As Numeric(19,2)) As Valor_Convertido,'#13#10'  Cast(Case'#13#10'    When Coalesce(Ctg.Valor, 0) < 0 Then 0'#13#10'    Else 1'#13#10'  End As Bit) As Natureza,'#13#10'  Cfn.Nome As Categoria_Financeira,'#13#10'  Cast(Row_Number() Over (Order By Ctg.IdFatura_Financeira_Categoria) As Integer) As IdCategoria_Temp,'#13#10'  Cast(NULL As Integer) As IdMovimentacao_Categoria'#13#10'FROM'#13#10'  (SELECT'#13#10'    Ffn.Valor_Residual As Valor_Residual_Fatura,'#13#10'    Ffc.IdFatura_Financeira_Categoria,'#13#10'    Ffc.IdFatura_Financeira,'#13#10'    Ffc.IdCategoria_Financeira,'#13#10'    Ffc.Tipo_Custo,'#13#10'    Coalesce(Case'#13#10'      When Ffc.Natureza = 0 Then -Ffc.Valor'#13#10'      Else Ffc.Valor'#13#10'    End, 0)'#13#10'    - Coalesce(Mfc.Valor, 0)'#13#10'    As Valor    '#13#10'  FROM'#13#10'    @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'#13#10'  JOIN'#13#10'    mov_Fatura_Financeira_Categoria Ffc On Ffc.IdFatura_Financeira = Ffn.IdFatura_Financeira'#13#10'  LEFT OUTER JOIN'#13#10'    (SELECT'#13#10'      Mfc.IdFatura_Financeira_Categoria,'#13#10'      Sum(Case'#13#10'        When Mfc.Natureza = 0 Then -Mfc.Valor'#13#10'        Else Mfc.Valor'#13#10'      End) As Valor'#13#10'    FROM'#13#10'      mov_Movimentacao_Financeira_Categoria Mfc'#13#10'    WHERE'#13#10'      Not (Mfc.IdFatura_Financeira_Categoria Is NULL)'#13#10'    GROUP BY'#13#10'      Mfc.IdFatura_Financeira_Categoria'#13#10'    ) Mfc On Mfc.IdFatura_Financeira_Categoria = Ffc.IdFatura_Financeira_Categoria'#13#10'  ) As Ctg'#13#10'LEFT OUTER JOIN'#13#10'  cad_Categoria_Financeira Cfn On Cfn.IdCategoria_Financeira = Ctg.IdCategoria_Financeira'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'"
"8";"8";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"23";"OK";"1";"'DECLARE'#13#10'  @XML_Faturas Xml'#13#10''#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10'SELECT'#13#10'  Ffn.IdFatura_Financeira,'#13#10'  Ffn.Situacao,'#13#10'  Ffn.Valor_Residual,'#13#10'  Ffn.Valor_Residual As Valor_Total,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Multa,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Juros,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Acrescimo,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Desconto,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Abatimento,'#13#10'  Cast(NULL As Float) As Fator_Conversao,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Convertido,'#13#10'  Cast(NULL As Float) As Fator_Corrente,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Corrente,'#13#10'  Cast(NULL As Numeric(19, 2)) As Valor_Diferenca,'#13#10'  Ffn.Numero As Fatura,'#13#10'  Ffn.Data As Data_Fatura,'#13#10'  Ffn.Data_Vencimento,'#13#10'  Ffn.Natureza,'#13#10'  Ffn.Hash,'#13#10'  Rfn.IdRegistro_Financeiro,'#13#10'  Rfn.IdTipo_Transacao,'#13#10'  Rfn.IdPessoa,'#13#10'  Rfn.IdConta_Pessoa,'#13#10'  Rfn.IdForma_Pagamento,'#13#10'  Rfn.IdConta_Corrente,'#13#10'  Rfn.IdMoeda,'#13#10'  Rfn.IdConversao_Moeda,'#13#10'  Rfn.IdGrupo_Financeiro,'#13#10'  Rfn.IdSetor,'#13#10'  Rfn.IdEmpresa_Sistema,'#13#10'  Rfn.Numero As Registro,'#13#10'  Rfn.Referencia,'#13#10'  Ffn.Referencia_Externa,'#13#10'  Ffn.Competencia,'#13#10'  Ffn.Historico_Resumo,'#13#10'  Ffn.Historico,'#13#10'  Rfn.Instrucao,'#13#10'  Psa.Nome As Pessoa,'#13#10'  Mda.Sigla As Moeda,'#13#10'  Ess.Nome As Empresa_Sistema,'#13#10'  CAST(NULL AS DateTime) AS Data_Pagamento,'#13#10'  CAST(NULL AS DateTime) AS Data_Compensacao,'#13#10'  CAST(NULL As Integer) AS IdFatura_Financeira_Baixa,'#13#10'  CAST(NULL As Integer) AS IdMovimentacao_Financeira'#13#10'FROM'#13#10'  @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'JOIN'#13#10'  mov_Fatura_Financeira Ffn On Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'#13#10'JOIN'#13#10'  mov_Registro_Financeiro Rfn On Rfn.IdRegistro_Financeiro = Ffn.IdRegistro_Financeiro'#13#10'JOIN'#13#10'  cad_Pessoa Psa ON Psa.IdPessoa = Rfn.IdPessoa'#13#10'JOIN'#13#10'  cad_Moeda Mda ON Mda.IdMoeda = Rfn.IdMoeda'#13#10'LEFT OUTER JOIN'#13#10'  sys_Empresa_Sistema Ess ON Ess.IdEmpresa_Sistema = Rfn.IdEmpresa_Sistema'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'"
"7";"7";"";"11/02/2026 13:38:51";"11/02/2026 13:38:51";"9";"OK";"1";"'Select'#13#10'  Dados'#13#10'From'#13#10'  sys_Persistencia'#13#10'Where'#13#10'  IdPersistencia = ?'#13#10'    And IdUsuario = ?'";"[0]['IdPersistencia']='frmBaixaUnificada'; [1]['IdUsuario']='122'"
"6";"6";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"13";"OK";"1";"'DECLARE '#13#10'  @XML_Faturas Xml'#13#10''#13#10'SET @XML_Faturas = ?'#13#10'/*'#13#10''#39'<Parameters>'#13#10'    <Registro IdFatura_Financeira="4066" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4075" Hash=""/>'#13#10'    <Registro IdFatura_Financeira="4079" Hash=""/>'#13#10'</Parameters>'#39''#13#10'*/'#13#10''#13#10'SELECT'#13#10'  Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39') AS IdFatura_Financeira,'#13#10'  Xft.value('#39'@Hash'#39', '#39'varchar(50)'#39') AS Hash,'#13#10'  Ffn.Numero,'#13#10'  Ffn.Hash AS Hash_Atual'#13#10'FROM'#13#10'  @XML_Faturas.nodes('#39'/Parameters/Registro'#39') As XML_Faturas(Xft)'#13#10'JOIN'#13#10'  mov_Fatura_Financeira Ffn ON Ffn.IdFatura_Financeira = Xft.value('#39'@IdFatura_Financeira'#39', '#39'int'#39')'";"[0]['XML_Faturas']='<Parameters><Registro IdFatura_Financeira="15849" Hash="7f7ef49436beccf094558333ea4a914f"/></Parameters>'"
"5";"5";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"30";"OK";"1";"'Select Dados From sys_Parametro Where IdParametro Like ? and IdSistema Like ?'";"[0]['IdParametro']='Proxy'; [1]['IdSistema']='HeadSoft'"
"4";"4";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"15";"OK";"0";"'Select'#13#10'  Dados'#13#10'From'#13#10'  sys_Persistencia'#13#10'Where'#13#10'  IdPersistencia = ?'#13#10'    And IdUsuario = ?'";"[0]['IdPersistencia']='Internet_Config'; [1]['IdUsuario']='122'"
"3";"3";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"16";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, Numero, Tipo, Situacao, Conferido'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"2";"2";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"9";"OK";"1";"'Select'#13#10'  IdFatura_Financeira, Hash'#13#10'From'#13#10'  mov_Fatura_Financeira'#13#10'Where'#13#10'  IdFatura_Financeira = ?'";"[0]['0']='15849'"
"1";"1";"";"11/02/2026 13:38:50";"11/02/2026 13:38:50";"9";"OK";"1";"'Select'#13#10'  IdRegistro_Financeiro, Hash'#13#10'From'#13#10'  mov_Registro_Financeiro'#13#10'Where'#13#10'  IdRegistro_Financeiro = ?'";"[0]['0']='15480'"
"";"130";"";"MIN=11/02/2026 13:38:50";"MAX=11/02/2026 13:39:51";"7223,00";"";"79,00";"";""
